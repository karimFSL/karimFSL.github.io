"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[1360],{2739:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"development/devops/tips/cliff","title":"G\xe9n\xe9ration automatique de Changelog avec git-cliff","description":"Introduction","source":"@site/docs/development/devops/tips/cliff.md","sourceDirName":"development/devops/tips","slug":"/development/devops/tips/cliff","permalink":"/docs/development/devops/tips/cliff","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/development/devops/tips/cliff.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docs","previous":{"title":"Connexion \xe0 Git avec GitLab","permalink":"/docs/development/devops/tips/gitlab-authentication"},"next":{"title":"Microservices","permalink":"/docs/microservices/"}}');var s=r(4848),t=r(8453);const o={sidebar_position:5},a="G\xe9n\xe9ration automatique de Changelog avec git-cliff",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Installation rapide",id:"installation-rapide",level:2},{value:"Configuration de base",id:"configuration-de-base",level:2},{value:"Utilisation quotidienne",id:"utilisation-quotidienne",level:2},{value:"Commandes essentielles",id:"commandes-essentielles",level:3},{value:"Int\xe9gration GitLab CI",id:"int\xe9gration-gitlab-ci",level:2},{value:"Script de release",id:"script-de-release",level:2},{value:"Configuration avanc\xe9e (optionnelle)",id:"configuration-avanc\xe9e-optionnelle",level:2},{value:"Pour un monorepo",id:"pour-un-monorepo",level:3},{value:"Avec int\xe9gration Jira",id:"avec-int\xe9gration-jira",level:3},{value:"Git Hook pour validation des commits",id:"git-hook-pour-validation-des-commits",level:2},{value:"Exemples de messages de commit",id:"exemples-de-messages-de-commit",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;No tags found&quot;",id:"no-tags-found",level:3},{value:"Commits non d\xe9tect\xe9s dans GitLab CI",id:"commits-non-d\xe9tect\xe9s-dans-gitlab-ci",level:3},{value:"Tester la configuration",id:"tester-la-configuration",level:3},{value:"Checklist d&#39;int\xe9gration",id:"checklist-dint\xe9gration",level:2},{value:"Ressources",id:"ressources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"g\xe9n\xe9ration-automatique-de-changelog-avec-git-cliff",children:"G\xe9n\xe9ration automatique de Changelog avec git-cliff"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"git-cliff"})," est un g\xe9n\xe9rateur de changelog rapide et configurable qui g\xe9n\xe8re automatiquement des changelogs \xe0 partir de l'historique Git en suivant les conventions Conventional Commits."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Pourquoi git-cliff ?"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\ud83d\ude80 Ultra-rapide (\xe9crit en Rust)"}),"\n",(0,s.jsx)(n.li,{children:"\ud83d\udcdd Support des Conventional Commits"}),"\n",(0,s.jsx)(n.li,{children:"\ud83c\udfa8 Hautement personnalisable"}),"\n",(0,s.jsx)(n.li,{children:"\ud83d\udd27 Int\xe9gration facile CI/CD"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"installation-rapide",children:"Installation rapide"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Linux/macOS\r\ncargo install git-cliff\r\n\r\n# Ou t\xe9l\xe9chargement direct\r\ncurl -L https://github.com/orhun/git-cliff/releases/latest/download/git-cliff-x86_64-unknown-linux-gnu.tar.gz | tar xz\r\nsudo mv git-cliff /usr/local/bin/\r\n\r\n# V\xe9rification\r\ngit-cliff --version\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration-de-base",children:"Configuration de base"}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez ",(0,s.jsx)(n.code,{children:"cliff.toml"})," \xe0 la racine de votre projet :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'[changelog]\r\nheader = """\r\n# Changelog\\n\r\nLe format est bas\xe9 sur [Keep a Changelog](https://keepachangelog.com/fr/1.0.0/).\\n\r\n"""\r\n\r\nbody = """\r\n{% if version %}\\\r\n    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}\r\n{% else %}\\\r\n    ## [Non publi\xe9]\r\n{% endif %}\\\r\n{% for group, commits in commits | group_by(attribute="group") %}\r\n    ### {{ group }}\r\n    {% for commit in commits %}\r\n        - {{ commit.message | upper_first }}{% if commit.breaking %} [**BREAKING**]{% endif %}\\\r\n    {% endfor %}\r\n{% endfor %}\\n\r\n"""\r\n\r\nfooter = """\r\n\x3c!-- generated by git-cliff --\x3e\r\n"""\r\n\r\n[git]\r\nconventional_commits = true\r\nfilter_unconventional = true\r\n\r\ncommit_parsers = [\r\n    { message = "^feat", group = "\u2728 Nouvelles fonctionnalit\xe9s" },\r\n    { message = "^fix", group = "\ud83d\udc1b Corrections de bugs" },\r\n    { message = "^doc", group = "\ud83d\udcda Documentation" },\r\n    { message = "^perf", group = "\u26a1 Performance" },\r\n    { message = "^refactor", group = "\u267b\ufe0f Refactoring" },\r\n    { message = "^test", group = "\u2705 Tests" },\r\n    { message = "^chore\\\\(release\\\\)", skip = true },\r\n    { message = "^chore", group = "\ud83d\udd27 Maintenance" },\r\n]\r\n\r\n# Liens vers GitLab\r\ncommit_preprocessors = [\r\n    { pattern = \'\\(#([0-9]+)\\)\', replace = "([#${1}](https://gitlab.com/votre-org/votre-repo/-/issues/${1}))" },\r\n    { pattern = \'\\(!([0-9]+)\\)\', replace = "([!${1}](https://gitlab.com/votre-org/votre-repo/-/merge_requests/${1}))" },\r\n]\r\n\r\nsort_commits = "oldest"\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"utilisation-quotidienne",children:"Utilisation quotidienne"}),"\n",(0,s.jsx)(n.h3,{id:"commandes-essentielles",children:"Commandes essentielles"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Voir les changements non publi\xe9s\r\ngit-cliff --unreleased\r\n\r\n# G\xe9n\xe9rer le changelog complet\r\ngit-cliff -o CHANGELOG.md\r\n\r\n# G\xe9n\xe9rer pour une nouvelle version\r\ngit-cliff --tag v1.2.0 -o CHANGELOG.md\r\n\r\n# Pr\xe9visualiser avec une future version\r\ngit-cliff --unreleased --tag v1.2.0\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"int\xe9gration-gitlab-ci",children:"Int\xe9gration GitLab CI"}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez ",(0,s.jsx)(n.code,{children:".gitlab-ci.yml"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'stages:\r\n  - release\r\n\r\nvariables:\r\n  GIT_DEPTH: 0  # Important pour l\'historique complet\r\n\r\ngenerate-changelog:\r\n  stage: release\r\n  image: rust:alpine\r\n  only:\r\n    - tags\r\n    - /^v\\d+\\.\\d+\\.\\d+$/\r\n  before_script:\r\n    - apk add --no-cache git curl\r\n    - |\r\n      curl -L https://github.com/orhun/git-cliff/releases/latest/download/git-cliff-x86_64-unknown-linux-musl.tar.gz | tar xz\r\n      mv git-cliff /usr/local/bin/\r\n      chmod +x /usr/local/bin/git-cliff\r\n  script:\r\n    - echo "\ud83d\ude80 G\xe9n\xe9ration du changelog pour $CI_COMMIT_TAG"\r\n    - git-cliff --latest --output CHANGELOG.md\r\n    - |\r\n      # Commit et push du changelog\r\n      git config user.name "GitLab CI"\r\n      git config user.email "ci@gitlab.com"\r\n      git add CHANGELOG.md\r\n      git commit -m "docs: update CHANGELOG.md for $CI_COMMIT_TAG [skip ci]" || true\r\n      git remote set-url origin https://oauth2:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_PATH}.git\r\n      git push origin HEAD:main -o ci.skip || true\r\n  artifacts:\r\n    paths:\r\n      - CHANGELOG.md\r\n    expire_in: 1 month\r\n\r\ncreate-release:\r\n  stage: release\r\n  image: registry.gitlab.com/gitlab-org/release-cli:latest\r\n  needs:\r\n    - generate-changelog\r\n  only:\r\n    - tags\r\n    - /^v\\d+\\.\\d+\\.\\d+$/\r\n  script:\r\n    - echo "\ud83d\udce6 Cr\xe9ation de la release $CI_COMMIT_TAG"\r\n  release:\r\n    name: \'Release $CI_COMMIT_TAG\'\r\n    description: \'./CHANGELOG.md\'\r\n    tag_name: \'$CI_COMMIT_TAG\'\r\n    ref: \'$CI_COMMIT_SHA\'\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"script-de-release",children:"Script de release"}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez ",(0,s.jsx)(n.code,{children:"scripts/release.sh"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\r\nset -e\r\n\r\n# Couleurs\r\nGREEN=\'\\033[0;32m\'\r\nRED=\'\\033[0;31m\'\r\nNC=\'\\033[0m\'\r\n\r\ninfo() { echo -e "${GREEN}[INFO]${NC} $1"; }\r\nerror() { echo -e "${RED}[ERROR]${NC} $1"; exit 1; }\r\n\r\n# V\xe9rifications\r\ncommand -v git-cliff &> /dev/null || error "git-cliff n\'est pas install\xe9"\r\n[[ -n $(git status -s) ]] && error "Vous avez des changements non commit\xe9s"\r\n\r\n# R\xe9cup\xe9rer la version actuelle\r\ncurrent_version=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")\r\ncurrent_version=${current_version#v}\r\n\r\ninfo "Version actuelle: $current_version"\r\n\r\n# Demander le type de release\r\necho ""\r\necho "Type de release:"\r\necho "1) major (x.0.0)"\r\necho "2) minor (0.x.0)"\r\necho "3) patch (0.0.x)"\r\nread -p "Choisissez (1-3): " release_type\r\n\r\nIFS=\'.\' read -r major minor patch <<< "$current_version"\r\n\r\ncase $release_type in\r\n    1) new_version="$((major + 1)).0.0" ;;\r\n    2) new_version="$major.$((minor + 1)).0" ;;\r\n    3) new_version="$major.$minor.$((patch + 1))" ;;\r\n    *) error "Choix invalide" ;;\r\nesac\r\n\r\ninfo "Nouvelle version: v$new_version"\r\n\r\n# Confirmation\r\nread -p "Continuer? (y/n) " -n 1 -r\r\necho\r\n[[ ! $REPLY =~ ^[Yy]$ ]] && error "Annul\xe9"\r\n\r\n# G\xe9n\xe9rer le changelog\r\ninfo "G\xe9n\xe9ration du changelog..."\r\ngit-cliff --tag "v$new_version" --output CHANGELOG.md\r\n\r\n# Aper\xe7u\r\necho ""\r\ninfo "Aper\xe7u:"\r\ngit-cliff --tag "v$new_version" --unreleased\r\necho ""\r\n\r\nread -p "Le changelog vous convient? (y/n) " -n 1 -r\r\necho\r\n[[ ! $REPLY =~ ^[Yy]$ ]] && error "Annul\xe9"\r\n\r\n# Commit et tag\r\ninfo "Commit du changelog..."\r\ngit add CHANGELOG.md\r\ngit commit -m "docs: update CHANGELOG.md for v$new_version"\r\n\r\ninfo "Cr\xe9ation du tag..."\r\ngit tag -a "v$new_version" -m "Release v$new_version"\r\n\r\ninfo "Push..."\r\ngit push origin main\r\ngit push origin "v$new_version"\r\n\r\ninfo "\u2705 Release v$new_version cr\xe9\xe9e!"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod +x scripts/release.sh\r\n./scripts/release.sh\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration-avanc\xe9e-optionnelle",children:"Configuration avanc\xe9e (optionnelle)"}),"\n",(0,s.jsx)(n.h3,{id:"pour-un-monorepo",children:"Pour un monorepo"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:'# cliff-backend.toml\r\n[git]\r\ncommit_parsers = [\r\n    { message = "^feat\\\\(backend\\\\)", group = "\u2728 Nouvelles fonctionnalit\xe9s" },\r\n    { message = "^fix\\\\(backend\\\\)", group = "\ud83d\udc1b Corrections" },\r\n]\r\ntag_pattern = "backend-v[0-9]*"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'# G\xe9n\xe9rer le changelog backend uniquement\r\ngit-cliff --config cliff-backend.toml --include-path "backend/*" -o backend/CHANGELOG.md\n'})}),"\n",(0,s.jsx)(n.h3,{id:"avec-int\xe9gration-jira",children:"Avec int\xe9gration Jira"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-toml",children:"commit_preprocessors = [\r\n    # Lier les tickets Jira\r\n    { pattern = '([A-Z]+-\\d+)', replace = \"([${1}](https://votre-jira.atlassian.net/browse/${1}))\" },\r\n    # Lier les issues GitLab\r\n    { pattern = '#(\\d+)', replace = \"([#${1}](https://gitlab.com/votre-org/votre-repo/-/issues/${1}))\" },\r\n]\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"git-hook-pour-validation-des-commits",children:"Git Hook pour validation des commits"}),"\n",(0,s.jsxs)(n.p,{children:["Cr\xe9ez ",(0,s.jsx)(n.code,{children:".git/hooks/commit-msg"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\r\n\r\ncommit_msg=$(cat "$1")\r\nconventional_regex=\'^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\\(.+\\))?: .{1,}\'\r\n\r\nif ! echo "$commit_msg" | grep -qE "$conventional_regex"; then\r\n  echo "\u274c Message de commit invalide!"\r\n  echo "Format: <type>(<scope>): <description>"\r\n  echo ""\r\n  echo "Exemples:"\r\n  echo "  feat(auth): ajout OAuth2"\r\n  echo "  fix(api): correction pagination"\r\n  exit 1\r\nfi\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod +x .git/hooks/commit-msg\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"exemples-de-messages-de-commit",children:"Exemples de messages de commit"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Nouvelles fonctionnalit\xe9s\r\nfeat: ajout de l'export PDF\r\nfeat(auth): int\xe9gration Keycloak\r\n\r\n# Corrections de bugs\r\nfix: correction du bug de pagination\r\nfix(api): gestion correcte des timeouts\r\n\r\n# Breaking changes\r\nfeat!: suppression de l'API v1\r\nBREAKING CHANGE: l'API v1 n'est plus support\xe9e\r\n\r\n# Autres types\r\ndocs: mise \xe0 jour du README\r\nchore(deps): mise \xe0 jour des d\xe9pendances\r\nrefactor: refactoring du service d'auth\r\nperf: optimisation des requ\xeates SQL\r\ntest: ajout de tests unitaires\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"no-tags-found",children:'"No tags found"'}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er un tag initial\r\ngit tag v0.1.0\r\ngit push origin v0.1.0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"commits-non-d\xe9tect\xe9s-dans-gitlab-ci",children:"Commits non d\xe9tect\xe9s dans GitLab CI"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"# Assurez-vous d'avoir dans .gitlab-ci.yml\r\nvariables:\r\n  GIT_DEPTH: 0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"tester-la-configuration",children:"Tester la configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Voir les commits qui seront inclus\r\ngit-cliff --unreleased --context | jq '.commits'\r\n\r\n# Mode dry-run\r\ngit-cliff --unreleased --dry-run\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"checklist-dint\xe9gration",children:"Checklist d'int\xe9gration"}),"\n",(0,s.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Installer git-cliff : ",(0,s.jsx)(n.code,{children:"cargo install git-cliff"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er ",(0,s.jsx)(n.code,{children:"cliff.toml"})," \xe0 la racine du projet"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Adapter les liens GitLab dans la configuration"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Ajouter le job dans ",(0,s.jsx)(n.code,{children:".gitlab-ci.yml"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er le script ",(0,s.jsx)(n.code,{children:"scripts/release.sh"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Ajouter le hook de validation des commits"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tester avec ",(0,s.jsx)(n.code,{children:"git-cliff --unreleased"})]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Former l'\xe9quipe aux Conventional Commits"]}),"\n",(0,s.jsxs)(n.li,{className:"task-list-item",children:[(0,s.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er votre premi\xe8re release : ",(0,s.jsx)(n.code,{children:"./scripts/release.sh"})]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://git-cliff.org/",children:"Documentation officielle"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://www.conventionalcommits.org/",children:"Conventional Commits"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://keepachangelog.com/fr/",children:"Keep a Changelog"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>a});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);