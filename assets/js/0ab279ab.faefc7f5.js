"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[4527],{416:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"infrastructure/iac/ansible/ansible-multicloud","title":"\u2699\ufe0f Ansible - Configuration Multi-Cloud","description":"Ansible automatise la configuration des serveurs apr\xe8s leur provisionnement par Terraform, dans une approche Infrastructure as Code compl\xe8te.","source":"@site/docs/infrastructure/iac/ansible/ansible-multicloud.md","sourceDirName":"infrastructure/iac/ansible","slug":"/infrastructure/iac/ansible/ansible-multicloud","permalink":"/docs/infrastructure/iac/ansible/ansible-multicloud","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/infrastructure/iac/ansible/ansible-multicloud.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Artifactory","permalink":"/docs/infrastructure/docker-registry/artifactory"},"next":{"title":"\ud83c\udfae AWX - Orchestration Ansible","permalink":"/docs/infrastructure/iac/ansible/awx-orchestration"}}');var i=n(4848),l=n(8453);const t={sidebar_position:1},a="\u2699\ufe0f Ansible - Configuration Multi-Cloud",o={},c=[{value:"\ud83c\udfaf Ansible dans l&#39;\xe9cosyst\xe8me DevSecOps",id:"-ansible-dans-l\xe9cosyst\xe8me-devsecops",level:2},{value:"\ud83d\udca1 Concept : S\xe9paration des responsabilit\xe9s",id:"-concept--s\xe9paration-des-responsabilit\xe9s",level:2},{value:"\ud83d\udd27 Terraform \u2192 Provisionner",id:"-terraform--provisionner",level:3},{value:"\u2699\ufe0f Ansible \u2192 Configurer",id:"\ufe0f-ansible--configurer",level:3},{value:"\ud83d\ude80 CI/CD \u2192 D\xe9ployer",id:"-cicd--d\xe9ployer",level:3},{value:"\ud83d\udcc1 Structure projet int\xe9gr\xe9e",id:"-structure-projet-int\xe9gr\xe9e",level:2},{value:"\ud83c\udf0d Multi-Cloud avec Ansible",id:"-multi-cloud-avec-ansible",level:2},{value:"Approche : Inventories par cloud provider",id:"approche--inventories-par-cloud-provider",level:3},{value:"Playbooks cloud-agnostic",id:"playbooks-cloud-agnostic",level:3},{value:"\ud83d\udd04 Int\xe9gration avec CI/CD GitLab",id:"-int\xe9gration-avec-cicd-gitlab",level:2},{value:"Pipeline GitLab CI complet",id:"pipeline-gitlab-ci-complet",level:3},{value:"Workflow complet",id:"workflow-complet",level:3},{value:"\ud83c\udfad Cas d&#39;usage : D\xe9ploiement multi-r\xe9gion",id:"-cas-dusage--d\xe9ploiement-multi-r\xe9gion",level:2},{value:"Sc\xe9nario",id:"sc\xe9nario",level:3},{value:"Solution avec Ansible",id:"solution-avec-ansible",level:3},{value:"\ud83d\udd12 S\xe9curit\xe9 et Secrets",id:"-s\xe9curit\xe9-et-secrets",level:2},{value:"Ansible Vault pour les secrets",id:"ansible-vault-pour-les-secrets",level:3},{value:"Int\xe9gration HashiCorp Vault",id:"int\xe9gration-hashicorp-vault",level:3},{value:"\ud83d\udcca Monitoring de l&#39;ex\xe9cution Ansible",id:"-monitoring-de-lex\xe9cution-ansible",level:2},{value:"Callbacks pour logs structur\xe9s",id:"callbacks-pour-logs-structur\xe9s",level:3},{value:"Int\xe9gration avec GitLab CI",id:"int\xe9gration-avec-gitlab-ci",level:3},{value:"\ud83c\udfaf Bonnes pratiques",id:"-bonnes-pratiques",level:2},{value:"\u2705 \xc0 faire",id:"-\xe0-faire",level:3},{value:"\u274c \xc0 \xe9viter",id:"-\xe0-\xe9viter",level:3},{value:"\ud83d\ude80 Exemple complet : Bootstrap infrastructure",id:"-exemple-complet--bootstrap-infrastructure",level:2},{value:"\ud83d\udcc8 R\xe9sum\xe9 de la cha\xeene compl\xe8te",id:"-r\xe9sum\xe9-de-la-cha\xeene-compl\xe8te",level:2}];function d(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"\ufe0f-ansible---configuration-multi-cloud",children:"\u2699\ufe0f Ansible - Configuration Multi-Cloud"})}),"\n",(0,i.jsxs)(r.p,{children:["Ansible automatise la configuration des serveurs apr\xe8s leur provisionnement par Terraform, dans une approche ",(0,i.jsx)(r.strong,{children:"Infrastructure as Code"})," compl\xe8te."]}),"\n",(0,i.jsx)(r.h2,{id:"-ansible-dans-l\xe9cosyst\xe8me-devsecops",children:"\ud83c\udfaf Ansible dans l'\xe9cosyst\xe8me DevSecOps"}),"\n",(0,i.jsx)(r.mermaid,{value:'graph TB\r\n    subgraph "Phase 1: Provisionnement"\r\n        TF[\ud83d\udce6 Terraform]\r\n        AWS[\u2601\ufe0f AWS]\r\n        AZURE[\u2601\ufe0f Azure]\r\n        GCP[\u2601\ufe0f GCP]\r\n        SECNUM[\ud83d\udd12 SecNumCloud]\r\n    end\r\n    \r\n    subgraph "Phase 2: Configuration"\r\n        ANSIBLE[\u2699\ufe0f Ansible]\r\n        PLAYBOOKS[\ud83d\udcdd Playbooks]\r\n        ROLES[\ud83c\udfad Roles]\r\n    end\r\n    \r\n    subgraph "Phase 3: D\xe9ploiement Apps"\r\n        CICD[\ud83d\udd04 GitLab CI]\r\n        JAVA[\u2615 Java]\r\n        DRUPAL[\ud83d\udd37 Drupal]\r\n        ANGULAR[\ud83c\udd70\ufe0f Angular]\r\n    end\r\n    \r\n    subgraph "Phase 4: Monitoring"\r\n        PROM[\ud83d\udcca Prometheus]\r\n        GRAF[\ud83d\udcc8 Grafana]\r\n    end\r\n    \r\n    TF --\x3e AWS\r\n    TF --\x3e AZURE\r\n    TF --\x3e GCP\r\n    TF --\x3e SECNUM\r\n    \r\n    AWS --\x3e ANSIBLE\r\n    AZURE --\x3e ANSIBLE\r\n    GCP --\x3e ANSIBLE\r\n    SECNUM --\x3e ANSIBLE\r\n    \r\n    ANSIBLE --\x3e PLAYBOOKS\r\n    ANSIBLE --\x3e ROLES\r\n    \r\n    PLAYBOOKS --\x3e CICD\r\n    ROLES --\x3e CICD\r\n    \r\n    CICD --\x3e JAVA\r\n    CICD --\x3e DRUPAL\r\n    CICD --\x3e ANGULAR\r\n    \r\n    JAVA --\x3e PROM\r\n    DRUPAL --\x3e PROM\r\n    ANGULAR --\x3e PROM\r\n    PROM --\x3e GRAF'}),"\n",(0,i.jsx)(r.h2,{id:"-concept--s\xe9paration-des-responsabilit\xe9s",children:"\ud83d\udca1 Concept : S\xe9paration des responsabilit\xe9s"}),"\n",(0,i.jsx)(r.h3,{id:"-terraform--provisionner",children:"\ud83d\udd27 Terraform \u2192 Provisionner"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"R\xf4le"})," : Cr\xe9er l'infrastructure cloud"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"VPC, subnets, security groups"}),"\n",(0,i.jsx)(r.li,{children:"Instances EC2, VMs Azure, Compute Engine GCP"}),"\n",(0,i.jsx)(r.li,{children:"Load balancers, databases manag\xe9es"}),"\n",(0,i.jsx)(r.li,{children:"Stockage S3, Azure Blob, GCS"}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Sortie Terraform"})," \u2192 Inventory Ansible"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-hcl",children:'# Terraform g\xe9n\xe8re automatiquement l\'inventory Ansible\r\noutput "ansible_inventory" {\r\n  value = {\r\n    webservers = aws_instance.web[*].public_ip\r\n    databases  = aws_instance.db[*].private_ip\r\n    cache      = aws_instance.redis[*].private_ip\r\n  }\r\n}\n'})}),"\n",(0,i.jsx)(r.h3,{id:"\ufe0f-ansible--configurer",children:"\u2699\ufe0f Ansible \u2192 Configurer"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"R\xf4le"})," : Configurer les serveurs provisionn\xe9s"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Installation packages (Nginx, PostgreSQL, Redis)"}),"\n",(0,i.jsx)(r.li,{children:"Configuration syst\xe8me (firewall, users, SSH)"}),"\n",(0,i.jsx)(r.li,{children:"Hardening s\xe9curit\xe9 (fail2ban, SELinux)"}),"\n",(0,i.jsx)(r.li,{children:"Monitoring agents (Prometheus exporters)"}),"\n"]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Ex\xe9cution"})," : Juste apr\xe8s Terraform"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# 1. Terraform cr\xe9e les serveurs\r\nterraform apply\r\n\r\n# 2. Ansible les configure\r\nansible-playbook -i inventory/production playbooks/site.yml\r\n\r\n# 3. CI/CD d\xe9ploie les applications\n"})}),"\n",(0,i.jsx)(r.h3,{id:"-cicd--d\xe9ployer",children:"\ud83d\ude80 CI/CD \u2192 D\xe9ployer"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"R\xf4le"})," : D\xe9ployer les applications m\xe9tier"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Build des artefacts (JAR, images Docker)"}),"\n",(0,i.jsx)(r.li,{children:"D\xe9ploiement sur Kubernetes"}),"\n",(0,i.jsx)(r.li,{children:"Rolling updates"}),"\n",(0,i.jsx)(r.li,{children:"Health checks"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"-structure-projet-int\xe9gr\xe9e",children:"\ud83d\udcc1 Structure projet int\xe9gr\xe9e"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"infrastructure/\r\n\u251c\u2500\u2500 terraform/                    # Phase 1: Provisionnement\r\n\u2502   \u251c\u2500\u2500 aws/\r\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\r\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf          # \u2192 G\xe9n\xe8re inventory Ansible\r\n\u2502   \u251c\u2500\u2500 azure/\r\n\u2502   \u2514\u2500\u2500 gcp/\r\n\u2502\r\n\u251c\u2500\u2500 ansible/                      # Phase 2: Configuration\r\n\u2502   \u251c\u2500\u2500 inventory/\r\n\u2502   \u2502   \u251c\u2500\u2500 production.yml      # \u2190 G\xe9n\xe9r\xe9 par Terraform\r\n\u2502   \u2502   \u2514\u2500\u2500 group_vars/\r\n\u2502   \u251c\u2500\u2500 playbooks/\r\n\u2502   \u2502   \u251c\u2500\u2500 site.yml            # Configure tout\r\n\u2502   \u2502   \u2514\u2500\u2500 bootstrap.yml       # Premier d\xe9marrage\r\n\u2502   \u2514\u2500\u2500 roles/\r\n\u2502       \u251c\u2500\u2500 common/             # Packages de base\r\n\u2502       \u251c\u2500\u2500 nginx/              # Web servers\r\n\u2502       \u251c\u2500\u2500 postgresql/         # Databases\r\n\u2502       \u2514\u2500\u2500 monitoring/         # Prometheus exporters\r\n\u2502\r\n\u2514\u2500\u2500 applications/                 # Phase 3: Applications\r\n    \u251c\u2500\u2500 java-app/\r\n    \u2502   \u2514\u2500\u2500 .gitlab-ci.yml      # Pipeline CI/CD\r\n    \u251c\u2500\u2500 drupal-site/\r\n    \u2502   \u2514\u2500\u2500 .gitlab-ci.yml\r\n    \u2514\u2500\u2500 angular-app/\r\n        \u2514\u2500\u2500 .gitlab-ci.yml\n"})}),"\n",(0,i.jsx)(r.h2,{id:"-multi-cloud-avec-ansible",children:"\ud83c\udf0d Multi-Cloud avec Ansible"}),"\n",(0,i.jsx)(r.h3,{id:"approche--inventories-par-cloud-provider",children:"Approche : Inventories par cloud provider"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="inventory/aws-production.yml"',children:"all:\r\n  children:\r\n    aws_webservers:\r\n      hosts:\r\n        web01-aws: {ansible_host: 10.0.1.10}\r\n        web02-aws: {ansible_host: 10.0.1.11}\r\n      vars:\r\n        cloud_provider: aws\r\n        region: eu-west-1\r\n\r\n    aws_databases:\r\n      hosts:\r\n        db01-aws: {ansible_host: 10.0.2.10}\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="inventory/azure-production.yml"',children:"all:\r\n  children:\r\n    azure_webservers:\r\n      hosts:\r\n        web01-azure: {ansible_host: 10.1.1.10}\r\n        web02-azure: {ansible_host: 10.1.1.11}\r\n      vars:\r\n        cloud_provider: azure\r\n        region: westeurope\n"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="inventory/secnumcloud-production.yml"',children:"all:\r\n  children:\r\n    secnum_webservers:\r\n      hosts:\r\n        web01-secnum: {ansible_host: 10.2.1.10}\r\n      vars:\r\n        cloud_provider: secnumcloud\r\n        compliance: qualifi\xe9\n"})}),"\n",(0,i.jsx)(r.h3,{id:"playbooks-cloud-agnostic",children:"Playbooks cloud-agnostic"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="playbooks/site.yml"',children:'---\r\n# Configure TOUS les serveurs (AWS + Azure + GCP + SecNumCloud)\r\n- name: Configure all servers\r\n  hosts: all\r\n  roles:\r\n    - common              # Installation de base (identique partout)\r\n    - security           # Hardening (identique partout)\r\n    - monitoring         # Exporters Prometheus\r\n\r\n- name: Configure web servers\r\n  hosts: "*_webservers"   # Toutes les VMs web de tous les clouds\r\n  roles:\r\n    - nginx\r\n\r\n- name: Configure databases\r\n  hosts: "*_databases"\r\n  roles:\r\n    - postgresql\n'})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Avantage"})," : Le m\xeame playbook fonctionne sur tous les clouds ! \ud83c\udfaf"]}),"\n",(0,i.jsx)(r.h2,{id:"-int\xe9gration-avec-cicd-gitlab",children:"\ud83d\udd04 Int\xe9gration avec CI/CD GitLab"}),"\n",(0,i.jsx)(r.h3,{id:"pipeline-gitlab-ci-complet",children:"Pipeline GitLab CI complet"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title=".gitlab-ci.yml"',children:"stages:\r\n  - provision      # Terraform\r\n  - configure      # Ansible\r\n  - deploy         # Application\r\n\r\n# Stage 1: Terraform provisionne\r\nprovision:infrastructure:\r\n  stage: provision\r\n  image: hashicorp/terraform:latest\r\n  script:\r\n    - cd terraform/aws\r\n    - terraform init\r\n    - terraform apply -auto-approve\r\n    - terraform output -json > ../../ansible-inventory.json\r\n  artifacts:\r\n    paths:\r\n      - ansible-inventory.json\r\n\r\n# Stage 2: Ansible configure\r\nconfigure:servers:\r\n  stage: configure\r\n  image: cytopia/ansible:latest\r\n  dependencies:\r\n    - provision:infrastructure\r\n  script:\r\n    - cd ansible\r\n    - ansible-playbook -i ../ansible-inventory.json playbooks/site.yml\r\n  only:\r\n    - main\r\n\r\n# Stage 3: D\xe9ploiement application\r\ndeploy:java:\r\n  stage: deploy\r\n  image: bitnami/kubectl:latest\r\n  script:\r\n    - kubectl set image deployment/my-app app=registry.com/my-app:$CI_COMMIT_SHA\r\n  only:\r\n    - main\n"})}),"\n",(0,i.jsx)(r.h3,{id:"workflow-complet",children:"Workflow complet"}),"\n",(0,i.jsx)(r.mermaid,{value:"sequenceDiagram\r\n    participant Dev as \ud83d\udc68\u200d\ud83d\udcbb D\xe9veloppeur\r\n    participant Git as \ud83d\udce6 GitLab\r\n    participant TF as \ud83c\udfd7\ufe0f Terraform\r\n    participant Cloud as \u2601\ufe0f AWS/Azure/GCP\r\n    participant Ansible as \u2699\ufe0f Ansible\r\n    participant App as \ud83d\ude80 Application\r\n    \r\n    Dev->>Git: git push\r\n    Git->>TF: Stage 1: Provision\r\n    TF->>Cloud: Create VMs\r\n    Cloud--\x3e>TF: IPs des serveurs\r\n    TF->>Git: G\xe9n\xe8re inventory.json\r\n    \r\n    Git->>Ansible: Stage 2: Configure\r\n    Ansible->>Cloud: SSH vers VMs\r\n    Ansible->>Cloud: Install Nginx, PostgreSQL...\r\n    Cloud--\x3e>Ansible: Serveurs configur\xe9s\r\n    \r\n    Git->>App: Stage 3: Deploy\r\n    App->>Cloud: Deploy app sur K8s\r\n    Cloud--\x3e>Dev: \u2705 Done!"}),"\n",(0,i.jsx)(r.h2,{id:"-cas-dusage--d\xe9ploiement-multi-r\xe9gion",children:"\ud83c\udfad Cas d'usage : D\xe9ploiement multi-r\xe9gion"}),"\n",(0,i.jsx)(r.h3,{id:"sc\xe9nario",children:"Sc\xe9nario"}),"\n",(0,i.jsx)(r.p,{children:"D\xe9ployer la m\xeame stack Java sur 3 clouds simultan\xe9ment :"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"AWS eu-west-1"})," : Production Europe"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Azure westeurope"})," : Backup Europe"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"GCP us-central1"})," : Production US"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"solution-avec-ansible",children:"Solution avec Ansible"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="playbooks/deploy-multicloud.yml"',children:'---\r\n- name: Deploy on ALL clouds\r\n  hosts: all\r\n  serial: "30%"           # 30% des serveurs \xe0 la fois\r\n  max_fail_percentage: 10  # Stop si >10% d\'\xe9checs\r\n  \r\n  pre_tasks:\r\n    - name: Health check avant d\xe9ploiement\r\n      uri:\r\n        url: http://localhost:8080/health\r\n      register: health\r\n      \r\n  roles:\r\n    - java-deployment\r\n    \r\n  post_tasks:\r\n    - name: Smoke test apr\xe8s d\xe9ploiement\r\n      uri:\r\n        url: http://localhost:8080/actuator/health\r\n        status_code: 200\n'})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Commande"})," :"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# D\xe9ploie sur les 3 clouds en parall\xe8le\r\nansible-playbook playbooks/deploy-multicloud.yml \\\r\n  -i inventory/aws-production.yml \\\r\n  -i inventory/azure-production.yml \\\r\n  -i inventory/gcp-production.yml\n"})}),"\n",(0,i.jsx)(r.h2,{id:"-s\xe9curit\xe9-et-secrets",children:"\ud83d\udd12 S\xe9curit\xe9 et Secrets"}),"\n",(0,i.jsx)(r.h3,{id:"ansible-vault-pour-les-secrets",children:"Ansible Vault pour les secrets"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="group_vars/all/vault.yml"',children:'# Fichier chiffr\xe9 avec ansible-vault\r\n---\r\nvault_db_password: "SuperSecret123"\r\nvault_api_key: "sk-1234567890abcdef"\r\nvault_ssh_private_key: |\r\n  -----BEGIN RSA PRIVATE KEY-----\r\n  ...\r\n  -----END RSA PRIVATE KEY-----\n'})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:'# Chiffrer le fichier\r\nansible-vault encrypt group_vars/all/vault.yml\r\n\r\n# Utiliser dans les playbooks\r\nansible-playbook site.yml --ask-vault-pass\r\n\r\n# Ou avec un fichier de mot de passe\r\necho "my-vault-password" > .vault_pass\r\nansible-playbook site.yml --vault-password-file .vault_pass\n'})}),"\n",(0,i.jsx)(r.h3,{id:"int\xe9gration-hashicorp-vault",children:"Int\xe9gration HashiCorp Vault"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"- name: Get secrets from Vault\r\n  set_fact:\r\n    db_password: \"{{ lookup('hashi_vault', 'secret=secret/db/password') }}\"\r\n    api_key: \"{{ lookup('hashi_vault', 'secret=secret/api/key') }}\"\n"})}),"\n",(0,i.jsx)(r.h2,{id:"-monitoring-de-lex\xe9cution-ansible",children:"\ud83d\udcca Monitoring de l'ex\xe9cution Ansible"}),"\n",(0,i.jsx)(r.h3,{id:"callbacks-pour-logs-structur\xe9s",children:"Callbacks pour logs structur\xe9s"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-ini",metastring:'title="ansible.cfg"',children:"[defaults]\r\n# Logs JSON pour parsing\r\nstdout_callback = json\r\n# Profiling des t\xe2ches lentes\r\ncallback_whitelist = profile_tasks, timer\r\n# Log vers fichier\r\nlog_path = /var/log/ansible/ansible.log\n"})}),"\n",(0,i.jsx)(r.h3,{id:"int\xe9gration-avec-gitlab-ci",children:"Int\xe9gration avec GitLab CI"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",children:"configure:servers:\r\n  script:\r\n    - ansible-playbook site.yml --diff | tee ansible-output.log\r\n    - cat ansible-output.log\r\n  artifacts:\r\n    when: always\r\n    paths:\r\n      - ansible-output.log\r\n    reports:\r\n      junit: ansible-junit.xml\n"})}),"\n",(0,i.jsx)(r.h2,{id:"-bonnes-pratiques",children:"\ud83c\udfaf Bonnes pratiques"}),"\n",(0,i.jsx)(r.h3,{id:"-\xe0-faire",children:"\u2705 \xc0 faire"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Pratique"}),(0,i.jsx)(r.th,{children:"Pourquoi"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Idempotence"})}),(0,i.jsx)(r.td,{children:"Rejouer le playbook n'a pas d'effet de bord"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Variables par environnement"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"group_vars/production/"}),", ",(0,i.jsx)(r.code,{children:"group_vars/staging/"})]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Roles r\xe9utilisables"})}),(0,i.jsx)(r.td,{children:"Un r\xf4le = une responsabilit\xe9"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Tags"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:'--tags "nginx,security"'})," pour ex\xe9cutions partielles"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Dry-run"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"--check --diff"})," avant la vraie ex\xe9cution"]})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Version des r\xf4les"})}),(0,i.jsxs)(r.td,{children:[(0,i.jsx)(r.code,{children:"requirements.yml"})," pour les d\xe9pendances"]})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"-\xe0-\xe9viter",children:"\u274c \xc0 \xe9viter"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Anti-pattern"}),(0,i.jsx)(r.th,{children:"Probl\xe8me"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsxs)(r.td,{children:["Commandes ",(0,i.jsx)(r.code,{children:"shell"})," partout"]}),(0,i.jsx)(r.td,{children:"Pas idempotent, difficile \xe0 maintenir"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Secrets en clair"}),(0,i.jsx)(r.td,{children:"Toujours utiliser Ansible Vault"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Playbooks monolithiques"}),(0,i.jsx)(r.td,{children:"Difficile \xe0 tester et r\xe9utiliser"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"Pas de rollback"}),(0,i.jsx)(r.td,{children:"Pr\xe9voir un playbook de rollback"})]})]})]}),"\n",(0,i.jsx)(r.h2,{id:"-exemple-complet--bootstrap-infrastructure",children:"\ud83d\ude80 Exemple complet : Bootstrap infrastructure"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-yaml",metastring:'title="playbooks/bootstrap.yml"',children:"---\r\n# Ce playbook est lanc\xe9 APR\xc8S Terraform et AVANT les apps\r\n- name: Bootstrap all new servers\r\n  hosts: all\r\n  become: yes\r\n  \r\n  tasks:\r\n    # 1. Packages de base\r\n    - name: Update system\r\n      apt:\r\n        update_cache: yes\r\n        upgrade: dist\r\n        \r\n    - name: Install base packages\r\n      apt:\r\n        name:\r\n          - vim\r\n          - curl\r\n          - git\r\n          - htop\r\n          - fail2ban\r\n        state: present\r\n        \r\n    # 2. Utilisateurs et SSH\r\n    - name: Create deployment user\r\n      user:\r\n        name: deploy\r\n        shell: /bin/bash\r\n        groups: sudo\r\n        \r\n    - name: Disable password authentication\r\n      lineinfile:\r\n        path: /etc/ssh/sshd_config\r\n        regexp: '^PasswordAuthentication'\r\n        line: 'PasswordAuthentication no'\r\n      notify: restart sshd\r\n        \r\n    # 3. Monitoring\r\n    - name: Install node_exporter\r\n      include_role:\r\n        name: prometheus.prometheus.node_exporter\r\n        \r\n  handlers:\r\n    - name: restart sshd\r\n      service:\r\n        name: sshd\r\n        state: restarted\n"})}),"\n",(0,i.jsx)(r.h2,{id:"-r\xe9sum\xe9-de-la-cha\xeene-compl\xe8te",children:"\ud83d\udcc8 R\xe9sum\xe9 de la cha\xeene compl\xe8te"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"\xc9tape"}),(0,i.jsx)(r.th,{children:"Outil"}),(0,i.jsx)(r.th,{children:"Responsabilit\xe9"}),(0,i.jsx)(r.th,{children:"R\xe9sultat"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"1\ufe0f\u20e3"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Terraform"})}),(0,i.jsx)(r.td,{children:"Provisionner VMs"}),(0,i.jsx)(r.td,{children:"Serveurs vides avec OS"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"2\ufe0f\u20e3"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Ansible"})}),(0,i.jsx)(r.td,{children:"Configurer serveurs"}),(0,i.jsx)(r.td,{children:"Serveurs pr\xeats pour apps"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"3\ufe0f\u20e3"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"GitLab CI"})}),(0,i.jsx)(r.td,{children:"D\xe9ployer applications"}),(0,i.jsx)(r.td,{children:"Apps running en production"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"4\ufe0f\u20e3"}),(0,i.jsx)(r.td,{children:(0,i.jsx)(r.strong,{children:"Prometheus"})}),(0,i.jsx)(r.td,{children:"Monitorer"}),(0,i.jsx)(r.td,{children:"Dashboards et alertes"})]})]})]}),"\n",(0,i.jsx)(r.hr,{}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Ansible est le pont entre l'infrastructure (Terraform) et les applications (CI/CD) ! \ud83c\udf09"})})]})}function u(e={}){const{wrapper:r}={...(0,l.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>a});var s=n(6540);const i={},l=s.createContext(i);function t(e){const r=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:r},e.children)}}}]);