"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[6076],{1249:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"infrastructure/docker-registry/harbor","title":"\ud83d\udc33 Harbor - Enterprise Container Registry","description":"Harbor est un registry Docker enterprise open-source avec scanning de s\xe9curit\xe9, gestion des acc\xe8s, et r\xe9plication.","source":"@site/docs/infrastructure/docker-registry/harbor.md","sourceDirName":"infrastructure/docker-registry","slug":"/infrastructure/docker-registry/harbor","permalink":"/docs/infrastructure/docker-registry/harbor","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/infrastructure/docker-registry/harbor.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Infrastructure","permalink":"/docs/infrastructure/"},"next":{"title":"Docker hub","permalink":"/docs/infrastructure/docker-registry/docker-hub"}}');var t=r(4848),s=r(8453);const i={sidebar_position:1},o="\ud83d\udc33 Harbor - Enterprise Container Registry",c={},l=[{value:"\ud83c\udfaf Architecture Harbor",id:"-architecture-harbor",level:2},{value:"\ud83d\ude80 Installation Harbor",id:"-installation-harbor",level:2},{value:"Docker Compose (Dev/Test)",id:"docker-compose-devtest",level:3},{value:"Installation avec Helm (Production)",id:"installation-avec-helm-production",level:3},{value:"\ud83d\udd10 Configuration S\xe9curit\xe9",id:"-configuration-s\xe9curit\xe9",level:2},{value:"1. Configuration Projets",id:"1-configuration-projets",level:3},{value:"2. Security Policies",id:"2-security-policies",level:3},{value:"3. Robot Accounts",id:"3-robot-accounts",level:3},{value:"\ud83d\udd04 Int\xe9gration CI/CD",id:"-int\xe9gration-cicd",level:2},{value:"GitHub Actions",id:"github-actions",level:3},{value:"\ud83d\udcca Replication",id:"-replication",level:2},{value:"Configuration Multi-site",id:"configuration-multi-site",level:3},{value:"\ud83d\udcc8 Monitoring Harbor",id:"-monitoring-harbor",level:2},{value:"Prometheus Metrics",id:"prometheus-metrics",level:3},{value:"Grafana Dashboard",id:"grafana-dashboard",level:3},{value:"\ud83d\udd27 Administration",id:"-administration",level:2},{value:"Garbage Collection",id:"garbage-collection",level:3},{value:"Backup",id:"backup",level:3},{value:"\ud83c\udfaf Best Practices",id:"-best-practices",level:2},{value:"\ud83d\udcda Ressources",id:"-ressources",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"-harbor---enterprise-container-registry",children:"\ud83d\udc33 Harbor - Enterprise Container Registry"})}),"\n",(0,t.jsx)(e.p,{children:"Harbor est un registry Docker enterprise open-source avec scanning de s\xe9curit\xe9, gestion des acc\xe8s, et r\xe9plication."}),"\n",(0,t.jsx)(e.h2,{id:"-architecture-harbor",children:"\ud83c\udfaf Architecture Harbor"}),"\n",(0,t.jsx)(e.mermaid,{value:'graph TB\n    subgraph "D\xe9veloppeurs"\n        DEV1[\ud83d\udc68\u200d\ud83d\udcbb Dev Java]\n        DEV2[\ud83d\udc69\u200d\ud83d\udcbb Dev Drupal]\n        DEV3[\ud83e\uddd1\u200d\ud83d\udcbb Dev Angular]\n    end\n    \n    subgraph "CI/CD Pipeline"\n        GHA[GitHub Actions]\n        BUILD[\ud83d\udd28 Docker Build]\n        SCAN[\ud83d\udd0d Trivy Scan]\n        SIGN[\u270d\ufe0f Cosign Sign]\n    end\n    \n    subgraph "Harbor Registry"\n        direction TB\n        HARBOR[\ud83c\udfdb\ufe0f Harbor Core]\n        \n        subgraph "Projects"\n            PROJ_JAVA[\u2615 java-apps]\n            PROJ_DRUPAL[\ud83d\udd37 drupal-apps]\n            PROJ_ANGULAR[\ud83c\udd70\ufe0f angular-apps]\n            PROJ_BASE[\ud83d\udce6 base-images]\n        end\n        \n        subgraph "Security"\n            TRIVY_HARBOR[\ud83d\udd0d Trivy Scanner]\n            COSIGN_VERIFY[\u2705 Signature Verification]\n            POLICIES[\ud83d\udccb Security Policies]\n        end\n        \n        subgraph "Storage"\n            S3[\u2601\ufe0f S3/MinIO]\n            CACHE[\u26a1 Cache Layer]\n        end\n    end\n    \n    subgraph "Deployment Targets"\n        K8S_DEV[\u2638\ufe0f K8s Dev]\n        K8S_STAGING[\u2638\ufe0f K8s Staging]\n        K8S_PROD[\u2638\ufe0f K8s Production]\n    end\n    \n    subgraph "Replication"\n        HARBOR_DR[\ud83c\udfdb\ufe0f Harbor DR Site]\n        HARBOR_EDGE[\ud83c\udfdb\ufe0f Harbor Edge]\n    end\n    \n    DEV1 --\x3e GHA\n    DEV2 --\x3e GHA\n    DEV3 --\x3e GHA\n    \n    GHA --\x3e BUILD\n    BUILD --\x3e SCAN\n    SCAN --\x3e SIGN\n    SIGN --\x3e HARBOR\n    \n    HARBOR --\x3e PROJ_JAVA\n    HARBOR --\x3e PROJ_DRUPAL\n    HARBOR --\x3e PROJ_ANGULAR\n    HARBOR --\x3e PROJ_BASE\n    \n    HARBOR --\x3e TRIVY_HARBOR\n    HARBOR --\x3e COSIGN_VERIFY\n    HARBOR --\x3e POLICIES\n    \n    HARBOR --\x3e S3\n    HARBOR --\x3e CACHE\n    \n    PROJ_JAVA --\x3e K8S_DEV\n    PROJ_JAVA --\x3e K8S_STAGING\n    PROJ_JAVA --\x3e K8S_PROD\n    \n    PROJ_DRUPAL --\x3e K8S_DEV\n    PROJ_DRUPAL --\x3e K8S_STAGING\n    PROJ_DRUPAL --\x3e K8S_PROD\n    \n    PROJ_ANGULAR --\x3e K8S_DEV\n    PROJ_ANGULAR --\x3e K8S_STAGING\n    PROJ_ANGULAR --\x3e K8S_PROD\n    \n    HARBOR -.Replication.-> HARBOR_DR\n    HARBOR -.Replication.-> HARBOR_EDGE\n    \n    style HARBOR fill:#326CE5,color:#fff\n    style TRIVY_HARBOR fill:#4B0082,color:#fff\n    style K8S_PROD fill:#326CE5,color:#fff'}),"\n",(0,t.jsx)(e.h2,{id:"-installation-harbor",children:"\ud83d\ude80 Installation Harbor"}),"\n",(0,t.jsx)(e.h3,{id:"docker-compose-devtest",children:"Docker Compose (Dev/Test)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",metastring:'title="docker-compose-harbor.yml"',children:'version: \'3.8\'\n\nservices:\n  # Harbor Registry\n  registry:\n    image: goharbor/registry-photon:v2.9.0\n    container_name: registry\n    restart: always\n    volumes:\n      - ./harbor/data:/storage\n    networks:\n      - harbor\n    environment:\n      - REGISTRY_HTTP_SECRET=changeme\n\n  # Harbor Portal (UI)\n  portal:\n    image: goharbor/harbor-portal:v2.9.0\n    container_name: harbor-portal\n    restart: always\n    depends_on:\n      - core\n    networks:\n      - harbor\n\n  # Harbor Core\n  core:\n    image: goharbor/harbor-core:v2.9.0\n    container_name: harbor-core\n    restart: always\n    depends_on:\n      - registry\n      - redis\n      - postgresql\n    networks:\n      - harbor\n    environment:\n      - CORE_SECRET=changeme\n      - JOBSERVICE_SECRET=changeme\n      - DATABASE_TYPE=postgresql\n      - POSTGRESQL_HOST=postgresql\n      - POSTGRESQL_PORT=5432\n      - POSTGRESQL_USERNAME=postgres\n      - POSTGRESQL_PASSWORD=changeme\n      - POSTGRESQL_DATABASE=registry\n      - REGISTRY_CONTROLLER_URL=http://registry:5000\n    volumes:\n      - ./harbor/config:/etc/core\n      - ./harbor/ca:/etc/core/ca\n\n  # Job Service\n  jobservice:\n    image: goharbor/harbor-jobservice:v2.9.0\n    container_name: harbor-jobservice\n    restart: always\n    depends_on:\n      - core\n    networks:\n      - harbor\n    environment:\n      - CORE_SECRET=changeme\n      - JOBSERVICE_SECRET=changeme\n      - CORE_URL=http://core:8080\n\n  # Redis\n  redis:\n    image: goharbor/redis-photon:v2.9.0\n    container_name: harbor-redis\n    restart: always\n    networks:\n      - harbor\n\n  # PostgreSQL\n  postgresql:\n    image: goharbor/harbor-db:v2.9.0\n    container_name: harbor-db\n    restart: always\n    networks:\n      - harbor\n    environment:\n      - POSTGRES_PASSWORD=changeme\n    volumes:\n      - ./harbor/database:/var/lib/postgresql/data\n\n  # Trivy Adapter (Scanning)\n  trivy-adapter:\n    image: goharbor/trivy-adapter-photon:v2.9.0\n    container_name: trivy-adapter\n    restart: always\n    depends_on:\n      - redis\n    networks:\n      - harbor\n    environment:\n      - SCANNER_REDIS_URL=redis://redis:6379\n      - SCANNER_TRIVY_CACHE_DIR=/home/scanner/.cache/trivy\n\n  # Nginx (Reverse Proxy)\n  nginx:\n    image: goharbor/nginx-photon:v2.9.0\n    container_name: harbor-nginx\n    restart: always\n    depends_on:\n      - core\n      - portal\n    ports:\n      - "80:8080"\n      - "443:8443"\n    networks:\n      - harbor\n    volumes:\n      - ./harbor/nginx:/etc/nginx:ro\n\nnetworks:\n  harbor:\n    external: false\n\nvolumes:\n  harbor-data:\n  harbor-database:\n'})}),"\n",(0,t.jsx)(e.h3,{id:"installation-avec-helm-production",children:"Installation avec Helm (Production)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Ajouter le repo Harbor\nhelm repo add harbor https://helm.goharbor.io\nhelm repo update\n\n# Cr\xe9er le namespace\nkubectl create namespace harbor\n"})}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",metastring:'title="harbor-values.yaml"',children:'# Harbor Helm Values pour Production\n\nexpose:\n  type: ingress\n  tls:\n    enabled: true\n    certSource: secret\n    secret:\n      secretName: harbor-tls\n      notarySecretName: notary-tls\n  ingress:\n    hosts:\n      core: harbor.example.com\n      notary: notary.example.com\n    className: nginx\n    annotations:\n      cert-manager.io/cluster-issuer: "letsencrypt-prod"\n      nginx.ingress.kubernetes.io/ssl-redirect: "true"\n      nginx.ingress.kubernetes.io/proxy-body-size: "0"\n\nexternalURL: https://harbor.example.com\n\n# Persistence\npersistence:\n  enabled: true\n  resourcePolicy: "keep"\n  persistentVolumeClaim:\n    registry:\n      storageClass: "gp3"\n      size: 500Gi\n    jobservice:\n      storageClass: "gp3"\n      size: 10Gi\n    database:\n      storageClass: "gp3"\n      size: 100Gi\n    redis:\n      storageClass: "gp3"\n      size: 10Gi\n    trivy:\n      storageClass: "gp3"\n      size: 20Gi\n\n# Image pull secret\nimagePullPolicy: IfNotPresent\n\n# Admin credentials\nharborAdminPassword: "ChangeMe123!"\n\n# S3 Storage (recommand\xe9 pour production)\nimageChartStorage:\n  type: s3\n  s3:\n    region: eu-west-1\n    bucket: harbor-registry-prod\n    accesskey: AWS_ACCESS_KEY\n    secretkey: AWS_SECRET_KEY\n    regionendpoint: https://s3.eu-west-1.amazonaws.com\n    encrypt: true\n    secure: true\n\n# Database (externe recommand\xe9)\ndatabase:\n  type: external\n  external:\n    host: postgresql.example.com\n    port: 5432\n    username: harbor\n    password: "HarborPassword123!"\n    coreDatabase: registry\n    notaryServerDatabase: notary_server\n    notarySignerDatabase: notary_signer\n    sslmode: require\n\n# Redis (externe recommand\xe9)\nredis:\n  type: external\n  external:\n    addr: redis.example.com:6379\n    password: "RedisPassword123!"\n    sentinelMasterSet: ""\n    coreDatabaseIndex: "0"\n    jobserviceDatabaseIndex: "1"\n    registryDatabaseIndex: "2"\n    trivyAdapterIndex: "5"\n\n# Trivy scanner\ntrivy:\n  enabled: true\n  resources:\n    requests:\n      cpu: 200m\n      memory: 512Mi\n    limits:\n      cpu: 1\n      memory: 1Gi\n\n# Notary (Image signing)\nnotary:\n  enabled: true\n\n# Metrics\nmetrics:\n  enabled: true\n  core:\n    path: /metrics\n    port: 8001\n  registry:\n    path: /metrics\n    port: 5001\n  exporter:\n    path: /metrics\n    port: 8001\n\n# Cache\ncache:\n  enabled: true\n  expireHours: 24\n'})}),"\n",(0,t.jsx)(e.p,{children:"Installation :"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"helm install harbor harbor/harbor \\\n  --namespace harbor \\\n  --values harbor-values.yaml \\\n  --version 1.13.0\n"})}),"\n",(0,t.jsx)(e.h2,{id:"-configuration-s\xe9curit\xe9",children:"\ud83d\udd10 Configuration S\xe9curit\xe9"}),"\n",(0,t.jsx)(e.h3,{id:"1-configuration-projets",children:"1. Configuration Projets"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# Cr\xe9er un projet Java\ncurl -X POST "https://harbor.example.com/api/v2.0/projects" \\\n  -H "Authorization: Basic $(echo -n \'admin:password\' | base64)" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "project_name": "java-apps",\n    "public": false,\n    "metadata": {\n      "auto_scan": "true",\n      "prevent_vul": "true",\n      "severity": "critical",\n      "reuse_sys_cve_whitelist": "true"\n    }\n  }\'\n\n# Cr\xe9er un projet Drupal\ncurl -X POST "https://harbor.example.com/api/v2.0/projects" \\\n  -H "Authorization: Basic $(echo -n \'admin:password\' | base64)" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "project_name": "drupal-apps",\n    "public": false,\n    "metadata": {\n      "auto_scan": "true",\n      "prevent_vul": "true",\n      "severity": "high"\n    }\n  }\'\n\n# Cr\xe9er un projet Angular\ncurl -X POST "https://harbor.example.com/api/v2.0/projects" \\\n  -H "Authorization: Basic $(echo -n \'admin:password\' | base64)" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "project_name": "angular-apps",\n    "public": false,\n    "metadata": {\n      "auto_scan": "true",\n      "prevent_vul": "true"\n    }\n  }\'\n'})}),"\n",(0,t.jsx)(e.h3,{id:"2-security-policies",children:"2. Security Policies"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",metastring:'title="harbor-security-policy.yaml"',children:'# Policy pour emp\xeacher le pull d\'images vuln\xe9rables\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: harbor-security-policy\n  namespace: harbor\ndata:\n  policy.json: |\n    {\n      "version": "v1",\n      "policies": [\n        {\n          "name": "prevent-critical-vulnerabilities",\n          "description": "Block images with critical vulnerabilities",\n          "action": "deny",\n          "conditions": [\n            {\n              "type": "vulnerability",\n              "severity": "critical",\n              "operator": ">=",\n              "value": 1\n            }\n          ]\n        },\n        {\n          "name": "require-signature",\n          "description": "Require signed images for production",\n          "action": "deny",\n          "conditions": [\n            {\n              "type": "signature",\n              "required": true,\n              "signers": ["cosign"]\n            }\n          ]\n        },\n        {\n          "name": "enforce-scan",\n          "description": "Ensure all images are scanned",\n          "action": "deny",\n          "conditions": [\n            {\n              "type": "scan_status",\n              "value": "not_scanned"\n            }\n          ]\n        }\n      ]\n    }\n'})}),"\n",(0,t.jsx)(e.h3,{id:"3-robot-accounts",children:"3. Robot Accounts"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# Cr\xe9er un robot account pour CI/CD\ncurl -X POST "https://harbor.example.com/api/v2.0/projects/java-apps/robots" \\\n  -H "Authorization: Basic $(echo -n \'admin:password\' | base64)" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "name": "github-actions-bot",\n    "description": "Robot for GitHub Actions CI/CD",\n    "duration": -1,\n    "level": "project",\n    "permissions": [\n      {\n        "kind": "project",\n        "namespace": "java-apps",\n        "access": [\n          {"resource": "repository", "action": "push"},\n          {"resource": "repository", "action": "pull"},\n          {"resource": "artifact", "action": "read"},\n          {"resource": "scan", "action": "create"}\n        ]\n      }\n    ]\n  }\'\n'})}),"\n",(0,t.jsx)(e.h2,{id:"-int\xe9gration-cicd",children:"\ud83d\udd04 Int\xe9gration CI/CD"}),"\n",(0,t.jsx)(e.h3,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",metastring:'title=".github/workflows/harbor-push.yml"',children:'name: Build and Push to Harbor\n\non:\n  push:\n    branches: [main]\n\nenv:\n  HARBOR_URL: harbor.example.com\n  HARBOR_PROJECT: java-apps\n  IMAGE_NAME: my-spring-app\n\njobs:\n  build-and-push:\n    runs-on: ubuntu-latest\n    \n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n      \n      - name: Set up Docker Buildx\n        uses: docker/setup-buildx-action@v3\n      \n      - name: Log in to Harbor\n        uses: docker/login-action@v3\n        with:\n          registry: ${{ env.HARBOR_URL }}\n          username: ${{ secrets.HARBOR_USERNAME }}\n          password: ${{ secrets.HARBOR_PASSWORD }}\n      \n      - name: Extract metadata\n        id: meta\n        uses: docker/metadata-action@v5\n        with:\n          images: ${{ env.HARBOR_URL }}/${{ env.HARBOR_PROJECT }}/${{ env.IMAGE_NAME }}\n          tags: |\n            type=sha,prefix={{branch}}-\n            type=ref,event=branch\n            type=semver,pattern={{version}}\n      \n      - name: Build and push\n        uses: docker/build-push-action@v5\n        with:\n          context: .\n          push: true\n          tags: ${{ steps.meta.outputs.tags }}\n          labels: ${{ steps.meta.outputs.labels }}\n          cache-from: type=gha\n          cache-to: type=gha,mode=max\n      \n      - name: Sign image with Cosign\n        run: |\n          IMAGE_DIGEST=$(docker inspect --format=\'{{.RepoDigests}}\' \\\n            ${{ env.HARBOR_URL }}/${{ env.HARBOR_PROJECT }}/${{ env.IMAGE_NAME }}:${{ github.sha }} \\\n            | cut -d\'[\' -f2 | cut -d\']\' -f1)\n          \n          cosign sign --yes \\\n            --key env://COSIGN_PRIVATE_KEY \\\n            ${IMAGE_DIGEST}\n        env:\n          COSIGN_PRIVATE_KEY: ${{ secrets.COSIGN_PRIVATE_KEY }}\n          COSIGN_PASSWORD: ${{ secrets.COSIGN_PASSWORD }}\n      \n      - name: Trigger Harbor Scan\n        run: |\n          curl -X POST \\\n            "https://${{ env.HARBOR_URL }}/api/v2.0/projects/${{ env.HARBOR_PROJECT }}/repositories/${{ env.IMAGE_NAME }}/artifacts/${{ github.sha }}/scan" \\\n            -H "Authorization: Basic $(echo -n \'${{ secrets.HARBOR_USERNAME }}:${{ secrets.HARBOR_PASSWORD }}\' | base64)"\n      \n      - name: Check Scan Results\n        run: |\n          sleep 30  # Wait for scan to complete\n          \n          SCAN_RESULT=$(curl -s \\\n            "https://${{ env.HARBOR_URL }}/api/v2.0/projects/${{ env.HARBOR_PROJECT }}/repositories/${{ env.IMAGE_NAME }}/artifacts/${{ github.sha }}" \\\n            -H "Authorization: Basic $(echo -n \'${{ secrets.HARBOR_USERNAME }}:${{ secrets.HARBOR_PASSWORD }}\' | base64)" \\\n            | jq -r \'.scan_overview."application/vnd.security.vulnerability.report; version=1.1".severity\')\n          \n          if [ "$SCAN_RESULT" == "Critical" ]; then\n            echo "\u274c Critical vulnerabilities found!"\n            exit 1\n          fi\n          \n          echo "\u2705 No critical vulnerabilities"\n'})}),"\n",(0,t.jsx)(e.h2,{id:"-replication",children:"\ud83d\udcca Replication"}),"\n",(0,t.jsx)(e.h3,{id:"configuration-multi-site",children:"Configuration Multi-site"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",metastring:'title="harbor-replication.yaml"',children:'# Replication vers DR site\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: harbor-replication-dr\ndata:\n  replication-policy.json: |\n    {\n      "name": "replicate-to-dr",\n      "description": "Replicate all images to DR site",\n      "src_registry": {\n        "id": 0\n      },\n      "dest_registry": {\n        "id": 1,\n        "name": "harbor-dr",\n        "url": "https://harbor-dr.example.com",\n        "credential": {\n          "access_key": "robot$replication",\n          "access_secret": "password"\n        }\n      },\n      "trigger": {\n        "type": "event_based"\n      },\n      "filters": [\n        {\n          "type": "name",\n          "value": "**"\n        }\n      ],\n      "enabled": true,\n      "deletion": false,\n      "override": true,\n      "speed": 0\n    }\n\n---\n# Replication vers Edge sites\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: harbor-replication-edge\ndata:\n  replication-policy.json: |\n    {\n      "name": "replicate-to-edge",\n      "description": "Replicate production images to edge sites",\n      "filters": [\n        {\n          "type": "name",\n          "value": "**/prod-**"\n        },\n        {\n          "type": "tag",\n          "value": "v*"\n        }\n      ],\n      "dest_registry": {\n        "url": "https://harbor-edge.example.com"\n      },\n      "trigger": {\n        "type": "manual"\n      }\n    }\n'})}),"\n",(0,t.jsx)(e.h2,{id:"-monitoring-harbor",children:"\ud83d\udcc8 Monitoring Harbor"}),"\n",(0,t.jsx)(e.h3,{id:"prometheus-metrics",children:"Prometheus Metrics"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-yaml",metastring:'title="harbor-servicemonitor.yaml"',children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: harbor\n  namespace: harbor\nspec:\n  selector:\n    matchLabels:\n      app: harbor\n  endpoints:\n    - port: metrics\n      path: /metrics\n      interval: 30s\n"})}),"\n",(0,t.jsx)(e.h3,{id:"grafana-dashboard",children:"Grafana Dashboard"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-json",children:'{\n  "dashboard": {\n    "title": "Harbor Registry Monitoring",\n    "panels": [\n      {\n        "title": "Registry Storage Usage",\n        "targets": [{\n          "expr": "harbor_project_quota_usage_byte"\n        }]\n      },\n      {\n        "title": "Push/Pull Rate",\n        "targets": [\n          {"expr": "rate(harbor_core_http_request_total{operation=\\"push\\"}[5m])"},\n          {"expr": "rate(harbor_core_http_request_total{operation=\\"pull\\"}[5m])"}\n        ]\n      },\n      {\n        "title": "Vulnerabilities by Severity",\n        "targets": [{\n          "expr": "sum by(severity) (harbor_artifact_vulnerabilities)"\n        }]\n      },\n      {\n        "title": "Scan Duration",\n        "targets": [{\n          "expr": "harbor_scan_duration_seconds"\n        }]\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(e.h2,{id:"-administration",children:"\ud83d\udd27 Administration"}),"\n",(0,t.jsx)(e.h3,{id:"garbage-collection",children:"Garbage Collection"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'# Lancer le garbage collection\ncurl -X POST "https://harbor.example.com/api/v2.0/system/gc/schedule" \\\n  -H "Authorization: Basic $(echo -n \'admin:password\' | base64)" \\\n  -H "Content-Type: application/json" \\\n  -d \'{\n    "schedule": {\n      "type": "Daily",\n      "cron": "0 2 * * *"\n    },\n    "delete_untagged": true,\n    "dry_run": false\n  }\'\n'})}),"\n",(0,t.jsx)(e.h3,{id:"backup",children:"Backup"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# harbor-backup.sh\n\nBACKUP_DIR="/backup/harbor-$(date +%Y%m%d)"\nmkdir -p $BACKUP_DIR\n\n# Backup database\nkubectl exec -n harbor harbor-db-0 -- \\\n  pg_dump -U postgres registry > $BACKUP_DIR/database.sql\n\n# Backup Harbor config\nkubectl get cm -n harbor -o yaml > $BACKUP_DIR/config.yaml\n\n# Backup secrets\nkubectl get secret -n harbor -o yaml > $BACKUP_DIR/secrets.yaml\n\n# Tar and encrypt\ntar -czf - $BACKUP_DIR | \\\n  openssl enc -aes-256-cbc -salt -out $BACKUP_DIR.tar.gz.enc\n\n# Upload to S3\naws s3 cp $BACKUP_DIR.tar.gz.enc s3://backup-bucket/harbor/\n'})}),"\n",(0,t.jsx)(e.h2,{id:"-best-practices",children:"\ud83c\udfaf Best Practices"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Utiliser S3 pour le storage"})," : Plus fiable et scalable"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Activer le scan automatique"})," : Toutes les images scann\xe9es"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Mettre en place des quotas"})," : Limiter l'usage par projet"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Robot accounts pour CI/CD"})," : Pas de credentials utilisateur"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"R\xe9plication g\xe9ographique"})," : DR et performance"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Garbage collection r\xe9gulier"})," : Lib\xe9rer l'espace"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Monitoring actif"})," : Alertes sur les vuln\xe9rabilit\xe9s"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Backup automatis\xe9"})," : Daily backup vers S3"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"-ressources",children:"\ud83d\udcda Ressources"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://goharbor.io/docs/",children:"Harbor Documentation"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://goharbor.io/docs/latest/working-with-projects/working-with-images/pulling-pushing-images/",children:"Harbor API"})}),"\n",(0,t.jsx)(e.li,{children:(0,t.jsx)(e.a,{href:"https://github.com/aquasecurity/trivy",children:"Trivy Scanner"})}),"\n"]}),"\n",(0,t.jsx)(e.hr,{}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Harbor : Registry enterprise-grade pour vos containers ! \ud83d\udc33\ud83d\udd12"})})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>i,x:()=>o});var a=r(6540);const t={},s=a.createContext(t);function i(n){const e=a.useContext(s);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:i(n.components),a.createElement(s.Provider,{value:e},n.children)}}}]);