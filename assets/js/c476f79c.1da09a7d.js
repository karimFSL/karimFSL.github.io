"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[6200],{6549:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"development/java/data-layer/logging","title":"Audit des entit\xe9s","description":"L\'audit permet de tracer automatiquement les modifications sur vos entit\xe9s : qui a cr\xe9\xe9/modifi\xe9 l\'entit\xe9, quand elle a \xe9t\xe9 cr\xe9\xe9e/modifi\xe9e, et g\xe9rer les conflits de versions lors de modifications concurrentes.","source":"@site/docs/development/java/data-layer/logging.md","sourceDirName":"development/java/data-layer","slug":"/development/java/data-layer/logging","permalink":"/docs/development/java/data-layer/logging","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/development/java/data-layer/logging.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"Multi-Tenancy (Multi-Locataire)","permalink":"/docs/development/java/data-layer/mutli-tenancy"},"next":{"title":"Liquibase avec Spring Boot","permalink":"/docs/development/java/data-layer/liquibase"}}');var s=r(4848),t=r(8453);const a={sidebar_position:2},l="Audit des entit\xe9s",d={},o=[{value:"Pourquoi auditer ?",id:"pourquoi-auditer-",level:2},{value:"Entit\xe9 de base avec audit",id:"entit\xe9-de-base-avec-audit",level:2},{value:"Annotations d&#39;audit expliqu\xe9es",id:"annotations-daudit-expliqu\xe9es",level:2},{value:"@Version - Verrouillage optimiste",id:"version---verrouillage-optimiste",level:3},{value:"@CreationTimestamp - Date de cr\xe9ation",id:"creationtimestamp---date-de-cr\xe9ation",level:3},{value:"@UpdateTimestamp - Date de modification",id:"updatetimestamp---date-de-modification",level:3},{value:"@CreatedBy - Cr\xe9ateur",id:"createdby---cr\xe9ateur",level:3},{value:"@LastModifiedBy - Modificateur",id:"lastmodifiedby---modificateur",level:3},{value:"Configuration de l&#39;audit",id:"configuration-de-laudit",level:2},{value:"1. Impl\xe9menter AuditorAware",id:"1-impl\xe9menter-auditoraware",level:3},{value:"2. D\xe9clarer le Bean",id:"2-d\xe9clarer-le-bean",level:3},{value:"3. Activer l&#39;audit JPA",id:"3-activer-laudit-jpa",level:3},{value:"Cas d&#39;usage avanc\xe9s",id:"cas-dusage-avanc\xe9s",level:2},{value:"Audit avec diff\xe9rents types d&#39;identifiants",id:"audit-avec-diff\xe9rents-types-didentifiants",level:3},{value:"Audit avec fuseau horaire sp\xe9cifique",id:"audit-avec-fuseau-horaire-sp\xe9cifique",level:3},{value:"D\xe9sactiver l&#39;audit pour certaines op\xe9rations",id:"d\xe9sactiver-laudit-pour-certaines-op\xe9rations",level:3},{value:"Bonnes pratiques",id:"bonnes-pratiques",level:2},{value:"D\xe9pannage",id:"d\xe9pannage",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"audit-des-entit\xe9s",children:"Audit des entit\xe9s"})}),"\n",(0,s.jsx)(n.p,{children:"L'audit permet de tracer automatiquement les modifications sur vos entit\xe9s : qui a cr\xe9\xe9/modifi\xe9 l'entit\xe9, quand elle a \xe9t\xe9 cr\xe9\xe9e/modifi\xe9e, et g\xe9rer les conflits de versions lors de modifications concurrentes."}),"\n",(0,s.jsx)(n.h2,{id:"pourquoi-auditer-",children:"Pourquoi auditer ?"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tra\xe7abilit\xe9"})," : Savoir qui a fait quoi et quand"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Conformit\xe9"})," : R\xe9pondre aux exigences r\xe9glementaires (RGPD, SOX, etc.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"D\xe9bogage"})," : Comprendre l'historique des modifications"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"S\xe9curit\xe9"})," : D\xe9tecter des modifications suspectes"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Gestion des conflits"})," : \xc9viter les \xe9crasements de donn\xe9es"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"entit\xe9-de-base-avec-audit",children:"Entit\xe9 de base avec audit"}),"\n",(0,s.jsxs)(n.p,{children:["La classe ",(0,s.jsx)(n.code,{children:"BaseEntity"})," int\xe8gre tous les champs d'audit n\xe9cessaires :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Setter\r\n@Getter\r\n@SuperBuilder\r\n@NoArgsConstructor\r\n@MappedSuperclass\r\n@EntityListeners(AuditingEntityListener.class)\r\npublic class BaseEntity {\r\n    \r\n    @Version\r\n    private Long version;\r\n\r\n    @CreationTimestamp\r\n    @Column(updatable = false)\r\n    private Timestamp createdDate;\r\n\r\n    @UpdateTimestamp\r\n    private Timestamp lastModifiedDate;\r\n\r\n    @CreatedBy\r\n    @Column(updatable = false)\r\n    private String creator;\r\n\r\n    @LastModifiedBy\r\n    private String modifier;\r\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Usage"})," : Faites h\xe9riter vos entit\xe9s de ",(0,s.jsx)(n.code,{children:"BaseEntity"})," pour b\xe9n\xe9ficier automatiquement de l'audit."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Entity\r\n@Table(name = "users")\r\npublic class User extends BaseEntity {\r\n    \r\n    private String name;\r\n    private String email;\r\n    \r\n    // Les champs d\'audit sont h\xe9rit\xe9s automatiquement\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"annotations-daudit-expliqu\xe9es",children:"Annotations d'audit expliqu\xe9es"}),"\n",(0,s.jsx)(n.h3,{id:"version---verrouillage-optimiste",children:"@Version - Verrouillage optimiste"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"R\xf4le"})," : Pr\xe9vient les conflits lors de modifications concurrentes."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Fonctionnement"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Version\r\nprivate Long version;  // Incr\xe9ment\xe9e automatiquement \xe0 chaque update\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Sc\xe9nario d'utilisation"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"1. User A lit l'entit\xe9 (version = 1)\r\n2. User B lit l'entit\xe9 (version = 1)\r\n3. User A modifie et sauvegarde \u2192 version = 2 \u2705\r\n4. User B tente de sauvegarder (version = 1) \u2192 OptimisticLockException \u274c\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Gestion de l'exception"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'try {\r\n    userRepository.save(user);\r\n} catch (OptimisticLockException e) {\r\n    // Informer l\'utilisateur que les donn\xe9es ont \xe9t\xe9 modifi\xe9es\r\n    // Proposer de rafra\xeechir ou fusionner les changements\r\n    throw new ConflictException("Les donn\xe9es ont \xe9t\xe9 modifi\xe9es par un autre utilisateur");\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Quand l'utiliser"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Modifications concurrentes possibles"}),"\n",(0,s.jsx)(n.li,{children:"Donn\xe9es critiques (commandes, paiements, stocks)"}),"\n",(0,s.jsx)(n.li,{children:"Interface web avec plusieurs utilisateurs simultan\xe9s"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"creationtimestamp---date-de-cr\xe9ation",children:"@CreationTimestamp - Date de cr\xe9ation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"R\xf4le"})," : Enregistre automatiquement la date de cr\xe9ation de l'entit\xe9."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@CreationTimestamp\r\n@Column(updatable = false)  // Important : emp\xeache les modifications\r\nprivate Timestamp createdDate;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Comportement"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Remplie automatiquement par Hibernate lors du ",(0,s.jsx)(n.code,{children:"INSERT"})]}),"\n",(0,s.jsxs)(n.li,{children:["Ne change ",(0,s.jsx)(n.strong,{children:"jamais"}),", m\xeame lors des ",(0,s.jsx)(n.code,{children:"UPDATE"})]}),"\n",(0,s.jsx)(n.li,{children:"Utilise le fuseau horaire du serveur"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Alternatives"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// Avec Java 8 Time API\r\n@CreationTimestamp\r\nprivate Instant createdDate;\r\n\r\n// Avec LocalDateTime\r\n@CreationTimestamp\r\nprivate LocalDateTime createdDate;\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"updatetimestamp---date-de-modification",children:"@UpdateTimestamp - Date de modification"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"R\xf4le"})," : Met \xe0 jour automatiquement la date \xe0 chaque modification."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@UpdateTimestamp\r\nprivate Timestamp lastModifiedDate;\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Comportement"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Remplie lors du ",(0,s.jsx)(n.code,{children:"INSERT"})]}),"\n",(0,s.jsxs)(n.li,{children:["Mise \xe0 jour automatiquement \xe0 chaque ",(0,s.jsx)(n.code,{children:"UPDATE"})]}),"\n",(0,s.jsx)(n.li,{children:"Utile pour les m\xe9canismes de cache et synchronisation"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cas d'usage"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'// R\xe9cup\xe9rer les entit\xe9s modifi\xe9es depuis une date\r\n@Query("SELECT e FROM Entity e WHERE e.lastModifiedDate > :since")\r\nList<Entity> findModifiedSince(@Param("since") Timestamp since);\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"createdby---cr\xe9ateur",children:"@CreatedBy - Cr\xe9ateur"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"R\xf4le"})," : Identifie automatiquement l'utilisateur qui a cr\xe9\xe9 l'entit\xe9."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@CreatedBy\r\n@Column(updatable = false)\r\nprivate String creator;  // UUID, username, ou email\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Comportement"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Remplie automatiquement via ",(0,s.jsx)(n.code,{children:"AuditorAware"})]}),"\n",(0,s.jsx)(n.li,{children:"Ne change jamais apr\xe8s la cr\xe9ation"}),"\n",(0,s.jsx)(n.li,{children:"N\xe9cessite une impl\xe9mentation personnalis\xe9e (voir configuration)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h3,{id:"lastmodifiedby---modificateur",children:"@LastModifiedBy - Modificateur"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"R\xf4le"})," : Identifie le dernier utilisateur ayant modifi\xe9 l'entit\xe9."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@LastModifiedBy\r\nprivate String modifier;  // UUID, username, ou email\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Comportement"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Remplie lors de la cr\xe9ation (= creator)"}),"\n",(0,s.jsx)(n.li,{children:"Mise \xe0 jour \xe0 chaque modification"}),"\n",(0,s.jsx)(n.li,{children:"N\xe9cessite une impl\xe9mentation personnalis\xe9e (voir configuration)"}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration-de-laudit",children:"Configuration de l'audit"}),"\n",(0,s.jsx)(n.h3,{id:"1-impl\xe9menter-auditoraware",children:"1. Impl\xe9menter AuditorAware"}),"\n",(0,s.jsx)(n.p,{children:"Cette interface fournit l'identit\xe9 de l'utilisateur courant :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\r\npublic class AuditorAwareImpl implements AuditorAware<String> {\r\n    \r\n    @Override\r\n    public Optional<String> getCurrentAuditor() {\r\n        // R\xe9cup\xe9rer l\'utilisateur depuis le contexte de s\xe9curit\xe9\r\n        Authentication authentication = SecurityContextHolder\r\n            .getContext()\r\n            .getAuthentication();\r\n        \r\n        if (authentication == null || !authentication.isAuthenticated()) {\r\n            return Optional.of("SYSTEM");  // Valeur par d\xe9faut\r\n        }\r\n        \r\n        // Adapter selon votre mod\xe8le User\r\n        return Optional.of(authentication.getName());\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Avec Spring Security personnalis\xe9"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\r\npublic class AuditorAwareImpl implements AuditorAware<String> {\r\n    \r\n    @Override\r\n    public Optional<String> getCurrentAuditor() {\r\n        return Optional.ofNullable(\r\n            SecurityUtils.getCurrentUserAccount()\r\n                .map(UserAccount::getUuid)\r\n                .orElse("SYSTEM")\r\n        );\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-d\xe9clarer-le-bean",children:"2. D\xe9clarer le Bean"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Configuration\r\npublic class AuditConfig {\r\n    \r\n    @Bean\r\n    public AuditorAware<String> auditorAware() {\r\n        return new AuditorAwareImpl();\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"3-activer-laudit-jpa",children:"3. Activer l'audit JPA"}),"\n",(0,s.jsx)(n.p,{children:"Dans votre classe principale :"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@SpringBootApplication\r\n@EnableJpaAuditing(auditorAwareRef = "auditorAware")\r\npublic class Application {\r\n\r\n    public static void main(String[] args) {\r\n        SpringApplication.run(Application.class, args);\r\n    }\r\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Options avanc\xe9es"})," :"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@EnableJpaAuditing(\r\n    auditorAwareRef = "auditorAware",\r\n    dateTimeProviderRef = "dateTimeProvider",  // Provider de date personnalis\xe9\r\n    modifyOnCreate = true  // Active @LastModifiedBy \xe0 la cr\xe9ation\r\n)\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"cas-dusage-avanc\xe9s",children:"Cas d'usage avanc\xe9s"}),"\n",(0,s.jsx)(n.h3,{id:"audit-avec-diff\xe9rents-types-didentifiants",children:"Audit avec diff\xe9rents types d'identifiants"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"// Avec UUID\r\npublic class AuditorAwareImpl implements AuditorAware<UUID> {\r\n    @Override\r\n    public Optional<UUID> getCurrentAuditor() {\r\n        return Optional.of(getCurrentUser().getId());\r\n    }\r\n}\r\n\r\n// Avec objet User complet\r\npublic class AuditorAwareImpl implements AuditorAware<User> {\r\n    @Override\r\n    public Optional<User> getCurrentAuditor() {\r\n        return Optional.of(getCurrentUser());\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"audit-avec-fuseau-horaire-sp\xe9cifique",children:"Audit avec fuseau horaire sp\xe9cifique"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Component\r\npublic class CustomDateTimeProvider implements DateTimeProvider {\r\n    \r\n    @Override\r\n    public Optional<TemporalAccessor> getNow() {\r\n        return Optional.of(\r\n            ZonedDateTime.now(ZoneId.of("Europe/Paris"))\r\n        );\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"d\xe9sactiver-laudit-pour-certaines-op\xe9rations",children:"D\xe9sactiver l'audit pour certaines op\xe9rations"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Service\r\npublic class UserService {\r\n    \r\n    @Autowired\r\n    private EntityManager entityManager;\r\n    \r\n    public void updateWithoutAudit(User user) {\r\n        // D\xe9sactiver temporairement les listeners\r\n        entityManager.detach(user);\r\n        \r\n        // Faire les modifications\r\n        user.setEmail("new@email.com");\r\n        \r\n        // Persister sans d\xe9clencher l\'audit\r\n        entityManager.createQuery("UPDATE User u SET u.email = :email WHERE u.id = :id")\r\n            .setParameter("email", user.getEmail())\r\n            .setParameter("id", user.getId())\r\n            .executeUpdate();\r\n    }\r\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"bonnes-pratiques",children:"Bonnes pratiques"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsxs)(n.strong,{children:["Toujours utiliser ",(0,s.jsx)(n.code,{children:"@Column(updatable = false)"})]})," sur les champs de cr\xe9ation pour \xe9viter les modifications accidentelles"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Choisir le bon type pour les identifiants"})," : UUID pour la s\xe9curit\xe9, String pour la flexibilit\xe9, Long pour la performance"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"G\xe9rer les valeurs par d\xe9faut"}),' : Pr\xe9voir "SYSTEM" ou "ANONYMOUS" pour les op\xe9rations sans utilisateur authentifi\xe9']}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Indexer les champs de date"})," si vous faites des requ\xeates temporelles fr\xe9quentes"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE INDEX idx_last_modified ON users(last_modified_date);\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"5",children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Tester l'audit"})," dans vos tests unitaires :"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Test\r\nvoid testAuditFields() {\r\n    User user = new User("John Doe");\r\n    userRepository.save(user);\r\n    \r\n    assertNotNull(user.getCreatedDate());\r\n    assertNotNull(user.getCreator());\r\n    assertEquals(user.getCreator(), user.getModifier());\r\n    assertEquals(1L, user.getVersion());\r\n}\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"6",children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Logger les OptimisticLockException"})," pour d\xe9tecter les patterns de conflits"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ne jamais exposer les champs d'audit en modification"})," dans vos APIs REST"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"d\xe9pannage",children:"D\xe9pannage"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Probl\xe8me"})," : Les champs @CreatedBy/@LastModifiedBy restent null"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solutions"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["V\xe9rifier que ",(0,s.jsx)(n.code,{children:"@EnableJpaAuditing"})," est pr\xe9sent"]}),"\n",(0,s.jsxs)(n.li,{children:["V\xe9rifier que ",(0,s.jsx)(n.code,{children:"AuditorAware"})," retourne bien une valeur"]}),"\n",(0,s.jsxs)(n.li,{children:["S'assurer que ",(0,s.jsx)(n.code,{children:"@EntityListeners(AuditingEntityListener.class)"})," est sur l'entit\xe9"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Probl\xe8me"})," : OptimisticLockException fr\xe9quentes"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solutions"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"R\xe9viser la logique m\xe9tier pour r\xe9duire les acc\xe8s concurrents"}),"\n",(0,s.jsx)(n.li,{children:"Utiliser des verrous pessimistes pour les sections critiques"}),"\n",(0,s.jsx)(n.li,{children:"Impl\xe9menter une strat\xe9gie de retry avec backoff exponentiel"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Probl\xe8me"})," : Dates incorrectes (fuseau horaire)"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solutions"})," :"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Utiliser ",(0,s.jsx)(n.code,{children:"Instant"})," au lieu de ",(0,s.jsx)(n.code,{children:"Timestamp"})]}),"\n",(0,s.jsxs)(n.li,{children:["Configurer le fuseau horaire de la JVM : ",(0,s.jsx)(n.code,{children:"-Duser.timezone=UTC"})]}),"\n",(0,s.jsx)(n.li,{children:"Stocker en UTC et convertir c\xf4t\xe9 client"}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>l});var i=r(6540);const s={},t=i.createContext(s);function a(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);