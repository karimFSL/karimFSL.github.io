"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[4527],{416:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"infrastructure/iac/ansible/ansible-multicloud","title":"\u2699\ufe0f Ansible - Configuration Multi-Cloud","description":"Ansible automatise la configuration des serveurs apr\xe8s leur provisionnement par Terraform, dans une approche Infrastructure as Code compl\xe8te.","source":"@site/docs/infrastructure/iac/ansible/ansible-multicloud.md","sourceDirName":"infrastructure/iac/ansible","slug":"/infrastructure/iac/ansible/ansible-multicloud","permalink":"/docs/infrastructure/iac/ansible/ansible-multicloud","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/infrastructure/iac/ansible/ansible-multicloud.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Artifactory","permalink":"/docs/infrastructure/docker-registry/artifactory"},"next":{"title":"\ud83c\udfae AWX - Orchestration Ansible","permalink":"/docs/infrastructure/iac/ansible/awx-orchestration"}}');var i=s(4848),l=s(8453);const t={sidebar_position:1},a="\u2699\ufe0f Ansible - Configuration Multi-Cloud",o={},c=[{value:"\ud83c\udfaf Ansible dans l&#39;\xe9cosyst\xe8me DevSecOps",id:"-ansible-dans-l\xe9cosyst\xe8me-devsecops",level:2},{value:"\ud83d\udca1 Concept : S\xe9paration des responsabilit\xe9s",id:"-concept--s\xe9paration-des-responsabilit\xe9s",level:2},{value:"\ud83d\udd27 Terraform \u2192 Provisionner",id:"-terraform--provisionner",level:3},{value:"\u2699\ufe0f Ansible \u2192 Configurer",id:"\ufe0f-ansible--configurer",level:3},{value:"\ud83d\ude80 CI/CD \u2192 D\xe9ployer",id:"-cicd--d\xe9ployer",level:3},{value:"\ud83d\udcc1 Structure projet int\xe9gr\xe9e",id:"-structure-projet-int\xe9gr\xe9e",level:2},{value:"\ud83c\udf0d Multi-Cloud avec Ansible",id:"-multi-cloud-avec-ansible",level:2},{value:"Approche : Inventories par cloud provider",id:"approche--inventories-par-cloud-provider",level:3},{value:"Playbooks cloud-agnostic",id:"playbooks-cloud-agnostic",level:3},{value:"\ud83d\udd04 Int\xe9gration avec CI/CD GitLab",id:"-int\xe9gration-avec-cicd-gitlab",level:2},{value:"Pipeline GitLab CI complet",id:"pipeline-gitlab-ci-complet",level:3},{value:"Workflow complet",id:"workflow-complet",level:3},{value:"\ud83c\udfad Cas d&#39;usage : D\xe9ploiement multi-r\xe9gion",id:"-cas-dusage--d\xe9ploiement-multi-r\xe9gion",level:2},{value:"Sc\xe9nario",id:"sc\xe9nario",level:3},{value:"Solution avec Ansible",id:"solution-avec-ansible",level:3},{value:"\ud83d\udd12 S\xe9curit\xe9 et Secrets",id:"-s\xe9curit\xe9-et-secrets",level:2},{value:"Ansible Vault pour les secrets",id:"ansible-vault-pour-les-secrets",level:3},{value:"Int\xe9gration HashiCorp Vault",id:"int\xe9gration-hashicorp-vault",level:3},{value:"\ud83d\udcca Monitoring de l&#39;ex\xe9cution Ansible",id:"-monitoring-de-lex\xe9cution-ansible",level:2},{value:"Callbacks pour logs structur\xe9s",id:"callbacks-pour-logs-structur\xe9s",level:3},{value:"Int\xe9gration avec GitLab CI",id:"int\xe9gration-avec-gitlab-ci",level:3},{value:"\ud83c\udfaf Bonnes pratiques",id:"-bonnes-pratiques",level:2},{value:"\u2705 \xc0 faire",id:"-\xe0-faire",level:3},{value:"\u274c \xc0 \xe9viter",id:"-\xe0-\xe9viter",level:3},{value:"\ud83d\ude80 Exemple complet : Bootstrap infrastructure",id:"-exemple-complet--bootstrap-infrastructure",level:2},{value:"\ud83d\udcc8 R\xe9sum\xe9 de la cha\xeene compl\xe8te",id:"-r\xe9sum\xe9-de-la-cha\xeene-compl\xe8te",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\ufe0f-ansible---configuration-multi-cloud",children:"\u2699\ufe0f Ansible - Configuration Multi-Cloud"})}),"\n",(0,i.jsxs)(n.p,{children:["Ansible automatise la configuration des serveurs apr\xe8s leur provisionnement par Terraform, dans une approche ",(0,i.jsx)(n.strong,{children:"Infrastructure as Code"})," compl\xe8te."]}),"\n",(0,i.jsx)(n.h2,{id:"-ansible-dans-l\xe9cosyst\xe8me-devsecops",children:"\ud83c\udfaf Ansible dans l'\xe9cosyst\xe8me DevSecOps"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TB\n    subgraph "Phase 1: Provisionnement"\n        TF[\ud83d\udce6 Terraform]\n        AWS[\u2601\ufe0f AWS]\n        AZURE[\u2601\ufe0f Azure]\n        GCP[\u2601\ufe0f GCP]\n        SECNUM[\ud83d\udd12 SecNumCloud]\n    end\n    \n    subgraph "Phase 2: Configuration"\n        ANSIBLE[\u2699\ufe0f Ansible]\n        PLAYBOOKS[\ud83d\udcdd Playbooks]\n        ROLES[\ud83c\udfad Roles]\n    end\n    \n    subgraph "Phase 3: D\xe9ploiement Apps"\n        CICD[\ud83d\udd04 GitLab CI]\n        JAVA[\u2615 Java]\n        DRUPAL[\ud83d\udd37 Drupal]\n        ANGULAR[\ud83c\udd70\ufe0f Angular]\n    end\n    \n    subgraph "Phase 4: Monitoring"\n        PROM[\ud83d\udcca Prometheus]\n        GRAF[\ud83d\udcc8 Grafana]\n    end\n    \n    TF --\x3e AWS\n    TF --\x3e AZURE\n    TF --\x3e GCP\n    TF --\x3e SECNUM\n    \n    AWS --\x3e ANSIBLE\n    AZURE --\x3e ANSIBLE\n    GCP --\x3e ANSIBLE\n    SECNUM --\x3e ANSIBLE\n    \n    ANSIBLE --\x3e PLAYBOOKS\n    ANSIBLE --\x3e ROLES\n    \n    PLAYBOOKS --\x3e CICD\n    ROLES --\x3e CICD\n    \n    CICD --\x3e JAVA\n    CICD --\x3e DRUPAL\n    CICD --\x3e ANGULAR\n    \n    JAVA --\x3e PROM\n    DRUPAL --\x3e PROM\n    ANGULAR --\x3e PROM\n    PROM --\x3e GRAF'}),"\n",(0,i.jsx)(n.h2,{id:"-concept--s\xe9paration-des-responsabilit\xe9s",children:"\ud83d\udca1 Concept : S\xe9paration des responsabilit\xe9s"}),"\n",(0,i.jsx)(n.h3,{id:"-terraform--provisionner",children:"\ud83d\udd27 Terraform \u2192 Provisionner"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"R\xf4le"})," : Cr\xe9er l'infrastructure cloud"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"VPC, subnets, security groups"}),"\n",(0,i.jsx)(n.li,{children:"Instances EC2, VMs Azure, Compute Engine GCP"}),"\n",(0,i.jsx)(n.li,{children:"Load balancers, databases manag\xe9es"}),"\n",(0,i.jsx)(n.li,{children:"Stockage S3, Azure Blob, GCS"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Sortie Terraform"})," \u2192 Inventory Ansible"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-hcl",children:'# Terraform g\xe9n\xe8re automatiquement l\'inventory Ansible\noutput "ansible_inventory" {\n  value = {\n    webservers = aws_instance.web[*].public_ip\n    databases  = aws_instance.db[*].private_ip\n    cache      = aws_instance.redis[*].private_ip\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\ufe0f-ansible--configurer",children:"\u2699\ufe0f Ansible \u2192 Configurer"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"R\xf4le"})," : Configurer les serveurs provisionn\xe9s"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Installation packages (Nginx, PostgreSQL, Redis)"}),"\n",(0,i.jsx)(n.li,{children:"Configuration syst\xe8me (firewall, users, SSH)"}),"\n",(0,i.jsx)(n.li,{children:"Hardening s\xe9curit\xe9 (fail2ban, SELinux)"}),"\n",(0,i.jsx)(n.li,{children:"Monitoring agents (Prometheus exporters)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ex\xe9cution"})," : Juste apr\xe8s Terraform"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# 1. Terraform cr\xe9e les serveurs\nterraform apply\n\n# 2. Ansible les configure\nansible-playbook -i inventory/production playbooks/site.yml\n\n# 3. CI/CD d\xe9ploie les applications\n"})}),"\n",(0,i.jsx)(n.h3,{id:"-cicd--d\xe9ployer",children:"\ud83d\ude80 CI/CD \u2192 D\xe9ployer"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"R\xf4le"})," : D\xe9ployer les applications m\xe9tier"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Build des artefacts (JAR, images Docker)"}),"\n",(0,i.jsx)(n.li,{children:"D\xe9ploiement sur Kubernetes"}),"\n",(0,i.jsx)(n.li,{children:"Rolling updates"}),"\n",(0,i.jsx)(n.li,{children:"Health checks"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"-structure-projet-int\xe9gr\xe9e",children:"\ud83d\udcc1 Structure projet int\xe9gr\xe9e"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"infrastructure/\n\u251c\u2500\u2500 terraform/                    # Phase 1: Provisionnement\n\u2502   \u251c\u2500\u2500 aws/\n\u2502   \u2502   \u251c\u2500\u2500 main.tf\n\u2502   \u2502   \u2514\u2500\u2500 outputs.tf          # \u2192 G\xe9n\xe8re inventory Ansible\n\u2502   \u251c\u2500\u2500 azure/\n\u2502   \u2514\u2500\u2500 gcp/\n\u2502\n\u251c\u2500\u2500 ansible/                      # Phase 2: Configuration\n\u2502   \u251c\u2500\u2500 inventory/\n\u2502   \u2502   \u251c\u2500\u2500 production.yml      # \u2190 G\xe9n\xe9r\xe9 par Terraform\n\u2502   \u2502   \u2514\u2500\u2500 group_vars/\n\u2502   \u251c\u2500\u2500 playbooks/\n\u2502   \u2502   \u251c\u2500\u2500 site.yml            # Configure tout\n\u2502   \u2502   \u2514\u2500\u2500 bootstrap.yml       # Premier d\xe9marrage\n\u2502   \u2514\u2500\u2500 roles/\n\u2502       \u251c\u2500\u2500 common/             # Packages de base\n\u2502       \u251c\u2500\u2500 nginx/              # Web servers\n\u2502       \u251c\u2500\u2500 postgresql/         # Databases\n\u2502       \u2514\u2500\u2500 monitoring/         # Prometheus exporters\n\u2502\n\u2514\u2500\u2500 applications/                 # Phase 3: Applications\n    \u251c\u2500\u2500 java-app/\n    \u2502   \u2514\u2500\u2500 .gitlab-ci.yml      # Pipeline CI/CD\n    \u251c\u2500\u2500 drupal-site/\n    \u2502   \u2514\u2500\u2500 .gitlab-ci.yml\n    \u2514\u2500\u2500 angular-app/\n        \u2514\u2500\u2500 .gitlab-ci.yml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-multi-cloud-avec-ansible",children:"\ud83c\udf0d Multi-Cloud avec Ansible"}),"\n",(0,i.jsx)(n.h3,{id:"approche--inventories-par-cloud-provider",children:"Approche : Inventories par cloud provider"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="inventory/aws-production.yml"',children:"all:\n  children:\n    aws_webservers:\n      hosts:\n        web01-aws: {ansible_host: 10.0.1.10}\n        web02-aws: {ansible_host: 10.0.1.11}\n      vars:\n        cloud_provider: aws\n        region: eu-west-1\n\n    aws_databases:\n      hosts:\n        db01-aws: {ansible_host: 10.0.2.10}\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="inventory/azure-production.yml"',children:"all:\n  children:\n    azure_webservers:\n      hosts:\n        web01-azure: {ansible_host: 10.1.1.10}\n        web02-azure: {ansible_host: 10.1.1.11}\n      vars:\n        cloud_provider: azure\n        region: westeurope\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="inventory/secnumcloud-production.yml"',children:"all:\n  children:\n    secnum_webservers:\n      hosts:\n        web01-secnum: {ansible_host: 10.2.1.10}\n      vars:\n        cloud_provider: secnumcloud\n        compliance: qualifi\xe9\n"})}),"\n",(0,i.jsx)(n.h3,{id:"playbooks-cloud-agnostic",children:"Playbooks cloud-agnostic"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="playbooks/site.yml"',children:'---\n# Configure TOUS les serveurs (AWS + Azure + GCP + SecNumCloud)\n- name: Configure all servers\n  hosts: all\n  roles:\n    - common              # Installation de base (identique partout)\n    - security           # Hardening (identique partout)\n    - monitoring         # Exporters Prometheus\n\n- name: Configure web servers\n  hosts: "*_webservers"   # Toutes les VMs web de tous les clouds\n  roles:\n    - nginx\n\n- name: Configure databases\n  hosts: "*_databases"\n  roles:\n    - postgresql\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Avantage"})," : Le m\xeame playbook fonctionne sur tous les clouds ! \ud83c\udfaf"]}),"\n",(0,i.jsx)(n.h2,{id:"-int\xe9gration-avec-cicd-gitlab",children:"\ud83d\udd04 Int\xe9gration avec CI/CD GitLab"}),"\n",(0,i.jsx)(n.h3,{id:"pipeline-gitlab-ci-complet",children:"Pipeline GitLab CI complet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".gitlab-ci.yml"',children:"stages:\n  - provision      # Terraform\n  - configure      # Ansible\n  - deploy         # Application\n\n# Stage 1: Terraform provisionne\nprovision:infrastructure:\n  stage: provision\n  image: hashicorp/terraform:latest\n  script:\n    - cd terraform/aws\n    - terraform init\n    - terraform apply -auto-approve\n    - terraform output -json > ../../ansible-inventory.json\n  artifacts:\n    paths:\n      - ansible-inventory.json\n\n# Stage 2: Ansible configure\nconfigure:servers:\n  stage: configure\n  image: cytopia/ansible:latest\n  dependencies:\n    - provision:infrastructure\n  script:\n    - cd ansible\n    - ansible-playbook -i ../ansible-inventory.json playbooks/site.yml\n  only:\n    - main\n\n# Stage 3: D\xe9ploiement application\ndeploy:java:\n  stage: deploy\n  image: bitnami/kubectl:latest\n  script:\n    - kubectl set image deployment/my-app app=registry.com/my-app:$CI_COMMIT_SHA\n  only:\n    - main\n"})}),"\n",(0,i.jsx)(n.h3,{id:"workflow-complet",children:"Workflow complet"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Dev as \ud83d\udc68\u200d\ud83d\udcbb D\xe9veloppeur\n    participant Git as \ud83d\udce6 GitLab\n    participant TF as \ud83c\udfd7\ufe0f Terraform\n    participant Cloud as \u2601\ufe0f AWS/Azure/GCP\n    participant Ansible as \u2699\ufe0f Ansible\n    participant App as \ud83d\ude80 Application\n    \n    Dev->>Git: git push\n    Git->>TF: Stage 1: Provision\n    TF->>Cloud: Create VMs\n    Cloud--\x3e>TF: IPs des serveurs\n    TF->>Git: G\xe9n\xe8re inventory.json\n    \n    Git->>Ansible: Stage 2: Configure\n    Ansible->>Cloud: SSH vers VMs\n    Ansible->>Cloud: Install Nginx, PostgreSQL...\n    Cloud--\x3e>Ansible: Serveurs configur\xe9s\n    \n    Git->>App: Stage 3: Deploy\n    App->>Cloud: Deploy app sur K8s\n    Cloud--\x3e>Dev: \u2705 Done!"}),"\n",(0,i.jsx)(n.h2,{id:"-cas-dusage--d\xe9ploiement-multi-r\xe9gion",children:"\ud83c\udfad Cas d'usage : D\xe9ploiement multi-r\xe9gion"}),"\n",(0,i.jsx)(n.h3,{id:"sc\xe9nario",children:"Sc\xe9nario"}),"\n",(0,i.jsx)(n.p,{children:"D\xe9ployer la m\xeame stack Java sur 3 clouds simultan\xe9ment :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"AWS eu-west-1"})," : Production Europe"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Azure westeurope"})," : Backup Europe"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"GCP us-central1"})," : Production US"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"solution-avec-ansible",children:"Solution avec Ansible"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="playbooks/deploy-multicloud.yml"',children:'---\n- name: Deploy on ALL clouds\n  hosts: all\n  serial: "30%"           # 30% des serveurs \xe0 la fois\n  max_fail_percentage: 10  # Stop si >10% d\'\xe9checs\n  \n  pre_tasks:\n    - name: Health check avant d\xe9ploiement\n      uri:\n        url: http://localhost:8080/health\n      register: health\n      \n  roles:\n    - java-deployment\n    \n  post_tasks:\n    - name: Smoke test apr\xe8s d\xe9ploiement\n      uri:\n        url: http://localhost:8080/actuator/health\n        status_code: 200\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Commande"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# D\xe9ploie sur les 3 clouds en parall\xe8le\nansible-playbook playbooks/deploy-multicloud.yml \\\n  -i inventory/aws-production.yml \\\n  -i inventory/azure-production.yml \\\n  -i inventory/gcp-production.yml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-s\xe9curit\xe9-et-secrets",children:"\ud83d\udd12 S\xe9curit\xe9 et Secrets"}),"\n",(0,i.jsx)(n.h3,{id:"ansible-vault-pour-les-secrets",children:"Ansible Vault pour les secrets"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="group_vars/all/vault.yml"',children:'# Fichier chiffr\xe9 avec ansible-vault\n---\nvault_db_password: "SuperSecret123"\nvault_api_key: "sk-1234567890abcdef"\nvault_ssh_private_key: |\n  -----BEGIN RSA PRIVATE KEY-----\n  ...\n  -----END RSA PRIVATE KEY-----\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'# Chiffrer le fichier\nansible-vault encrypt group_vars/all/vault.yml\n\n# Utiliser dans les playbooks\nansible-playbook site.yml --ask-vault-pass\n\n# Ou avec un fichier de mot de passe\necho "my-vault-password" > .vault_pass\nansible-playbook site.yml --vault-password-file .vault_pass\n'})}),"\n",(0,i.jsx)(n.h3,{id:"int\xe9gration-hashicorp-vault",children:"Int\xe9gration HashiCorp Vault"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"- name: Get secrets from Vault\n  set_fact:\n    db_password: \"{{ lookup('hashi_vault', 'secret=secret/db/password') }}\"\n    api_key: \"{{ lookup('hashi_vault', 'secret=secret/api/key') }}\"\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-monitoring-de-lex\xe9cution-ansible",children:"\ud83d\udcca Monitoring de l'ex\xe9cution Ansible"}),"\n",(0,i.jsx)(n.h3,{id:"callbacks-pour-logs-structur\xe9s",children:"Callbacks pour logs structur\xe9s"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",metastring:'title="ansible.cfg"',children:"[defaults]\n# Logs JSON pour parsing\nstdout_callback = json\n# Profiling des t\xe2ches lentes\ncallback_whitelist = profile_tasks, timer\n# Log vers fichier\nlog_path = /var/log/ansible/ansible.log\n"})}),"\n",(0,i.jsx)(n.h3,{id:"int\xe9gration-avec-gitlab-ci",children:"Int\xe9gration avec GitLab CI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"configure:servers:\n  script:\n    - ansible-playbook site.yml --diff | tee ansible-output.log\n    - cat ansible-output.log\n  artifacts:\n    when: always\n    paths:\n      - ansible-output.log\n    reports:\n      junit: ansible-junit.xml\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-bonnes-pratiques",children:"\ud83c\udfaf Bonnes pratiques"}),"\n",(0,i.jsx)(n.h3,{id:"-\xe0-faire",children:"\u2705 \xc0 faire"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Pratique"}),(0,i.jsx)(n.th,{children:"Pourquoi"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Idempotence"})}),(0,i.jsx)(n.td,{children:"Rejouer le playbook n'a pas d'effet de bord"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Variables par environnement"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"group_vars/production/"}),", ",(0,i.jsx)(n.code,{children:"group_vars/staging/"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Roles r\xe9utilisables"})}),(0,i.jsx)(n.td,{children:"Un r\xf4le = une responsabilit\xe9"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Tags"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'--tags "nginx,security"'})," pour ex\xe9cutions partielles"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Dry-run"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"--check --diff"})," avant la vraie ex\xe9cution"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Version des r\xf4les"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"requirements.yml"})," pour les d\xe9pendances"]})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"-\xe0-\xe9viter",children:"\u274c \xc0 \xe9viter"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Anti-pattern"}),(0,i.jsx)(n.th,{children:"Probl\xe8me"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.td,{children:["Commandes ",(0,i.jsx)(n.code,{children:"shell"})," partout"]}),(0,i.jsx)(n.td,{children:"Pas idempotent, difficile \xe0 maintenir"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Secrets en clair"}),(0,i.jsx)(n.td,{children:"Toujours utiliser Ansible Vault"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Playbooks monolithiques"}),(0,i.jsx)(n.td,{children:"Difficile \xe0 tester et r\xe9utiliser"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Pas de rollback"}),(0,i.jsx)(n.td,{children:"Pr\xe9voir un playbook de rollback"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"-exemple-complet--bootstrap-infrastructure",children:"\ud83d\ude80 Exemple complet : Bootstrap infrastructure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="playbooks/bootstrap.yml"',children:"---\n# Ce playbook est lanc\xe9 APR\xc8S Terraform et AVANT les apps\n- name: Bootstrap all new servers\n  hosts: all\n  become: yes\n  \n  tasks:\n    # 1. Packages de base\n    - name: Update system\n      apt:\n        update_cache: yes\n        upgrade: dist\n        \n    - name: Install base packages\n      apt:\n        name:\n          - vim\n          - curl\n          - git\n          - htop\n          - fail2ban\n        state: present\n        \n    # 2. Utilisateurs et SSH\n    - name: Create deployment user\n      user:\n        name: deploy\n        shell: /bin/bash\n        groups: sudo\n        \n    - name: Disable password authentication\n      lineinfile:\n        path: /etc/ssh/sshd_config\n        regexp: '^PasswordAuthentication'\n        line: 'PasswordAuthentication no'\n      notify: restart sshd\n        \n    # 3. Monitoring\n    - name: Install node_exporter\n      include_role:\n        name: prometheus.prometheus.node_exporter\n        \n  handlers:\n    - name: restart sshd\n      service:\n        name: sshd\n        state: restarted\n"})}),"\n",(0,i.jsx)(n.h2,{id:"-r\xe9sum\xe9-de-la-cha\xeene-compl\xe8te",children:"\ud83d\udcc8 R\xe9sum\xe9 de la cha\xeene compl\xe8te"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"\xc9tape"}),(0,i.jsx)(n.th,{children:"Outil"}),(0,i.jsx)(n.th,{children:"Responsabilit\xe9"}),(0,i.jsx)(n.th,{children:"R\xe9sultat"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"1\ufe0f\u20e3"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Terraform"})}),(0,i.jsx)(n.td,{children:"Provisionner VMs"}),(0,i.jsx)(n.td,{children:"Serveurs vides avec OS"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"2\ufe0f\u20e3"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Ansible"})}),(0,i.jsx)(n.td,{children:"Configurer serveurs"}),(0,i.jsx)(n.td,{children:"Serveurs pr\xeats pour apps"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"3\ufe0f\u20e3"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"GitLab CI"})}),(0,i.jsx)(n.td,{children:"D\xe9ployer applications"}),(0,i.jsx)(n.td,{children:"Apps running en production"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"4\ufe0f\u20e3"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Prometheus"})}),(0,i.jsx)(n.td,{children:"Monitorer"}),(0,i.jsx)(n.td,{children:"Dashboards et alertes"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Ansible est le pont entre l'infrastructure (Terraform) et les applications (CI/CD) ! \ud83c\udf09"})})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var r=s(6540);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);