"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[3272],{8085:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"microservices/patterns/cqrs","title":"CQRS (Command Query Responsibility Segregation)","description":"Concept","source":"@site/docs/microservices/patterns/cqrs.md","sourceDirName":"microservices/patterns","slug":"/microservices/patterns/cqrs","permalink":"/docs/microservices/patterns/cqrs","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/microservices/patterns/cqrs.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docs","previous":{"title":"Circuit Breaker Pattern","permalink":"/docs/microservices/patterns/circuit-breaker"},"next":{"title":"Event Sourcing","permalink":"/docs/microservices/patterns/event-sourcing"}}');var s=n(4848),d=n(8453);const t={},l="CQRS (Command Query Responsibility Segregation)",a={},o=[{value:"Concept",id:"concept",level:2},{value:"\ud83c\udfaf Probl\xe8me r\xe9solu",id:"-probl\xe8me-r\xe9solu",level:2},{value:"Approche traditionnelle",id:"approche-traditionnelle",level:3},{value:"Avec CQRS",id:"avec-cqrs",level:3},{value:"\ud83c\udfd7\ufe0f Architecture",id:"\ufe0f-architecture",level:2},{value:"S\xe9paration Command/Query",id:"s\xe9paration-commandquery",level:3},{value:"Synchronisation Read Model",id:"synchronisation-read-model",level:3},{value:"\ud83d\udcbb Impl\xe9mentation",id:"-impl\xe9mentation",level:2},{value:"API REST",id:"api-rest",level:3},{value:"Technologies Read DB",id:"technologies-read-db",level:3},{value:"\ud83d\udd04 Eventual Consistency",id:"-eventual-consistency",level:2},{value:"G\xe9rer l&#39;UI",id:"g\xe9rer-lui",level:3},{value:"\ud83c\udfa8 Niveaux de CQRS",id:"-niveaux-de-cqrs",level:2},{value:"Niveau 1 : S\xe9paration logique",id:"niveau-1--s\xe9paration-logique",level:3},{value:"Niveau 2 : S\xe9paration physique",id:"niveau-2--s\xe9paration-physique",level:3},{value:"Niveau 3 : Technologies diff\xe9rentes",id:"niveau-3--technologies-diff\xe9rentes",level:3},{value:"\u2705 Avantages",id:"-avantages",level:2},{value:"1. Performance",id:"1-performance",level:3},{value:"2. Scalabilit\xe9",id:"2-scalabilit\xe9",level:3},{value:"3. Optimisation cibl\xe9e",id:"3-optimisation-cibl\xe9e",level:3},{value:"4. Flexibilit\xe9",id:"4-flexibilit\xe9",level:3},{value:"\u26a0\ufe0f Inconv\xe9nients",id:"\ufe0f-inconv\xe9nients",level:2},{value:"1. Complexit\xe9",id:"1-complexit\xe9",level:3},{value:"2. Eventual Consistency",id:"2-eventual-consistency",level:3},{value:"3. Duplication de donn\xe9es",id:"3-duplication-de-donn\xe9es",level:3},{value:"4. Synchronisation",id:"4-synchronisation",level:3},{value:"\ud83d\udee0\ufe0f Frameworks",id:"\ufe0f-frameworks",level:2},{value:"Axon Framework (Java)",id:"axon-framework-java",level:3},{value:"MediatR (.NET)",id:"mediatr-net",level:3},{value:"\ud83d\udcca Quand utiliser CQRS ?",id:"-quand-utiliser-cqrs-",level:2},{value:"\u2705 Cas appropri\xe9s",id:"-cas-appropri\xe9s",level:3},{value:"\u274c \xc9viter si",id:"-\xe9viter-si",level:3},{value:"\u2705 Bonnes pratiques",id:"-bonnes-pratiques",level:2},{value:"\ud83e\uddea Tests",id:"-tests",level:2},{value:"Ressources",id:"ressources",level:2}];function c(e){const r={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"cqrs-command-query-responsibility-segregation",children:"CQRS (Command Query Responsibility Segregation)"})}),"\n",(0,s.jsx)(r.h2,{id:"concept",children:"Concept"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.strong,{children:"CQRS"})," s\xe9pare les op\xe9rations de ",(0,s.jsx)(r.strong,{children:"lecture"})," (Query) et d'",(0,s.jsx)(r.strong,{children:"\xe9criture"})," (Command) en utilisant des mod\xe8les de donn\xe9es diff\xe9rents."]}),"\n",(0,s.jsx)(r.admonition,{title:"Principe",type:"tip",children:(0,s.jsx)(r.p,{children:"Un mod\xe8le optimis\xe9 pour l'\xe9criture, un autre pour la lecture."})}),"\n",(0,s.jsx)(r.h2,{id:"-probl\xe8me-r\xe9solu",children:"\ud83c\udfaf Probl\xe8me r\xe9solu"}),"\n",(0,s.jsx)(r.h3,{id:"approche-traditionnelle",children:"Approche traditionnelle"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\r\n\u2502  API Controller  \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\r\n         \u2502\r\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\r\n    \u2502 Service \u2502\r\n    \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518\r\n         \u2502\r\n    \u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\r\n    \u2502   BDD   \u2502  \u25c4\u2500\u2500 M\xeame mod\xe8le lecture/\xe9criture\r\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Probl\xe8mes :"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Mod\xe8le de donn\xe9es compromis entre lecture et \xe9criture"}),"\n",(0,s.jsx)(r.li,{children:"Requ\xeates complexes avec JOINs multiples"}),"\n",(0,s.jsx)(r.li,{children:"Scaling difficile (m\xeame BDD pour tout)"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"avec-cqrs",children:"Avec CQRS"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"Commands (Write)          Queries (Read)\r\n     \u2502                         \u2502\r\n\u250c\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510            \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2510\r\n\u2502 Write DB \u2502 \u2500Events\u2500\u2192  \u2502 Read DB  \u2502\r\n\u2502 (Normal) \u2502            \u2502 (D\xe9nom.) \u2502\r\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,s.jsx)(r.p,{children:(0,s.jsx)(r.strong,{children:"Avantages :"})}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Mod\xe8les optimis\xe9s s\xe9par\xe9ment"}),"\n",(0,s.jsx)(r.li,{children:"Scalabilit\xe9 ind\xe9pendante"}),"\n",(0,s.jsx)(r.li,{children:"Lecture ultra-rapide (donn\xe9es d\xe9normalis\xe9es)"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\ufe0f-architecture",children:"\ud83c\udfd7\ufe0f Architecture"}),"\n",(0,s.jsx)(r.h3,{id:"s\xe9paration-commandquery",children:"S\xe9paration Command/Query"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// ============ COMMANDS (Write Side) ============\r\n\r\nclass CreateOrderCommand {\r\n  constructor(userId, items) {\r\n    this.userId = userId;\r\n    this.items = items;\r\n  }\r\n}\r\n\r\nclass OrderCommandHandler {\r\n  async handle(command) {\r\n    // Validation m\xe9tier\r\n    if (command.items.length === 0) {\r\n      throw new Error('Order must have items');\r\n    }\r\n    \r\n    // \xc9crire dans Write DB (normalis\xe9)\r\n    const order = await Order.create({\r\n      userId: command.userId,\r\n      status: 'PENDING'\r\n    });\r\n    \r\n    await OrderItem.bulkCreate(\r\n      command.items.map(item => ({\r\n        orderId: order.id,\r\n        productId: item.productId,\r\n        quantity: item.quantity\r\n      }))\r\n    );\r\n    \r\n    // Publier \xe9v\xe9nement pour synchronisation\r\n    eventBus.publish('OrderCreated', { orderId: order.id });\r\n    \r\n    return order.id;\r\n  }\r\n}\r\n\r\n// ============ QUERIES (Read Side) ============\r\n\r\nclass GetOrderDetailsQuery {\r\n  constructor(orderId) {\r\n    this.orderId = orderId;\r\n  }\r\n}\r\n\r\nclass OrderQueryHandler {\r\n  async handle(query) {\r\n    // Lecture depuis Read DB (d\xe9normalis\xe9, pr\xe9-joint\xe9)\r\n    return await OrderReadModel.findOne({\r\n      where: { orderId: query.orderId }\r\n    });\r\n    \r\n    // Retourne directement:\r\n    // {\r\n    //   orderId: '123',\r\n    //   userName: 'John Doe',     // D\xe9normalis\xe9\r\n    //   userEmail: 'john@...',    // D\xe9normalis\xe9\r\n    //   items: [                   // Pr\xe9-joint\xe9\r\n    //     { productName: '...', price: ... }\r\n    //   ],\r\n    //   totalAmount: 150\r\n    // }\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"synchronisation-read-model",children:"Synchronisation Read Model"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// Projector : \xe9coute les \xe9v\xe9nements et met \xe0 jour Read DB\r\neventBus.subscribe('OrderCreated', async (event) => {\r\n  const order = await Order.findByPk(event.orderId, {\r\n    include: [User, OrderItems]\r\n  });\r\n  \r\n  // Cr\xe9er vue d\xe9normalis\xe9e\r\n  await OrderReadModel.create({\r\n    orderId: order.id,\r\n    userName: order.user.name,\r\n    userEmail: order.user.email,\r\n    items: order.items.map(item => ({\r\n      productName: item.product.name,\r\n      quantity: item.quantity,\r\n      price: item.price\r\n    })),\r\n    totalAmount: order.totalAmount,\r\n    status: order.status\r\n  });\r\n});\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-impl\xe9mentation",children:"\ud83d\udcbb Impl\xe9mentation"}),"\n",(0,s.jsx)(r.h3,{id:"api-rest",children:"API REST"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// ===== COMMANDS =====\r\nrouter.post('/orders', async (req, res) => {\r\n  const command = new CreateOrderCommand(\r\n    req.user.id,\r\n    req.body.items\r\n  );\r\n  \r\n  const orderId = await commandBus.dispatch(command);\r\n  \r\n  res.status(202).json({ orderId }); // 202 Accepted\r\n});\r\n\r\n// ===== QUERIES =====\r\nrouter.get('/orders/:id', async (req, res) => {\r\n  const query = new GetOrderDetailsQuery(req.params.id);\r\n  \r\n  const order = await queryBus.dispatch(query);\r\n  \r\n  res.json(order);\r\n});\n"})}),"\n",(0,s.jsx)(r.h3,{id:"technologies-read-db",children:"Technologies Read DB"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Use Case"}),(0,s.jsx)(r.th,{children:"Write DB"}),(0,s.jsx)(r.th,{children:"Read DB"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Simple"})}),(0,s.jsx)(r.td,{children:"PostgreSQL"}),(0,s.jsx)(r.td,{children:"PostgreSQL (vues mat\xe9rialis\xe9es)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Analytics"})}),(0,s.jsx)(r.td,{children:"PostgreSQL"}),(0,s.jsx)(r.td,{children:"Elasticsearch"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"High read load"})}),(0,s.jsx)(r.td,{children:"PostgreSQL"}),(0,s.jsx)(r.td,{children:"Redis (cache)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Complex queries"})}),(0,s.jsx)(r.td,{children:"PostgreSQL"}),(0,s.jsx)(r.td,{children:"PostgreSQL (sch\xe9ma d\xe9normalis\xe9)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.strong,{children:"Full-text search"})}),(0,s.jsx)(r.td,{children:"MongoDB"}),(0,s.jsx)(r.td,{children:"Elasticsearch"})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"-eventual-consistency",children:"\ud83d\udd04 Eventual Consistency"}),"\n",(0,s.jsxs)(r.p,{children:["Le Read Model est ",(0,s.jsx)(r.strong,{children:"\xe9ventuellement coh\xe9rent"})," avec le Write Model."]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// T0: Command ex\xe9cut\xe9e\r\nPOST /orders \u2192 { orderId: '123' }\r\n\r\n// T1: \xc9v\xe9nement publi\xe9 et trait\xe9 (~10-100ms)\r\nEvent: OrderCreated\r\n\r\n// T2: Read Model mis \xe0 jour\r\nGET /orders/123 \u2192 { order details }\r\n\r\n// \u26a0\ufe0f Entre T0 et T2 : Read Model pas encore \xe0 jour\n"})}),"\n",(0,s.jsx)(r.h3,{id:"g\xe9rer-lui",children:"G\xe9rer l'UI"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// Option 1: Optimistic UI\r\n// Afficher imm\xe9diatement avec donn\xe9es de la commande\r\nconst optimisticOrder = {\r\n  id: orderId,\r\n  status: 'PENDING',\r\n  items: command.items\r\n};\r\n\r\n// Option 2: Polling\r\nasync function waitForOrder(orderId) {\r\n  for (let i = 0; i < 10; i++) {\r\n    const order = await getOrder(orderId);\r\n    if (order) return order;\r\n    await sleep(100);\r\n  }\r\n  throw new Error('Order not found');\r\n}\r\n\r\n// Option 3: WebSocket notification\r\neventBus.subscribe('OrderCreated', (event) => {\r\n  websocket.send({ type: 'OrderReady', orderId: event.orderId });\r\n});\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-niveaux-de-cqrs",children:"\ud83c\udfa8 Niveaux de CQRS"}),"\n",(0,s.jsx)(r.h3,{id:"niveau-1--s\xe9paration-logique",children:"Niveau 1 : S\xe9paration logique"}),"\n",(0,s.jsx)(r.p,{children:"M\xeame BDD, mod\xe8les diff\xe9rents"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// Write Model (ORM)\r\nclass Order {\r\n  id: number;\r\n  userId: number;\r\n  items: OrderItem[];\r\n}\r\n\r\n// Read Model (DTO simple)\r\ninterface OrderDTO {\r\n  orderId: number;\r\n  userName: string;\r\n  totalAmount: number;\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"niveau-2--s\xe9paration-physique",children:"Niveau 2 : S\xe9paration physique"}),"\n",(0,s.jsx)(r.p,{children:"BDD s\xe9par\xe9es, synchronisation \xe9v\xe9nementielle"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// Write DB: PostgreSQL normalis\xe9\r\n// Read DB: PostgreSQL d\xe9normalis\xe9\r\n// Sync: CDC (Change Data Capture) via Debezium\n"})}),"\n",(0,s.jsx)(r.h3,{id:"niveau-3--technologies-diff\xe9rentes",children:"Niveau 3 : Technologies diff\xe9rentes"}),"\n",(0,s.jsx)(r.p,{children:"Optimisation maximale"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"// Write: PostgreSQL (ACID)\r\n// Read: Elasticsearch (full-text search)\r\n// Sync: Kafka events\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-avantages",children:"\u2705 Avantages"}),"\n",(0,s.jsx)(r.h3,{id:"1-performance",children:"1. Performance"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Lecture"})," : donn\xe9es pr\xe9-calcul\xe9es, pas de JOIN"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"\xc9criture"})," : pas de contraintes de lecture"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"2-scalabilit\xe9",children:"2. Scalabilit\xe9"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Scaler Read/Write ind\xe9pendamment"}),"\n",(0,s.jsx)(r.li,{children:"Read replicas multiples"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"3-optimisation-cibl\xe9e",children:"3. Optimisation cibl\xe9e"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Indexes adapt\xe9s par usage"}),"\n",(0,s.jsx)(r.li,{children:"Caching agressif sur Read"}),"\n",(0,s.jsx)(r.li,{children:"Sharding diff\xe9rent Read/Write"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"4-flexibilit\xe9",children:"4. Flexibilit\xe9"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Plusieurs Read Models pour diff\xe9rents besoins"}),"\n",(0,s.jsx)(r.li,{children:"Migration technologique facilit\xe9e"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"\ufe0f-inconv\xe9nients",children:"\u26a0\ufe0f Inconv\xe9nients"}),"\n",(0,s.jsx)(r.h3,{id:"1-complexit\xe9",children:"1. Complexit\xe9"}),"\n",(0,s.jsx)(r.p,{children:"Code plus complexe que CRUD simple"}),"\n",(0,s.jsx)(r.h3,{id:"2-eventual-consistency",children:"2. Eventual Consistency"}),"\n",(0,s.jsx)(r.p,{children:"UI doit g\xe9rer le d\xe9lai de synchronisation"}),"\n",(0,s.jsx)(r.h3,{id:"3-duplication-de-donn\xe9es",children:"3. Duplication de donn\xe9es"}),"\n",(0,s.jsx)(r.p,{children:"Plus de stockage n\xe9cessaire"}),"\n",(0,s.jsx)(r.h3,{id:"4-synchronisation",children:"4. Synchronisation"}),"\n",(0,s.jsx)(r.p,{children:"Erreurs de sync \xe0 g\xe9rer"}),"\n",(0,s.jsx)(r.h2,{id:"\ufe0f-frameworks",children:"\ud83d\udee0\ufe0f Frameworks"}),"\n",(0,s.jsx)(r.h3,{id:"axon-framework-java",children:"Axon Framework (Java)"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-java",children:"// Command\r\n@CommandHandler\r\npublic OrderId handle(CreateOrderCommand command) {\r\n    OrderId orderId = new OrderId();\r\n    apply(new OrderCreatedEvent(orderId, command.getItems()));\r\n    return orderId;\r\n}\r\n\r\n// Query\r\n@QueryHandler\r\npublic OrderDetails handle(GetOrderDetailsQuery query) {\r\n    return orderReadRepository.findById(query.getOrderId());\r\n}\r\n\r\n// Projection (mise \xe0 jour Read Model)\r\n@EventHandler\r\npublic void on(OrderCreatedEvent event) {\r\n    OrderDetails details = new OrderDetails(event.getOrderId());\r\n    orderReadRepository.save(details);\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"mediatr-net",children:"MediatR (.NET)"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-csharp",children:"// Command\r\npublic class CreateOrderCommand : IRequest<Guid>\r\n{\r\n    public List<OrderItem> Items { get; set; }\r\n}\r\n\r\npublic class CreateOrderHandler : IRequestHandler<CreateOrderCommand, Guid>\r\n{\r\n    public async Task<Guid> Handle(CreateOrderCommand request, ...)\r\n    {\r\n        var order = new Order(request.Items);\r\n        await _repository.SaveAsync(order);\r\n        return order.Id;\r\n    }\r\n}\r\n\r\n// Query\r\npublic class GetOrderQuery : IRequest<OrderDto>\r\n{\r\n    public Guid OrderId { get; set; }\r\n}\r\n\r\npublic class GetOrderHandler : IRequestHandler<GetOrderQuery, OrderDto>\r\n{\r\n    public async Task<OrderDto> Handle(GetOrderQuery request, ...)\r\n    {\r\n        return await _readRepository.GetOrderAsync(request.OrderId);\r\n    }\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"-quand-utiliser-cqrs-",children:"\ud83d\udcca Quand utiliser CQRS ?"}),"\n",(0,s.jsx)(r.h3,{id:"-cas-appropri\xe9s",children:"\u2705 Cas appropri\xe9s"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Charge de lecture >> \xe9criture (ratio 100:1 typique)"}),"\n",(0,s.jsx)(r.li,{children:"Besoins de performance critiques"}),"\n",(0,s.jsx)(r.li,{children:"Requ\xeates complexes avec agr\xe9gations"}),"\n",(0,s.jsx)(r.li,{children:"Mod\xe8les de lecture multiples"}),"\n",(0,s.jsx)(r.li,{children:"Domain-Driven Design"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"-\xe9viter-si",children:"\u274c \xc9viter si"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"CRUD simple"}),"\n",(0,s.jsx)(r.li,{children:"Charge \xe9quilibr\xe9e lecture/\xe9criture"}),"\n",(0,s.jsx)(r.li,{children:"\xc9quipe sans exp\xe9rience"}),"\n",(0,s.jsx)(r.li,{children:"Coh\xe9rence imm\xe9diate obligatoire"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"-bonnes-pratiques",children:"\u2705 Bonnes pratiques"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Commencer simple"})," : CQRS logique avant physique"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Monitoring de sync"})," : latence Read Model"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Versioning"})," : g\xe9rer \xe9volution des Read Models"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Idempotence"})," : projections rejouables"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Tests"})," : v\xe9rifier coh\xe9rence finale"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Documentation"})," : expliquer l'eventual consistency"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"-tests",children:"\ud83e\uddea Tests"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-javascript",children:"describe('CQRS Order Flow', () => {\r\n  it('should eventually sync Read Model', async () => {\r\n    // Command\r\n    const orderId = await commandBus.dispatch(\r\n      new CreateOrderCommand(userId, items)\r\n    );\r\n    \r\n    // Wait for projection\r\n    await waitFor(() => \r\n      queryBus.dispatch(new GetOrderQuery(orderId))\r\n    );\r\n    \r\n    // Verify Read Model\r\n    const order = await queryBus.dispatch(\r\n      new GetOrderQuery(orderId)\r\n    );\r\n    expect(order.totalAmount).toBe(150);\r\n  });\r\n});\n"})}),"\n",(0,s.jsx)(r.h2,{id:"ressources",children:"Ressources"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://martinfowler.com/bliki/CQRS.html",children:"CQRS - Martin Fowler"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/architecture/patterns/cqrs",children:"Microsoft CQRS Pattern"})}),"\n",(0,s.jsx)(r.li,{children:(0,s.jsx)(r.a,{href:"https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf",children:"Greg Young - CQRS Documents"})}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>l});var i=n(6540);const s={},d=i.createContext(s);function t(e){const r=i.useContext(d);return i.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(d.Provider,{value:r},e.children)}}}]);