"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[6022],{2608:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"security/software-composition-analysis/trivy","title":"\ud83d\udd0d Trivy - Scan de vuln\xe9rabilit\xe9s","description":"Trivy est un scanner de vuln\xe9rabilit\xe9s open-source complet et facile \xe0 utiliser. Il scanne conteneurs, syst\xe8mes de fichiers, repositories Git, et configurations IaC.","source":"@site/docs/security/software-composition-analysis/trivy.md","sourceDirName":"security/software-composition-analysis","slug":"/security/software-composition-analysis/trivy","permalink":"/docs/security/software-composition-analysis/trivy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/security/software-composition-analysis/trivy.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"Software Composition Analysis","permalink":"/docs/security/software-composition-analysis/"},"next":{"title":"\ud83d\udccb SBOM - Software Bill of Materials","permalink":"/docs/security/software-composition-analysis/sbom"}}');var r=i(4848),a=i(8453);const t={sidebar_position:2},l="\ud83d\udd0d Trivy - Scan de vuln\xe9rabilit\xe9s",o={},c=[{value:"\ud83c\udfaf Pourquoi Trivy ?",id:"-pourquoi-trivy-",level:2},{value:"\ud83d\udce6 Installation",id:"-installation",level:2},{value:"\ud83d\udd0d Types de scans",id:"-types-de-scans",level:2},{value:"Images Docker",id:"images-docker",level:3},{value:"Syst\xe8me de fichiers",id:"syst\xe8me-de-fichiers",level:3},{value:"Configuration IaC",id:"configuration-iac",level:3},{value:"Repository Git",id:"repository-git",level:3},{value:"SBOM",id:"sbom",level:3},{value:"\ud83d\udd27 Configuration",id:"-configuration",level:2},{value:"Fichier de configuration",id:"fichier-de-configuration",level:3},{value:"Fichier d&#39;exclusion",id:"fichier-dexclusion",level:3},{value:"\ud83d\udd04 Int\xe9gration CI/CD",id:"-int\xe9gration-cicd",level:2},{value:"GitLab CI",id:"gitlab-ci",level:3},{value:"Jenkins",id:"jenkins",level:3},{value:"\ud83d\udcca Formats de sortie",id:"-formats-de-sortie",level:2},{value:"JSON",id:"json",level:3},{value:"SARIF (GitHub Security)",id:"sarif-github-security",level:3},{value:"Table (d\xe9faut)",id:"table-d\xe9faut",level:3},{value:"HTML",id:"html",level:3},{value:"\ud83c\udfaf Meilleures pratiques",id:"-meilleures-pratiques",level:2},{value:"1. Scans r\xe9guliers",id:"1-scans-r\xe9guliers",level:3},{value:"2. Politique de s\xe9v\xe9rit\xe9",id:"2-politique-de-s\xe9v\xe9rit\xe9",level:3},{value:"3. Cache pour performance",id:"3-cache-pour-performance",level:3},{value:"4. Ignorer non fix\xe9es",id:"4-ignorer-non-fix\xe9es",level:3},{value:"\ud83d\udd10 Registries priv\xe9s",id:"-registries-priv\xe9s",level:2},{value:"Docker Hub",id:"docker-hub",level:3},{value:"AWS ECR",id:"aws-ecr",level:3},{value:"Azure ACR",id:"azure-acr",level:3},{value:"GitLab Registry",id:"gitlab-registry",level:3},{value:"\ud83d\udd04 Automatisation",id:"-automatisation",level:2},{value:"Pre-commit hook",id:"pre-commit-hook",level:3},{value:"\ud83c\udd98 Troubleshooting",id:"-troubleshooting",level:2},{value:"Base de donn\xe9es non \xe0 jour",id:"base-de-donn\xe9es-non-\xe0-jour",level:3},{value:"Erreur de connexion",id:"erreur-de-connexion",level:3},{value:"Scan trop lent",id:"scan-trop-lent",level:3},{value:"\ud83d\udcda Ressources",id:"-ressources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-trivy---scan-de-vuln\xe9rabilit\xe9s",children:"\ud83d\udd0d Trivy - Scan de vuln\xe9rabilit\xe9s"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trivy"})," est un scanner de vuln\xe9rabilit\xe9s open-source complet et facile \xe0 utiliser. Il scanne conteneurs, syst\xe8mes de fichiers, repositories Git, et configurations IaC."]}),"\n",(0,r.jsx)(n.h2,{id:"-pourquoi-trivy-",children:"\ud83c\udfaf Pourquoi Trivy ?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Complet"})," : Conteneurs, FS, IaC, SBOM"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Rapide"})," : Scan en quelques secondes"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Pr\xe9cis"})," : Faible taux de faux positifs"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Gratuit"})," : Open-source et maintenu activement"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-installation",children:"\ud83d\udce6 Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Linux\nwget https://github.com/aquasecurity/trivy/releases/download/v0.48.0/trivy_0.48.0_Linux-64bit.tar.gz\ntar zxvf trivy_0.48.0_Linux-64bit.tar.gz\nsudo mv trivy /usr/local/bin/\n\n# macOS\nbrew install trivy\n\n# Docker\ndocker pull aquasec/trivy:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-types-de-scans",children:"\ud83d\udd0d Types de scans"}),"\n",(0,r.jsx)(n.h3,{id:"images-docker",children:"Images Docker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan basique\ntrivy image mon-app:latest\n\n# S\xe9v\xe9rit\xe9 sp\xe9cifique\ntrivy image --severity HIGH,CRITICAL mon-app:latest\n\n# Exit code si vuln\xe9rabilit\xe9s\ntrivy image --exit-code 1 --severity CRITICAL mon-app:latest\n\n# Ignorer non fix\xe9es\ntrivy image --ignore-unfixed mon-app:latest\n\n# Format JSON\ntrivy image --format json --output results.json mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"syst\xe8me-de-fichiers",children:"Syst\xe8me de fichiers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# R\xe9pertoire actuel\ntrivy fs .\n\n# R\xe9pertoire sp\xe9cifique\ntrivy fs /path/to/project\n\n# Fichier JAR/WAR\ntrivy fs target/my-app.jar\n"})}),"\n",(0,r.jsx)(n.h3,{id:"configuration-iac",children:"Configuration IaC"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Terraform\ntrivy config ./infrastructure/terraform\n\n# Kubernetes\ntrivy config ./k8s-manifests\n\n# Docker Compose\ntrivy config docker-compose.yml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"repository-git",children:"Repository Git"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Repo distant\ntrivy repo https://github.com/org/repo\n\n# Branche sp\xe9cifique\ntrivy repo --branch develop https://github.com/org/repo\n"})}),"\n",(0,r.jsx)(n.h3,{id:"sbom",children:"SBOM"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan SBOM\ntrivy sbom sbom.json\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-configuration",children:"\ud83d\udd27 Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"fichier-de-configuration",children:"Fichier de configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# trivy.yaml\nseverity:\n  - CRITICAL\n  - HIGH\n\nvulnerability:\n  ignore-unfixed: true\n\noutput: json\nformat: sarif\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --config trivy.yaml mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"fichier-dexclusion",children:"Fichier d'exclusion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",children:"# .trivyignore\nCVE-2023-12345\nCVE-2023-67890  # Justification\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-int\xe9gration-cicd",children:"\ud83d\udd04 Int\xe9gration CI/CD"}),"\n",(0,r.jsx)(n.h3,{id:"gitlab-ci",children:"GitLab CI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# .gitlab-ci.yml\nstages:\n  - security\n\nvariables:\n  IMAGE: $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA\n\ntrivy-scan:\n  stage: security\n  image:\n    name: aquasec/trivy:latest\n    entrypoint: [""]\n  script:\n    # Scan filesystem\n    - trivy fs --exit-code 0 --format json --output trivy-fs.json .\n    \n    # Scan image\n    - trivy image --exit-code 1 --severity HIGH,CRITICAL $IMAGE\n    \n    # Scan IaC\n    - trivy config --exit-code 0 ./infrastructure\n  artifacts:\n    reports:\n      container_scanning: trivy-fs.json\n    paths:\n      - trivy-fs.json\n  only:\n    - main\n    - merge_requests\n\n# Scan quotidien\ntrivy-daily:\n  stage: security\n  image:\n    name: aquasec/trivy:latest\n    entrypoint: [""]\n  script:\n    - trivy image --severity CRITICAL,HIGH $CI_REGISTRY_IMAGE:latest\n  only:\n    - schedules\n'})}),"\n",(0,r.jsx)(n.h3,{id:"jenkins",children:"Jenkins"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-groovy",children:"pipeline {\n    agent any\n    stages {\n        stage('Trivy Scan') {\n            steps {\n                sh '''\n                    trivy image \\\n                      --format json \\\n                      --output trivy-results.json \\\n                      --severity CRITICAL,HIGH \\\n                      --exit-code 1 \\\n                      my-app:${BUILD_NUMBER}\n                '''\n            }\n            post {\n                always {\n                    archiveArtifacts artifacts: 'trivy-results.json'\n                }\n            }\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-formats-de-sortie",children:"\ud83d\udcca Formats de sortie"}),"\n",(0,r.jsx)(n.h3,{id:"json",children:"JSON"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format json --output results.json mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"sarif-github-security",children:"SARIF (GitHub Security)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format sarif --output results.sarif mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"table-d\xe9faut",children:"Table (d\xe9faut)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image mon-app:latest\n# Output: Total: 15 (CRITICAL: 2, HIGH: 7, MEDIUM: 6)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"html",children:"HTML"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'trivy image --format template --template "@contrib/html.tpl" --output report.html mon-app:latest\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-meilleures-pratiques",children:"\ud83c\udfaf Meilleures pratiques"}),"\n",(0,r.jsx)(n.h3,{id:"1-scans-r\xe9guliers",children:"1. Scans r\xe9guliers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Scan quotidien\nschedule:\n  - cron: '0 2 * * *'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-politique-de-s\xe9v\xe9rit\xe9",children:"2. Politique de s\xe9v\xe9rit\xe9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Bloquer CRITICAL uniquement\ntrivy image --exit-code 1 --severity CRITICAL mon-app:latest\n\n# Ou CRITICAL+HIGH\ntrivy image --exit-code 1 --severity CRITICAL,HIGH mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-cache-pour-performance",children:"3. Cache pour performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export TRIVY_CACHE_DIR=/tmp/trivy-cache\ntrivy image mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-ignorer-non-fix\xe9es",children:"4. Ignorer non fix\xe9es"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --ignore-unfixed mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-registries-priv\xe9s",children:"\ud83d\udd10 Registries priv\xe9s"}),"\n",(0,r.jsx)(n.h3,{id:"docker-hub",children:"Docker Hub"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker login\ntrivy image private-registry/mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"aws-ecr",children:"AWS ECR"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin 123456789.dkr.ecr.eu-west-1.amazonaws.com\ntrivy image 123456789.dkr.ecr.eu-west-1.amazonaws.com/mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"azure-acr",children:"Azure ACR"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"az acr login --name myregistry\ntrivy image myregistry.azurecr.io/mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"gitlab-registry",children:"GitLab Registry"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker login registry.gitlab.com\ntrivy image registry.gitlab.com/group/project:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-automatisation",children:"\ud83d\udd04 Automatisation"}),"\n",(0,r.jsx)(n.h3,{id:"pre-commit-hook",children:"Pre-commit hook"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# .git/hooks/pre-commit\necho "Running Trivy scan..."\ntrivy fs --exit-code 1 --severity CRITICAL,HIGH .\n\nif [ $? -ne 0 ]; then\n    echo "\u274c Trivy scan failed"\n    exit 1\nfi\necho "\u2705 Trivy scan passed"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83c\udd98 Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"base-de-donn\xe9es-non-\xe0-jour",children:"Base de donn\xe9es non \xe0 jour"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --download-db-only\n"})}),"\n",(0,r.jsx)(n.h3,{id:"erreur-de-connexion",children:"Erreur de connexion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"export HTTP_PROXY=http://proxy:8080\nexport HTTPS_PROXY=http://proxy:8080\ntrivy image mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scan-trop-lent",children:"Scan trop lent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# R\xe9duire les scanners\ntrivy image --scanners vuln mon-app:latest\n\n# Ignorer node_modules\ntrivy image --skip-dirs node_modules mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-ressources",children:"\ud83d\udcda Ressources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/",children:"Documentation Trivy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/aquasecurity/trivy",children:"GitHub Trivy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/latest/docs/integrations/",children:"Int\xe9grations CI/CD"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trivy scanne maintenant automatiquement vos vuln\xe9rabilit\xe9s !"})," \ud83d\udd12"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var s=i(6540);const r={},a=s.createContext(r);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);