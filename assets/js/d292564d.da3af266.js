"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[1069],{7058:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"development/devops/tips/keycloak","title":"Installation et utilisation de Keycloak","description":"Introduction","source":"@site/docs/development/devops/tips/keycloak.md","sourceDirName":"development/devops/tips","slug":"/development/devops/tips/keycloak","permalink":"/docs/development/devops/tips/keycloak","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/development/devops/tips/keycloak.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"docs","previous":{"title":"Mise en place de DevContainer","permalink":"/docs/development/devops/tips/devcontainer"},"next":{"title":"Connexion \xe0 Git avec GitLab","permalink":"/docs/development/devops/tips/gitlab-authentication"}}');var r=s(4848),l=s(8453);const c={sidebar_position:3},o="Installation et utilisation de Keycloak",t={},d=[{value:"Introduction",id:"introduction",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:2},{value:"Installation avec Docker Compose",id:"installation-avec-docker-compose",level:2},{value:"1. Cr\xe9er le fichier docker-compose.yml",id:"1-cr\xe9er-le-fichier-docker-composeyml",level:3},{value:"2. D\xe9marrer Keycloak",id:"2-d\xe9marrer-keycloak",level:3},{value:"3. V\xe9rifier le d\xe9marrage",id:"3-v\xe9rifier-le-d\xe9marrage",level:3},{value:"4. Acc\xe9der \xe0 la console d&#39;administration",id:"4-acc\xe9der-\xe0-la-console-dadministration",level:3},{value:"Configuration initiale",id:"configuration-initiale",level:2},{value:"1. Cr\xe9er un Realm",id:"1-cr\xe9er-un-realm",level:3},{value:"2. Cr\xe9er un utilisateur de test",id:"2-cr\xe9er-un-utilisateur-de-test",level:3},{value:"Configuration des Clients OAuth2",id:"configuration-des-clients-oauth2",level:2},{value:"Client 1 : Authorization Code Flow (Application Web)",id:"client-1--authorization-code-flow-application-web",level:3},{value:"Cr\xe9ation du client",id:"cr\xe9ation-du-client",level:4},{value:"R\xe9cup\xe9rer le Client Secret",id:"r\xe9cup\xe9rer-le-client-secret",level:4},{value:"Test avec curl",id:"test-avec-curl",level:4},{value:"Client 2 : Resource Owner Password Credentials (Password Grant)",id:"client-2--resource-owner-password-credentials-password-grant",level:3},{value:"Cr\xe9ation du client",id:"cr\xe9ation-du-client-1",level:4},{value:"Test avec curl",id:"test-avec-curl-1",level:4},{value:"Client 3 : Client Credentials (Machine-to-Machine)",id:"client-3--client-credentials-machine-to-machine",level:3},{value:"Cr\xe9ation du client",id:"cr\xe9ation-du-client-2",level:4},{value:"Configuration des r\xf4les (optionnel)",id:"configuration-des-r\xf4les-optionnel",level:4},{value:"Test avec curl",id:"test-avec-curl-2",level:4},{value:"Utilisation des Tokens",id:"utilisation-des-tokens",level:2},{value:"V\xe9rifier un Access Token",id:"v\xe9rifier-un-access-token",level:3},{value:"Rafra\xeechir un Access Token",id:"rafra\xeechir-un-access-token",level:3},{value:"D\xe9connecter un utilisateur",id:"d\xe9connecter-un-utilisateur",level:3},{value:"Utiliser un Access Token dans vos requ\xeates API",id:"utiliser-un-access-token-dans-vos-requ\xeates-api",level:3},{value:"D\xe9coder un JWT Token",id:"d\xe9coder-un-jwt-token",level:2},{value:"Configuration avanc\xe9e",id:"configuration-avanc\xe9e",level:2},{value:"Augmenter la dur\xe9e de vie des tokens",id:"augmenter-la-dur\xe9e-de-vie-des-tokens",level:3},{value:"Ajouter des claims personnalis\xe9s",id:"ajouter-des-claims-personnalis\xe9s",level:3},{value:"Configurer CORS",id:"configurer-cors",level:3},{value:"R\xe9sum\xe9 des flows",id:"r\xe9sum\xe9-des-flows",level:2},{value:"Commandes utiles Docker",id:"commandes-utiles-docker",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Keycloak ne d\xe9marre pas",id:"keycloak-ne-d\xe9marre-pas",level:3},{value:"Erreur de connexion \xe0 la base de donn\xe9es",id:"erreur-de-connexion-\xe0-la-base-de-donn\xe9es",level:3},{value:"Token invalide",id:"token-invalide",level:3},{value:"CORS errors",id:"cors-errors",level:3},{value:"Ressources",id:"ressources",level:2},{value:"Prochaines \xe9tapes",id:"prochaines-\xe9tapes",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"installation-et-utilisation-de-keycloak",children:"Installation et utilisation de Keycloak"})}),"\n",(0,r.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsx)(n.p,{children:"Keycloak est une solution open-source de gestion d'identit\xe9 et d'acc\xe8s (IAM) qui permet d'ajouter l'authentification et l'autorisation \xe0 vos applications."}),"\n",(0,r.jsx)(n.p,{children:"Ce guide couvre l'installation locale de Keycloak avec Docker Compose et la configuration des principaux flows OAuth2/OpenID Connect."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"pr\xe9requis",children:"Pr\xe9requis"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Docker et Docker Compose install\xe9s"}),"\n",(0,r.jsx)(n.li,{children:"WSL2 (si vous \xeates sur Windows)"}),"\n",(0,r.jsx)(n.li,{children:"Un navigateur web"}),"\n",(0,r.jsx)(n.li,{children:"curl ou Postman pour tester les APIs"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"installation-avec-docker-compose",children:"Installation avec Docker Compose"}),"\n",(0,r.jsx)(n.h3,{id:"1-cr\xe9er-le-fichier-docker-composeyml",children:"1. Cr\xe9er le fichier docker-compose.yml"}),"\n",(0,r.jsxs)(n.p,{children:["Cr\xe9ez un fichier ",(0,r.jsx)(n.code,{children:"docker-compose.yml"})," dans votre r\xe9pertoire de projet :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"version: '3.8'\n\nservices:\n  keycloak:\n    image: quay.io/keycloak/keycloak:23.0\n    container_name: keycloak-local\n    environment:\n      KEYCLOAK_ADMIN: admin\n      KEYCLOAK_ADMIN_PASSWORD: admin\n      KC_DB: postgres\n      KC_DB_URL: jdbc:postgresql://postgres:5432/keycloak\n      KC_DB_USERNAME: keycloak\n      KC_DB_PASSWORD: keycloak\n      KC_HOSTNAME: localhost\n      KC_HOSTNAME_PORT: 8080\n      KC_HOSTNAME_STRICT: false\n      KC_HTTP_ENABLED: true\n      KC_HEALTH_ENABLED: true\n    command:\n      - start-dev\n    ports:\n      - \"8080:8080\"\n    depends_on:\n      - postgres\n    networks:\n      - keycloak-network\n\n  postgres:\n    image: postgres:15\n    container_name: postgres-keycloak\n    environment:\n      POSTGRES_DB: keycloak\n      POSTGRES_USER: keycloak\n      POSTGRES_PASSWORD: keycloak\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n    networks:\n      - keycloak-network\n\nvolumes:\n  postgres-data:\n\nnetworks:\n  keycloak-network:\n    driver: bridge\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-d\xe9marrer-keycloak",children:"2. D\xe9marrer Keycloak"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-v\xe9rifier-le-d\xe9marrage",children:"3. V\xe9rifier le d\xe9marrage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# V\xe9rifier les logs\ndocker-compose logs -f keycloak\n\n# V\xe9rifier que les conteneurs sont actifs\ndocker-compose ps\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-acc\xe9der-\xe0-la-console-dadministration",children:"4. Acc\xe9der \xe0 la console d'administration"}),"\n",(0,r.jsx)(n.p,{children:"Ouvrez votre navigateur et acc\xe9dez \xe0 :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"http://localhost:8080\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Identifiants par d\xe9faut :"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Username :"})," admin"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Password :"})," admin"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration-initiale",children:"Configuration initiale"}),"\n",(0,r.jsx)(n.h3,{id:"1-cr\xe9er-un-realm",children:"1. Cr\xe9er un Realm"}),"\n",(0,r.jsx)(n.p,{children:"Un Realm est un espace isol\xe9 pour g\xe9rer vos utilisateurs, applications et configurations."}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Connectez-vous \xe0 la console d'administration"}),"\n",(0,r.jsxs)(n.li,{children:["Survolez ",(0,r.jsx)(n.strong,{children:"Master"})," en haut \xe0 gauche"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Create Realm"})]}),"\n",(0,r.jsxs)(n.li,{children:["Entrez le nom : ",(0,r.jsx)(n.code,{children:"dev-realm"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Create"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-cr\xe9er-un-utilisateur-de-test",children:"2. Cr\xe9er un utilisateur de test"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Dans le menu de gauche, cliquez sur ",(0,r.jsx)(n.strong,{children:"Users"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Add user"})]}),"\n",(0,r.jsxs)(n.li,{children:["Remplissez les informations :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Username :"})," testuser"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Email :"})," ",(0,r.jsx)(n.a,{href:"mailto:testuser@example.com",children:"testuser@example.com"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"First name :"})," Test"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Last name :"})," User"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Email verified :"})," ON"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Create"})]}),"\n",(0,r.jsxs)(n.li,{children:["Allez dans l'onglet ",(0,r.jsx)(n.strong,{children:"Credentials"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Set password"})]}),"\n",(0,r.jsxs)(n.li,{children:["Entrez : ",(0,r.jsx)(n.code,{children:"password123"})]}),"\n",(0,r.jsxs)(n.li,{children:["D\xe9sactivez ",(0,r.jsx)(n.strong,{children:"Temporary"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Save"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration-des-clients-oauth2",children:"Configuration des Clients OAuth2"}),"\n",(0,r.jsx)(n.h3,{id:"client-1--authorization-code-flow-application-web",children:"Client 1 : Authorization Code Flow (Application Web)"}),"\n",(0,r.jsx)(n.p,{children:"Le flow Authorization Code est utilis\xe9 pour les applications web avec backend."}),"\n",(0,r.jsx)(n.h4,{id:"cr\xe9ation-du-client",children:"Cr\xe9ation du client"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans ",(0,r.jsx)(n.strong,{children:"Clients"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Create client"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client type :"})," OpenID Connect"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client ID :"})," ",(0,r.jsx)(n.code,{children:"web-app"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Next"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration des capacit\xe9s :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client authentication :"})," ON"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authorization :"})," ON"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard flow :"})," ON (Authorization Code)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Direct access grants :"})," OFF"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Next"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration des URLs :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Root URL :"})," ",(0,r.jsx)(n.code,{children:"http://localhost:3000"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Valid redirect URIs :"})," ",(0,r.jsx)(n.code,{children:"http://localhost:3000/callback"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Valid post logout redirect URIs :"})," ",(0,r.jsx)(n.code,{children:"http://localhost:3000"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Web origins :"})," ",(0,r.jsx)(n.code,{children:"http://localhost:3000"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Save"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"r\xe9cup\xe9rer-le-client-secret",children:"R\xe9cup\xe9rer le Client Secret"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans l'onglet ",(0,r.jsx)(n.strong,{children:"Credentials"})]}),"\n",(0,r.jsxs)(n.li,{children:["Copiez le ",(0,r.jsx)(n.strong,{children:"Client secret"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"test-avec-curl",children:"Test avec curl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# \xc9tape 1 : Obtenir le code d\'autorisation\n# Ouvrez cette URL dans votre navigateur\nhttp://localhost:8080/realms/dev-realm/protocol/openid-connect/auth?client_id=web-app&redirect_uri=http://localhost:3000/callback&response_type=code&scope=openid\n\n# Apr\xe8s connexion, vous serez redirig\xe9 vers :\n# http://localhost:3000/callback?code=AUTHORIZATION_CODE\n\n# \xc9tape 2 : \xc9changer le code contre un token\ncurl -X POST http://localhost:8080/realms/dev-realm/protocol/openid-connect/token \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=authorization_code" \\\n  -d "client_id=web-app" \\\n  -d "client_secret=VOTRE_CLIENT_SECRET" \\\n  -d "code=AUTHORIZATION_CODE" \\\n  -d "redirect_uri=http://localhost:3000/callback"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"client-2--resource-owner-password-credentials-password-grant",children:"Client 2 : Resource Owner Password Credentials (Password Grant)"}),"\n",(0,r.jsx)(n.p,{children:"Le Password Grant est utilis\xe9 pour les applications de confiance (\xe0 \xe9viter en production)."}),"\n",(0,r.jsx)(n.h4,{id:"cr\xe9ation-du-client-1",children:"Cr\xe9ation du client"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans ",(0,r.jsx)(n.strong,{children:"Clients"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Create client"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client type :"})," OpenID Connect"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client ID :"})," ",(0,r.jsx)(n.code,{children:"mobile-app"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Next"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration des capacit\xe9s :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client authentication :"})," ON"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authorization :"})," OFF"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard flow :"})," OFF"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Direct access grants :"})," ON (Resource Owner Password)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Next"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Save"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"test-avec-curl-1",children:"Test avec curl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/realms/dev-realm/protocol/openid-connect/token \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=password" \\\n  -d "client_id=mobile-app" \\\n  -d "client_secret=VOTRE_CLIENT_SECRET" \\\n  -d "username=testuser" \\\n  -d "password=password123" \\\n  -d "scope=openid"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"R\xe9ponse attendue :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "expires_in": 300,\n  "refresh_expires_in": 1800,\n  "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "token_type": "Bearer",\n  "id_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "not-before-policy": 0,\n  "session_state": "d1c8e0e5-...",\n  "scope": "openid profile email"\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"client-3--client-credentials-machine-to-machine",children:"Client 3 : Client Credentials (Machine-to-Machine)"}),"\n",(0,r.jsx)(n.p,{children:"Le Client Credentials flow est utilis\xe9 pour l'authentification service-to-service."}),"\n",(0,r.jsx)(n.h4,{id:"cr\xe9ation-du-client-2",children:"Cr\xe9ation du client"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans ",(0,r.jsx)(n.strong,{children:"Clients"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Create client"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client type :"})," OpenID Connect"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client ID :"})," ",(0,r.jsx)(n.code,{children:"backend-service"})]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Next"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration des capacit\xe9s :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Client authentication :"})," ON"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Authorization :"})," OFF"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Standard flow :"})," OFF"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Direct access grants :"})," OFF"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Service accounts roles :"})," ON"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Next"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Save"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"configuration-des-r\xf4les-optionnel",children:"Configuration des r\xf4les (optionnel)"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans l'onglet ",(0,r.jsx)(n.strong,{children:"Service account roles"})]}),"\n",(0,r.jsxs)(n.li,{children:["Cliquez sur ",(0,r.jsx)(n.strong,{children:"Assign role"})]}),"\n",(0,r.jsx)(n.li,{children:"S\xe9lectionnez les r\xf4les n\xe9cessaires"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"test-avec-curl-2",children:"Test avec curl"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/realms/dev-realm/protocol/openid-connect/token \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=client_credentials" \\\n  -d "client_id=backend-service" \\\n  -d "client_secret=VOTRE_CLIENT_SECRET"\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"R\xe9ponse attendue :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9...",\n  "expires_in": 300,\n  "refresh_expires_in": 0,\n  "token_type": "Bearer",\n  "not-before-policy": 0,\n  "scope": "profile email"\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"utilisation-des-tokens",children:"Utilisation des Tokens"}),"\n",(0,r.jsx)(n.h3,{id:"v\xe9rifier-un-access-token",children:"V\xe9rifier un Access Token"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/realms/dev-realm/protocol/openid-connect/token/introspect \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "token=VOTRE_ACCESS_TOKEN" \\\n  -d "client_id=web-app" \\\n  -d "client_secret=VOTRE_CLIENT_SECRET"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"rafra\xeechir-un-access-token",children:"Rafra\xeechir un Access Token"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/realms/dev-realm/protocol/openid-connect/token \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=refresh_token" \\\n  -d "client_id=web-app" \\\n  -d "client_secret=VOTRE_CLIENT_SECRET" \\\n  -d "refresh_token=VOTRE_REFRESH_TOKEN"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"d\xe9connecter-un-utilisateur",children:"D\xe9connecter un utilisateur"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X POST http://localhost:8080/realms/dev-realm/protocol/openid-connect/logout \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "client_id=web-app" \\\n  -d "client_secret=VOTRE_CLIENT_SECRET" \\\n  -d "refresh_token=VOTRE_REFRESH_TOKEN"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"utiliser-un-access-token-dans-vos-requ\xeates-api",children:"Utiliser un Access Token dans vos requ\xeates API"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl -X GET http://localhost:8081/api/protected-resource \\\n  -H "Authorization: Bearer VOTRE_ACCESS_TOKEN"\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"d\xe9coder-un-jwt-token",children:"D\xe9coder un JWT Token"}),"\n",(0,r.jsxs)(n.p,{children:["Vous pouvez d\xe9coder vos tokens JWT sur ",(0,r.jsx)(n.a,{href:"https://jwt.io",children:"jwt.io"})," pour inspecter leur contenu."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Exemple de payload d'un Access Token :"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "exp": 1703001234,\n  "iat": 1703000934,\n  "jti": "a1b2c3d4-...",\n  "iss": "http://localhost:8080/realms/dev-realm",\n  "aud": "account",\n  "sub": "f47ac10b-...",\n  "typ": "Bearer",\n  "azp": "web-app",\n  "session_state": "d1c8e0e5-...",\n  "preferred_username": "testuser",\n  "email": "testuser@example.com",\n  "email_verified": true,\n  "name": "Test User",\n  "given_name": "Test",\n  "family_name": "User",\n  "scope": "openid profile email",\n  "realm_access": {\n    "roles": ["default-roles-dev-realm", "offline_access"]\n  }\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"configuration-avanc\xe9e",children:"Configuration avanc\xe9e"}),"\n",(0,r.jsx)(n.h3,{id:"augmenter-la-dur\xe9e-de-vie-des-tokens",children:"Augmenter la dur\xe9e de vie des tokens"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans ",(0,r.jsx)(n.strong,{children:"Realm settings"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Tokens"})]}),"\n",(0,r.jsxs)(n.li,{children:["Modifiez les valeurs :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Access Token Lifespan :"})," 5 minutes (par d\xe9faut) \u2192 30 minutes"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Refresh Token Max Lifespan :"})," 30 minutes \u2192 8 heures"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"ajouter-des-claims-personnalis\xe9s",children:"Ajouter des claims personnalis\xe9s"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans ",(0,r.jsx)(n.strong,{children:"Client scopes"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Create client scope"})]}),"\n",(0,r.jsxs)(n.li,{children:["Nom : ",(0,r.jsx)(n.code,{children:"custom-claims"})]}),"\n",(0,r.jsxs)(n.li,{children:["Allez dans l'onglet ",(0,r.jsx)(n.strong,{children:"Mappers"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Add mapper"})," \u2192 ",(0,r.jsx)(n.strong,{children:"By configuration"})," \u2192 ",(0,r.jsx)(n.strong,{children:"User Attribute"})]}),"\n",(0,r.jsxs)(n.li,{children:["Configuration :","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Name :"})," department"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"User Attribute :"})," department"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Token Claim Name :"})," department"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Claim JSON Type :"})," String"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Add to ID token :"})," ON"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Add to access token :"})," ON"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"Associez ce scope \xe0 vos clients"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"configurer-cors",children:"Configurer CORS"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Allez dans votre client (ex: ",(0,r.jsx)(n.code,{children:"web-app"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Dans ",(0,r.jsx)(n.strong,{children:"Web origins"}),", ajoutez : ",(0,r.jsx)(n.code,{children:"*"})," (pour le d\xe9veloppement uniquement)"]}),"\n",(0,r.jsx)(n.li,{children:"En production, sp\xe9cifiez les domaines exacts"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"r\xe9sum\xe9-des-flows",children:"R\xe9sum\xe9 des flows"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Flow"}),(0,r.jsx)(n.th,{children:"Usage"}),(0,r.jsx)(n.th,{children:"S\xe9curit\xe9"}),(0,r.jsx)(n.th,{children:"Client Authentication"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Authorization Code"})}),(0,r.jsx)(n.td,{children:"Applications web avec backend"}),(0,r.jsx)(n.td,{children:"\u2705 Haute"}),(0,r.jsx)(n.td,{children:"Oui (avec secret)"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Password Grant"})}),(0,r.jsx)(n.td,{children:"Applications de confiance"}),(0,r.jsx)(n.td,{children:"\u26a0\ufe0f Moyenne"}),(0,r.jsx)(n.td,{children:"Oui"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.strong,{children:"Client Credentials"})}),(0,r.jsx)(n.td,{children:"Service-to-service (M2M)"}),(0,r.jsx)(n.td,{children:"\u2705 Haute"}),(0,r.jsx)(n.td,{children:"Oui"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"commandes-utiles-docker",children:"Commandes utiles Docker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# D\xe9marrer Keycloak\ndocker-compose up -d\n\n# Arr\xeater Keycloak\ndocker-compose down\n\n# Voir les logs\ndocker-compose logs -f keycloak\n\n# Red\xe9marrer Keycloak\ndocker-compose restart keycloak\n\n# Supprimer tout (y compris les donn\xe9es)\ndocker-compose down -v\n\n# Exporter la configuration du realm\ndocker exec -it keycloak-local /opt/keycloak/bin/kc.sh export --dir /tmp/export --realm dev-realm\ndocker cp keycloak-local:/tmp/export ./keycloak-export\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"keycloak-ne-d\xe9marre-pas",children:"Keycloak ne d\xe9marre pas"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# V\xe9rifier les logs\ndocker-compose logs keycloak\n\n# V\xe9rifier que PostgreSQL est bien d\xe9marr\xe9\ndocker-compose ps\n"})}),"\n",(0,r.jsx)(n.h3,{id:"erreur-de-connexion-\xe0-la-base-de-donn\xe9es",children:"Erreur de connexion \xe0 la base de donn\xe9es"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Recr\xe9er les conteneurs\ndocker-compose down -v\ndocker-compose up -d\n"})}),"\n",(0,r.jsx)(n.h3,{id:"token-invalide",children:"Token invalide"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"V\xe9rifiez que le client_id et client_secret sont corrects"}),"\n",(0,r.jsx)(n.li,{children:"V\xe9rifiez que l'utilisateur existe et a un mot de passe"}),"\n",(0,r.jsx)(n.li,{children:"V\xe9rifiez les redirect_uris configur\xe9s"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cors-errors",children:"CORS errors"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Ajoutez vos domaines dans ",(0,r.jsx)(n.strong,{children:"Web origins"})," du client"]}),"\n",(0,r.jsxs)(n.li,{children:["En d\xe9veloppement, vous pouvez utiliser ",(0,r.jsx)(n.code,{children:"*"})]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://www.keycloak.org/documentation",children:"Documentation officielle Keycloak"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://oauth.net/2/",children:"OAuth 2.0 Specification"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://openid.net/connect/",children:"OpenID Connect Specification"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://jwt.io",children:"JWT.io - Decoder de tokens"})}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"prochaines-\xe9tapes",children:"Prochaines \xe9tapes"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Int\xe9grer Keycloak dans votre application (Spring Boot, Node.js, React, etc.)"}),"\n",(0,r.jsx)(n.li,{children:"Configurer des r\xf4les et permissions"}),"\n",(0,r.jsx)(n.li,{children:"Mettre en place la f\xe9d\xe9ration d'identit\xe9 (LDAP, Active Directory)"}),"\n",(0,r.jsx)(n.li,{children:"Configurer le SSO (Single Sign-On)"}),"\n",(0,r.jsx)(n.li,{children:"Migrer vers une configuration de production"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>o});var i=s(6540);const r={},l=i.createContext(r);function c(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);