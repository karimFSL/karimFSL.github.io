"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[5618],{3003:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>d,frontMatter:()=>t,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"security/trivy","title":"\ud83d\udd0d Trivy - Scan de vuln\xe9rabilit\xe9s","description":"Trivy est un scanner de vuln\xe9rabilit\xe9s open-source complet et facile \xe0 utiliser. Il scanne les conteneurs, syst\xe8mes de fichiers, repositories Git, et configurations IaC.","source":"@site/docs/security/trivy.md","sourceDirName":"security","slug":"/security/trivy","permalink":"/docs/security/trivy","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/security/trivy.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"docs","previous":{"title":"S\xe9curit\xe9","permalink":"/docs/security/"},"next":{"title":"\ud83d\udccb SBOM - Software Bill of Materials","permalink":"/docs/security/sbom"}}');var r=i(4848),s=i(8453);const t={sidebar_position:2},l="\ud83d\udd0d Trivy - Scan de vuln\xe9rabilit\xe9s",c={},o=[{value:"\ud83c\udfaf Pourquoi Trivy ?",id:"-pourquoi-trivy-",level:2},{value:"\ud83d\udce6 Installation",id:"-installation",level:2},{value:"Binaire",id:"binaire",level:3},{value:"Docker",id:"docker",level:3},{value:"\ud83d\udd0d Types de scans",id:"-types-de-scans",level:2},{value:"1. Scan d&#39;images Docker",id:"1-scan-dimages-docker",level:3},{value:"2. Scan du syst\xe8me de fichiers",id:"2-scan-du-syst\xe8me-de-fichiers",level:3},{value:"3. Scan de configuration IaC",id:"3-scan-de-configuration-iac",level:3},{value:"4. Scan de repository Git",id:"4-scan-de-repository-git",level:3},{value:"5. Scan SBOM",id:"5-scan-sbom",level:3},{value:"\ud83d\udd27 Configuration avanc\xe9e",id:"-configuration-avanc\xe9e",level:2},{value:"Fichier de configuration",id:"fichier-de-configuration",level:3},{value:"Fichier d&#39;exclusion",id:"fichier-dexclusion",level:3},{value:"\ud83d\udd04 Int\xe9gration CI/CD",id:"-int\xe9gration-cicd",level:2},{value:"GitHub Actions",id:"github-actions",level:3},{value:"GitLab CI",id:"gitlab-ci",level:3},{value:"Jenkins",id:"jenkins",level:3},{value:"\ud83d\udcca Formats de sortie",id:"-formats-de-sortie",level:2},{value:"JSON",id:"json",level:3},{value:"SARIF (pour GitHub Security)",id:"sarif-pour-github-security",level:3},{value:"Table (par d\xe9faut)",id:"table-par-d\xe9faut",level:3},{value:"Template personnalis\xe9",id:"template-personnalis\xe9",level:3},{value:"\ud83c\udfaf Meilleures pratiques",id:"-meilleures-pratiques",level:2},{value:"1. Scans r\xe9guliers",id:"1-scans-r\xe9guliers",level:3},{value:"2. Politique de s\xe9v\xe9rit\xe9",id:"2-politique-de-s\xe9v\xe9rit\xe9",level:3},{value:"3. Cache pour performance",id:"3-cache-pour-performance",level:3},{value:"4. Ignorer vuln\xe9rabilit\xe9s non fix\xe9es",id:"4-ignorer-vuln\xe9rabilit\xe9s-non-fix\xe9es",level:3},{value:"5. Policy as Code",id:"5-policy-as-code",level:3},{value:"\ud83d\udd10 Scanning images priv\xe9es",id:"-scanning-images-priv\xe9es",level:2},{value:"Docker Hub priv\xe9",id:"docker-hub-priv\xe9",level:3},{value:"AWS ECR",id:"aws-ecr",level:3},{value:"Azure ACR",id:"azure-acr",level:3},{value:"\ud83d\udcc8 M\xe9triques et reporting",id:"-m\xe9triques-et-reporting",level:2},{value:"Dashboard Grafana",id:"dashboard-grafana",level:3},{value:"Alertes",id:"alertes",level:3},{value:"\ud83d\udd04 Automatisation compl\xe8te",id:"-automatisation-compl\xe8te",level:2},{value:"Pre-commit hook",id:"pre-commit-hook",level:3},{value:"Daily scan avec rapport email",id:"daily-scan-avec-rapport-email",level:3},{value:"\ud83c\udd98 Troubleshooting",id:"-troubleshooting",level:2},{value:"Base de donn\xe9es non \xe0 jour",id:"base-de-donn\xe9es-non-\xe0-jour",level:3},{value:"Erreur de connexion",id:"erreur-de-connexion",level:3},{value:"Scan trop lent",id:"scan-trop-lent",level:3},{value:"\ud83d\udcda Ressources",id:"-ressources",level:2},{value:"\ud83c\udf93 Exemple complet",id:"-exemple-complet",level:2}];function u(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-trivy---scan-de-vuln\xe9rabilit\xe9s",children:"\ud83d\udd0d Trivy - Scan de vuln\xe9rabilit\xe9s"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trivy"})," est un scanner de vuln\xe9rabilit\xe9s open-source complet et facile \xe0 utiliser. Il scanne les conteneurs, syst\xe8mes de fichiers, repositories Git, et configurations IaC."]}),"\n",(0,r.jsx)(n.h2,{id:"-pourquoi-trivy-",children:"\ud83c\udfaf Pourquoi Trivy ?"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Complet"})," : Conteneurs, FS, IaC, SBOM"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Rapide"})," : Scan en quelques secondes"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Pr\xe9cis"})," : Faible taux de faux positifs"]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Multi-sources"})," : NVD, GitHub Security Advisories, etc."]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 ",(0,r.jsx)(n.strong,{children:"Gratuit"})," : Open-source et maintenu activement"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-installation",children:"\ud83d\udce6 Installation"}),"\n",(0,r.jsx)(n.h3,{id:"binaire",children:"Binaire"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Linux\nwget https://github.com/aquasecurity/trivy/releases/download/v0.48.0/trivy_0.48.0_Linux-64bit.tar.gz\ntar zxvf trivy_0.48.0_Linux-64bit.tar.gz\nsudo mv trivy /usr/local/bin/\n\n# macOS\nbrew install trivy\n\n# V\xe9rification\ntrivy --version\n"})}),"\n",(0,r.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull aquasec/trivy:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-types-de-scans",children:"\ud83d\udd0d Types de scans"}),"\n",(0,r.jsx)(n.h3,{id:"1-scan-dimages-docker",children:"1. Scan d'images Docker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan d'une image locale\ntrivy image mon-app:latest\n\n# Scan avec s\xe9v\xe9rit\xe9 sp\xe9cifique\ntrivy image --severity HIGH,CRITICAL mon-app:latest\n\n# Scan avec sortie JSON\ntrivy image --format json --output results.json mon-app:latest\n\n# Scan avec exit code si vuln\xe9rabilit\xe9s\ntrivy image --exit-code 1 --severity CRITICAL mon-app:latest\n\n# Ignorer les vuln\xe9rabilit\xe9s non fix\xe9es\ntrivy image --ignore-unfixed mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-scan-du-syst\xe8me-de-fichiers",children:"2. Scan du syst\xe8me de fichiers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan du r\xe9pertoire actuel\ntrivy fs .\n\n# Scan d'un r\xe9pertoire sp\xe9cifique\ntrivy fs /path/to/project\n\n# Scan avec fichier de suppression\ntrivy fs --ignorefile .trivyignore .\n\n# Scan Java (JAR, WAR)\ntrivy fs target/my-app.jar\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-scan-de-configuration-iac",children:"3. Scan de configuration IaC"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan Terraform\ntrivy config ./infrastructure/terraform\n\n# Scan Kubernetes\ntrivy config ./k8s-manifests\n\n# Scan Docker Compose\ntrivy config docker-compose.yml\n\n# Avec policy personnalis\xe9e\ntrivy config --policy ./policies ./infrastructure\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-scan-de-repository-git",children:"4. Scan de repository Git"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan d'un repo distant\ntrivy repo https://github.com/votre-org/votre-repo\n\n# Scan d'une branche sp\xe9cifique\ntrivy repo --branch develop https://github.com/votre-org/votre-repo\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-scan-sbom",children:"5. Scan SBOM"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Scan d'un SBOM CycloneDX\ntrivy sbom sbom.json\n\n# Scan d'un SBOM SPDX\ntrivy sbom sbom.spdx.json\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-configuration-avanc\xe9e",children:"\ud83d\udd27 Configuration avanc\xe9e"}),"\n",(0,r.jsx)(n.h3,{id:"fichier-de-configuration",children:"Fichier de configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="trivy.yaml"',children:"# trivy.yaml\nseverity:\n  - CRITICAL\n  - HIGH\n  - MEDIUM\n\nvulnerability:\n  ignore-unfixed: true\n  \noutput: json\n\ncache:\n  dir: /tmp/trivy-cache\n\ntimeout: 10m\n\nformat: sarif\n"})}),"\n",(0,r.jsx)(n.p,{children:"Utilisation :"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --config trivy.yaml mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"fichier-dexclusion",children:"Fichier d'exclusion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-text",metastring:'title=".trivyignore"',children:"# .trivyignore - Ignorer des CVE sp\xe9cifiques\n\n# CVE avec false positive\nCVE-2023-12345\n\n# CVE accept\xe9 avec justification\nCVE-2023-67890  # Utilis\xe9 uniquement en dev, pas de risque\n\n# Ignorer un package sp\xe9cifique\npkg:maven/com.example/vulnerable-lib@1.0.0\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-int\xe9gration-cicd",children:"\ud83d\udd04 Int\xe9gration CI/CD"}),"\n",(0,r.jsx)(n.h3,{id:"github-actions",children:"GitHub Actions"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title=".github/workflows/trivy.yml"',children:"name: Trivy Security Scan\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n  schedule:\n    - cron: '0 0 * * *'  # Scan quotidien\n\njobs:\n  trivy-scan:\n    name: Trivy Security Scan\n    runs-on: ubuntu-latest\n    \n    permissions:\n      contents: read\n      security-events: write\n    \n    steps:\n      - name: Checkout code\n        uses: actions/checkout@v4\n      \n      # Scan du code source\n      - name: Run Trivy FS scan\n        uses: aquasecurity/trivy-action@master\n        with:\n          scan-type: 'fs'\n          scan-ref: '.'\n          format: 'sarif'\n          output: 'trivy-fs-results.sarif'\n          severity: 'CRITICAL,HIGH'\n      \n      - name: Upload Trivy FS results to GitHub Security\n        uses: github/codeql-action/upload-sarif@v3\n        with:\n          sarif_file: 'trivy-fs-results.sarif'\n          category: 'trivy-fs'\n      \n      # Scan de l'image Docker\n      - name: Build Docker image\n        run: docker build -t test-image:${{ github.sha }} .\n      \n      - name: Run Trivy image scan\n        uses: aquasecurity/trivy-action@master\n        with:\n          image-ref: 'test-image:${{ github.sha }}'\n          format: 'sarif'\n          output: 'trivy-image-results.sarif'\n          severity: 'CRITICAL,HIGH'\n          exit-code: '1'  # Fail le build si vuln\xe9rabilit\xe9s\n      \n      - name: Upload Trivy image results\n        uses: github/codeql-action/upload-sarif@v3\n        if: always()\n        with:\n          sarif_file: 'trivy-image-results.sarif'\n          category: 'trivy-image'\n      \n      # Scan IaC\n      - name: Run Trivy config scan\n        uses: aquasecurity/trivy-action@master\n        with:\n          scan-type: 'config'\n          scan-ref: './infrastructure'\n          format: 'sarif'\n          output: 'trivy-config-results.sarif'\n          severity: 'CRITICAL,HIGH'\n      \n      - name: Upload Trivy config results\n        uses: github/codeql-action/upload-sarif@v3\n        if: always()\n        with:\n          sarif_file: 'trivy-config-results.sarif'\n          category: 'trivy-config'\n      \n      # G\xe9n\xe9ration de rapport HTML\n      - name: Generate HTML report\n        uses: aquasecurity/trivy-action@master\n        with:\n          scan-type: 'image'\n          image-ref: 'test-image:${{ github.sha }}'\n          format: 'template'\n          template: '@/html.tpl'\n          output: 'trivy-report.html'\n      \n      - name: Upload HTML report\n        uses: actions/upload-artifact@v4\n        if: always()\n        with:\n          name: trivy-report\n          path: trivy-report.html\n"})}),"\n",(0,r.jsx)(n.h3,{id:"gitlab-ci",children:"GitLab CI"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title=".gitlab-ci.yml"',children:'trivy-scan:\n  stage: security\n  image:\n    name: aquasec/trivy:latest\n    entrypoint: [""]\n  script:\n    # Scan FS\n    - trivy fs --exit-code 0 --format json --output trivy-fs-report.json .\n    \n    # Scan image\n    - trivy image --exit-code 1 --severity HIGH,CRITICAL $CI_REGISTRY_IMAGE:$CI_COMMIT_SHA\n  artifacts:\n    reports:\n      container_scanning: trivy-fs-report.json\n    paths:\n      - trivy-fs-report.json\n  only:\n    - main\n    - develop\n'})}),"\n",(0,r.jsx)(n.h3,{id:"jenkins",children:"Jenkins"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-groovy",children:"pipeline {\n    agent any\n    \n    stages {\n        stage('Trivy Scan') {\n            steps {\n                script {\n                    // Scan FS\n                    sh '''\n                        trivy fs \\\n                          --format json \\\n                          --output trivy-fs-results.json \\\n                          --severity CRITICAL,HIGH \\\n                          .\n                    '''\n                    \n                    // Scan image\n                    sh '''\n                        trivy image \\\n                          --format json \\\n                          --output trivy-image-results.json \\\n                          --severity CRITICAL,HIGH \\\n                          --exit-code 1 \\\n                          my-app:${BUILD_NUMBER}\n                    '''\n                }\n            }\n            post {\n                always {\n                    archiveArtifacts artifacts: 'trivy-*.json'\n                    publishHTML([\n                        reportName: 'Trivy Scan',\n                        reportDir: '.',\n                        reportFiles: 'trivy-image-results.json'\n                    ])\n                }\n            }\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-formats-de-sortie",children:"\ud83d\udcca Formats de sortie"}),"\n",(0,r.jsx)(n.h3,{id:"json",children:"JSON"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format json --output results.json mon-app:latest\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "SchemaVersion": 2,\n  "ArtifactName": "mon-app:latest",\n  "ArtifactType": "container_image",\n  "Results": [\n    {\n      "Target": "mon-app:latest (alpine 3.18.4)",\n      "Vulnerabilities": [\n        {\n          "VulnerabilityID": "CVE-2023-12345",\n          "PkgName": "openssl",\n          "InstalledVersion": "3.1.3",\n          "FixedVersion": "3.1.4",\n          "Severity": "HIGH",\n          "Title": "OpenSSL vulnerability",\n          "Description": "A vulnerability was found in OpenSSL...",\n          "References": ["https://nvd.nist.gov/vuln/detail/CVE-2023-12345"]\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"sarif-pour-github-security",children:"SARIF (pour GitHub Security)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image --format sarif --output results.sarif mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"table-par-d\xe9faut",children:"Table (par d\xe9faut)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"trivy image mon-app:latest\n\n# Output:\n# mon-app:latest (alpine 3.18.4)\n# ==================================\n# Total: 15 (CRITICAL: 2, HIGH: 7, MEDIUM: 6, LOW: 0, UNKNOWN: 0)\n"})}),"\n",(0,r.jsx)(n.h3,{id:"template-personnalis\xe9",children:"Template personnalis\xe9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'trivy image --format template --template "@contrib/html.tpl" --output report.html mon-app:latest\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-meilleures-pratiques",children:"\ud83c\udfaf Meilleures pratiques"}),"\n",(0,r.jsx)(n.h3,{id:"1-scans-r\xe9guliers",children:"1. Scans r\xe9guliers"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"# Scan quotidien avec cron\non:\n  schedule:\n    - cron: '0 2 * * *'  # 2h du matin tous les jours\n"})}),"\n",(0,r.jsx)(n.h3,{id:"2-politique-de-s\xe9v\xe9rit\xe9",children:"2. Politique de s\xe9v\xe9rit\xe9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Bloquer uniquement les CRITICAL\ntrivy image --exit-code 1 --severity CRITICAL mon-app:latest\n\n# Ou CRITICAL+HIGH\ntrivy image --exit-code 1 --severity CRITICAL,HIGH mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"3-cache-pour-performance",children:"3. Cache pour performance"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Utiliser un cache local\nexport TRIVY_CACHE_DIR=/tmp/trivy-cache\ntrivy image mon-app:latest\n\n# Mettre \xe0 jour la DB manuellement\ntrivy image --download-db-only\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-ignorer-vuln\xe9rabilit\xe9s-non-fix\xe9es",children:"4. Ignorer vuln\xe9rabilit\xe9s non fix\xe9es"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ne rapporter que ce qui peut \xeatre corrig\xe9\ntrivy image --ignore-unfixed mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"5-policy-as-code",children:"5. Policy as Code"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-rego",metastring:'title="policies/deny-high-vulns.rego"',children:'package trivy\n\ndefault deny = false\n\ndeny {\n    vuln := input.Vulnerabilities[_]\n    vuln.Severity == "CRITICAL"\n}\n\ndeny {\n    vuln := input.Vulnerabilities[_]\n    vuln.Severity == "HIGH"\n    not vuln.FixedVersion\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-scanning-images-priv\xe9es",children:"\ud83d\udd10 Scanning images priv\xe9es"}),"\n",(0,r.jsx)(n.h3,{id:"docker-hub-priv\xe9",children:"Docker Hub priv\xe9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker login\ntrivy image private-registry/mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"aws-ecr",children:"AWS ECR"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin 123456789.dkr.ecr.eu-west-1.amazonaws.com\n\ntrivy image 123456789.dkr.ecr.eu-west-1.amazonaws.com/mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"azure-acr",children:"Azure ACR"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"az acr login --name myregistry\n\ntrivy image myregistry.azurecr.io/mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-m\xe9triques-et-reporting",children:"\ud83d\udcc8 M\xe9triques et reporting"}),"\n",(0,r.jsx)(n.h3,{id:"dashboard-grafana",children:"Dashboard Grafana"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Prometheus exporter for Trivy\napiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: trivy-scan\nspec:\n  schedule: "0 */6 * * *"\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          containers:\n          - name: trivy\n            image: aquasec/trivy:latest\n            args:\n            - image\n            - --format\n            - json\n            - --output\n            - /metrics/trivy-results.json\n            - mon-app:latest\n'})}),"\n",(0,r.jsx)(n.h3,{id:"alertes",children:"Alertes"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Alert sur nouvelles vuln\xe9rabilit\xe9s CRITICAL\nalert: TrivyCriticalVulnerabilities\nexpr: trivy_vulnerabilities{severity="CRITICAL"} > 0\nfor: 5m\nannotations:\n  summary: "Critical vulnerabilities detected"\n  description: "{{ $value }} critical vulnerabilities found"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-automatisation-compl\xe8te",children:"\ud83d\udd04 Automatisation compl\xe8te"}),"\n",(0,r.jsx)(n.h3,{id:"pre-commit-hook",children:"Pre-commit hook"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# .git/hooks/pre-commit\n\necho "Running Trivy scan..."\ntrivy fs --exit-code 1 --severity CRITICAL,HIGH .\n\nif [ $? -ne 0 ]; then\n    echo "\u274c Trivy scan failed. Fix vulnerabilities before committing."\n    exit 1\nfi\n\necho "\u2705 Trivy scan passed"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"daily-scan-avec-rapport-email",children:"Daily scan avec rapport email"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# daily-trivy-scan.sh\n\nREPORT_FILE="trivy-report-$(date +%Y%m%d).html"\n\ntrivy image \\\n  --format template \\\n  --template "@contrib/html.tpl" \\\n  --output $REPORT_FILE \\\n  mon-app:latest\n\n# Envoi par email\nmail -s "Trivy Daily Report" -a $REPORT_FILE devops@example.com < /dev/null\n'})}),"\n",(0,r.jsx)(n.h2,{id:"-troubleshooting",children:"\ud83c\udd98 Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"base-de-donn\xe9es-non-\xe0-jour",children:"Base de donn\xe9es non \xe0 jour"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Forcer la mise \xe0 jour\ntrivy image --download-db-only\n\n# V\xe9rifier la version de la DB\ntrivy --version\n"})}),"\n",(0,r.jsx)(n.h3,{id:"erreur-de-connexion",children:"Erreur de connexion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Utiliser un proxy\nexport HTTP_PROXY=http://proxy:8080\nexport HTTPS_PROXY=http://proxy:8080\n\ntrivy image mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"scan-trop-lent",children:"Scan trop lent"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# R\xe9duire les scanners actifs\ntrivy image --scanners vuln mon-app:latest\n\n# Ignorer les d\xe9pendances de dev\ntrivy image --skip-dirs node_modules mon-app:latest\n"})}),"\n",(0,r.jsx)(n.h2,{id:"-ressources",children:"\ud83d\udcda Ressources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/",children:"Documentation officielle Trivy"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/aquasecurity/trivy",children:"Trivy GitHub"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/latest/docs/scanner/vulnerability/",children:"Best practices"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://aquasecurity.github.io/trivy/latest/docs/integrations/",children:"Int\xe9grations CI/CD"})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-exemple-complet",children:"\ud83c\udf93 Exemple complet"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="complete-trivy-workflow.yml"',children:"name: Complete Trivy Security Pipeline\n\non: [push, pull_request]\n\njobs:\n  trivy-all-scans:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n      \n      # 1. Scan du code source\n      - name: Scan filesystem\n        uses: aquasecurity/trivy-action@master\n        with:\n          scan-type: 'fs'\n          format: 'sarif'\n          output: 'trivy-fs.sarif'\n      \n      # 2. Build image\n      - name: Build image\n        run: docker build -t app:${{ github.sha }} .\n      \n      # 3. Scan image\n      - name: Scan image\n        uses: aquasecurity/trivy-action@master\n        with:\n          image-ref: 'app:${{ github.sha }}'\n          format: 'sarif'\n          output: 'trivy-image.sarif'\n          exit-code: '1'\n      \n      # 4. Scan IaC\n      - name: Scan infrastructure\n        uses: aquasecurity/trivy-action@master\n        with:\n          scan-type: 'config'\n          scan-ref: './infrastructure'\n          format: 'sarif'\n          output: 'trivy-iac.sarif'\n      \n      # 5. Upload tous les r\xe9sultats\n      - name: Upload results\n        uses: github/codeql-action/upload-sarif@v3\n        if: always()\n        with:\n          sarif_file: '.'\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Trivy est maintenant int\xe9gr\xe9 dans vos pipelines CI/CD et scanne automatiquement toutes vos vuln\xe9rabilit\xe9s !"})," \ud83d\udd12"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>l});var a=i(6540);const r={},s=a.createContext(r);function t(e){const n=a.useContext(s);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);