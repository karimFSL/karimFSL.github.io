"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[8467],{6364:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"development/devops/tips/wsl-installation","title":"Installation de WSL 2 et Docker","description":"Installation de WSL","source":"@site/docs/development/devops/tips/wsl-installation.md","sourceDirName":"development/devops/tips","slug":"/development/devops/tips/wsl-installation","permalink":"/docs/development/devops/tips/wsl-installation","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/development/devops/tips/wsl-installation.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"docs","previous":{"title":"Infrastructure As Code guide","permalink":"/docs/development/devops/infrastructure-as-code/"},"next":{"title":"Mise en place de DevContainer","permalink":"/docs/development/devops/tips/devcontainer"}}');var l=s(4848),o=s(8453);const t={sidebar_position:1},i="Installation de WSL 2 et Docker",a={},d=[{value:"Installation de WSL",id:"installation-de-wsl",level:2},{value:"Installation de Docker dans WSL2",id:"installation-de-docker-dans-wsl2",level:2},{value:"Installation",id:"installation",level:3},{value:"Lancer Docker",id:"lancer-docker",level:3},{value:"Installation de docker-compose",id:"installation-de-docker-compose",level:2},{value:"Gestion de Docker",id:"gestion-de-docker",level:2},{value:"Exposition de Docker sur localhost",id:"exposition-de-docker-sur-localhost",level:3},{value:"Alternative : Portainer",id:"alternative--portainer",level:3},{value:"Astuces",id:"astuces",level:2},{value:"WSL + VPN",id:"wsl--vpn",level:3},{value:"Installation",id:"installation-1",level:4},{value:"\xc9viter sudo",id:"\xe9viter-sudo",level:3},{value:"AutoStart",id:"autostart",level:3},{value:"Backup / Restore",id:"backup--restore",level:3},{value:"Backup",id:"backup",level:4},{value:"Restore",id:"restore",level:4}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"installation-de-wsl-2-et-docker",children:"Installation de WSL 2 et Docker"})}),"\n",(0,l.jsx)(n.h2,{id:"installation-de-wsl",children:"Installation de WSL"}),"\n",(0,l.jsx)(n.p,{children:"Entrez cette commande dans PowerShell puis red\xe9marrez votre machine :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-powershell",children:"wsl --install\n"})}),"\n",(0,l.jsx)(n.p,{children:"V\xe9rifiez la version de distribution, elle doit \xeatre Ubuntu :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-powershell",children:"wsl -l\n"})}),"\n",(0,l.jsx)(n.p,{children:"Si Ubuntu n'est pas install\xe9 :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-powershell",children:"wsl --install -d Ubuntu\n"})}),"\n",(0,l.jsx)(n.p,{children:"Si Ubuntu n'est pas d\xe9fini par d\xe9faut :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-powershell",children:"wsl -s Ubuntu\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"installation-de-docker-dans-wsl2",children:"Installation de Docker dans WSL2"}),"\n",(0,l.jsx)(n.p,{children:"Lancez WSL depuis le menu Windows."}),"\n",(0,l.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'sudo apt-get update\n\nsudo apt-get install apt-transport-https ca-certificates curl gnupg lsb-release\n\ncurl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\n\necho "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\n\nsudo apt-get update\n\nsudo apt-get install docker-ce docker-ce-cli containerd.io\n'})}),"\n",(0,l.jsx)(n.h3,{id:"lancer-docker",children:"Lancer Docker"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo service docker start\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Note :"})," Apr\xe8s chaque red\xe9marrage, vous devez ouvrir WSL et lancer Docker (ou voir la section AutoStart ci-dessous)."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"installation-de-docker-compose",children:"Installation de docker-compose"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo curl -SL https://github.com/docker/compose/releases/download/v2.2.3/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose\n\nsudo chmod +x /usr/local/bin/docker-compose\n"})}),"\n",(0,l.jsxs)(n.blockquote,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Important :"})," Le d\xe9p\xf4t par d\xe9faut n'est pas \xe0 jour. Si vous installez docker-compose avec ",(0,l.jsx)(n.code,{children:"sudo apt install docker-compose"}),", la version sera une ancienne version 1.25.0."]}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"gestion-de-docker",children:"Gestion de Docker"}),"\n",(0,l.jsx)(n.h3,{id:"exposition-de-docker-sur-localhost",children:"Exposition de Docker sur localhost"}),"\n",(0,l.jsx)(n.p,{children:"Si vous souhaitez g\xe9rer Docker avec le plugin Docker d'IntelliJ, vous devez exposer Docker sur localhost."}),"\n",(0,l.jsxs)(n.p,{children:["Ajoutez dans le fichier ",(0,l.jsx)(n.code,{children:"/etc/default/docker"})," :"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'export DOCKER_OPTS="--host unix:// --host tcp://127.0.0.1:2375"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"alternative--portainer",children:"Alternative : Portainer"}),"\n",(0,l.jsx)(n.p,{children:"Vous pouvez \xe9galement installer un conteneur Portainer pour g\xe9rer votre environnement Docker."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"astuces",children:"Astuces"}),"\n",(0,l.jsx)(n.h3,{id:"wsl--vpn",children:"WSL + VPN"}),"\n",(0,l.jsx)(n.p,{children:"Si vous rencontrez des probl\xe8mes r\xe9seau lors du d\xe9marrage de WSL avec un VPN, vous pouvez utiliser cette image WSL pour cr\xe9er un pont entre HyperV et l'h\xf4te."}),"\n",(0,l.jsxs)(n.p,{children:["Image \xe0 utiliser : ",(0,l.jsx)(n.code,{children:"wsl-vpnkit-v0.3.8.tar.gz"})," (utilisez uniquement cette version 0.3.8)"]}),"\n",(0,l.jsx)(n.h4,{id:"installation-1",children:"Installation"}),"\n",(0,l.jsx)(n.p,{children:"Ouvrez une invite PowerShell et ex\xe9cutez les commandes suivantes :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-powershell",children:"wsl --import wsl-vpnkit $env:USERPROFILE\\wsl-vpnkit wsl-vpnkit-v0.3.8.tar.gz --version 2\n"})}),"\n",(0,l.jsx)(n.p,{children:"Ex\xe9cutez cette commande chaque fois que vous perdez la connectivit\xe9 r\xe9seau lors de la connexion au VPN :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-powershell",children:"wsl.exe -d wsl-vpnkit service wsl-vpnkit start\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"\xe9viter-sudo",children:"\xc9viter sudo"}),"\n",(0,l.jsx)(n.p,{children:"Pour ajouter l'utilisateur WSL au groupe Docker et \xe9viter d'ex\xe9cuter Docker avec sudo (facultatif) :"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo usermod -aG docker $USER\n"})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"autostart",children:"AutoStart"}),"\n",(0,l.jsx)(n.p,{children:"Pour d\xe9marrer automatiquement Docker au lancement de WSL :"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"\xc9ditez sudoers :"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo visudo\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"2",children:["\n",(0,l.jsx)(n.li,{children:"Ajoutez \xe0 la fin du fichier :"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Docker daemon specification\n[user_ubuntu] ALL=(ALL) NOPASSWD: /usr/bin/dockerd\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsx)(n.li,{children:"\xc9ditez bashrc :"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"vi ~/.bashrc\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"4",children:["\n",(0,l.jsx)(n.li,{children:"Ajoutez \xe0 la fin du fichier :"}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Start Docker daemon automatically when logging in if not running.\nRUNNING=`ps aux | grep dockerd | grep -v grep`\nif [ -z "$RUNNING" ]; then\n    sudo dockerd > /dev/null 2>&1 &\n    disown\nfi\n'})}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h3,{id:"backup--restore",children:"Backup / Restore"}),"\n",(0,l.jsx)(n.p,{children:"Pour sauvegarder des volumes depuis Docker Desktop et les restaurer dans WSL :"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"${PWD}"})," = variable pour le r\xe9pertoire courant"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"[VOLUME]"})," = nom du volume"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"backup",children:"Backup"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -v ${PWD}:/destination -v [VOLUME]:/source ubuntu bash\ncd /source && tar cvf /destination/[VOLUME].tar\nexit\n"})}),"\n",(0,l.jsx)(n.h4,{id:"restore",children:"Restore"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run --rm -it -v ${PWD}:/source -v [VOLUME]:/destination ubuntu bash\ncd /destination && tar xvf /source/[VOLUME].tar\nexit\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>i});var r=s(6540);const l={},o=r.createContext(l);function t(e){const n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);