"use strict";(globalThis.webpackChunkdocusaurus_poc=globalThis.webpackChunkdocusaurus_poc||[]).push([[1360],{2739:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"development/devops/tips/cliff","title":"G\xe9n\xe9ration automatique de Changelog avec git-cliff","description":"Introduction","source":"@site/docs/development/devops/tips/cliff.md","sourceDirName":"development/devops/tips","slug":"/development/devops/tips/cliff","permalink":"/docs/development/devops/tips/cliff","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/development/devops/tips/cliff.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"docs","previous":{"title":"Connexion \xe0 Git avec GitLab","permalink":"/docs/development/devops/tips/gitlab-authentication"},"next":{"title":"Microservices","permalink":"/docs/microservices/"}}');var t=i(4848),o=i(8453);const r={sidebar_position:5},a="G\xe9n\xe9ration automatique de Changelog avec git-cliff",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Installation rapide",id:"installation-rapide",level:2},{value:"Configuration de base",id:"configuration-de-base",level:2},{value:"Utilisation quotidienne",id:"utilisation-quotidienne",level:2},{value:"Commandes essentielles",id:"commandes-essentielles",level:3},{value:"Int\xe9gration GitLab CI",id:"int\xe9gration-gitlab-ci",level:2},{value:"Script de release",id:"script-de-release",level:2},{value:"Configuration avanc\xe9e (optionnelle)",id:"configuration-avanc\xe9e-optionnelle",level:2},{value:"Pour un monorepo",id:"pour-un-monorepo",level:3},{value:"Avec int\xe9gration Jira",id:"avec-int\xe9gration-jira",level:3},{value:"Git Hook pour validation des commits",id:"git-hook-pour-validation-des-commits",level:2},{value:"Exemples de messages de commit",id:"exemples-de-messages-de-commit",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"&quot;No tags found&quot;",id:"no-tags-found",level:3},{value:"Commits non d\xe9tect\xe9s dans GitLab CI",id:"commits-non-d\xe9tect\xe9s-dans-gitlab-ci",level:3},{value:"Tester la configuration",id:"tester-la-configuration",level:3},{value:"Checklist d&#39;int\xe9gration",id:"checklist-dint\xe9gration",level:2},{value:"Ressources",id:"ressources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",input:"input",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"g\xe9n\xe9ration-automatique-de-changelog-avec-git-cliff",children:"G\xe9n\xe9ration automatique de Changelog avec git-cliff"})}),"\n",(0,t.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"git-cliff"})," est un g\xe9n\xe9rateur de changelog rapide et configurable qui g\xe9n\xe8re automatiquement des changelogs \xe0 partir de l'historique Git en suivant les conventions Conventional Commits."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Pourquoi git-cliff ?"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\ud83d\ude80 Ultra-rapide (\xe9crit en Rust)"}),"\n",(0,t.jsx)(n.li,{children:"\ud83d\udcdd Support des Conventional Commits"}),"\n",(0,t.jsx)(n.li,{children:"\ud83c\udfa8 Hautement personnalisable"}),"\n",(0,t.jsx)(n.li,{children:"\ud83d\udd27 Int\xe9gration facile CI/CD"}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"installation-rapide",children:"Installation rapide"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Linux/macOS\ncargo install git-cliff\n\n# Ou t\xe9l\xe9chargement direct\ncurl -L https://github.com/orhun/git-cliff/releases/latest/download/git-cliff-x86_64-unknown-linux-gnu.tar.gz | tar xz\nsudo mv git-cliff /usr/local/bin/\n\n# V\xe9rification\ngit-cliff --version\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"configuration-de-base",children:"Configuration de base"}),"\n",(0,t.jsxs)(n.p,{children:["Cr\xe9ez ",(0,t.jsx)(n.code,{children:"cliff.toml"})," \xe0 la racine de votre projet :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'[changelog]\nheader = """\n# Changelog\\n\nLe format est bas\xe9 sur [Keep a Changelog](https://keepachangelog.com/fr/1.0.0/).\\n\n"""\n\nbody = """\n{% if version %}\\\n    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}\n{% else %}\\\n    ## [Non publi\xe9]\n{% endif %}\\\n{% for group, commits in commits | group_by(attribute="group") %}\n    ### {{ group }}\n    {% for commit in commits %}\n        - {{ commit.message | upper_first }}{% if commit.breaking %} [**BREAKING**]{% endif %}\\\n    {% endfor %}\n{% endfor %}\\n\n"""\n\nfooter = """\n\x3c!-- generated by git-cliff --\x3e\n"""\n\n[git]\nconventional_commits = true\nfilter_unconventional = true\n\ncommit_parsers = [\n    { message = "^feat", group = "\u2728 Nouvelles fonctionnalit\xe9s" },\n    { message = "^fix", group = "\ud83d\udc1b Corrections de bugs" },\n    { message = "^doc", group = "\ud83d\udcda Documentation" },\n    { message = "^perf", group = "\u26a1 Performance" },\n    { message = "^refactor", group = "\u267b\ufe0f Refactoring" },\n    { message = "^test", group = "\u2705 Tests" },\n    { message = "^chore\\\\(release\\\\)", skip = true },\n    { message = "^chore", group = "\ud83d\udd27 Maintenance" },\n]\n\n# Liens vers GitLab\ncommit_preprocessors = [\n    { pattern = \'\\(#([0-9]+)\\)\', replace = "([#${1}](https://gitlab.com/votre-org/votre-repo/-/issues/${1}))" },\n    { pattern = \'\\(!([0-9]+)\\)\', replace = "([!${1}](https://gitlab.com/votre-org/votre-repo/-/merge_requests/${1}))" },\n]\n\nsort_commits = "oldest"\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"utilisation-quotidienne",children:"Utilisation quotidienne"}),"\n",(0,t.jsx)(n.h3,{id:"commandes-essentielles",children:"Commandes essentielles"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Voir les changements non publi\xe9s\ngit-cliff --unreleased\n\n# G\xe9n\xe9rer le changelog complet\ngit-cliff -o CHANGELOG.md\n\n# G\xe9n\xe9rer pour une nouvelle version\ngit-cliff --tag v1.2.0 -o CHANGELOG.md\n\n# Pr\xe9visualiser avec une future version\ngit-cliff --unreleased --tag v1.2.0\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"int\xe9gration-gitlab-ci",children:"Int\xe9gration GitLab CI"}),"\n",(0,t.jsxs)(n.p,{children:["Cr\xe9ez ",(0,t.jsx)(n.code,{children:".gitlab-ci.yml"})," :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'stages:\n  - release\n\nvariables:\n  GIT_DEPTH: 0  # Important pour l\'historique complet\n\ngenerate-changelog:\n  stage: release\n  image: rust:alpine\n  only:\n    - tags\n    - /^v\\d+\\.\\d+\\.\\d+$/\n  before_script:\n    - apk add --no-cache git curl\n    - |\n      curl -L https://github.com/orhun/git-cliff/releases/latest/download/git-cliff-x86_64-unknown-linux-musl.tar.gz | tar xz\n      mv git-cliff /usr/local/bin/\n      chmod +x /usr/local/bin/git-cliff\n  script:\n    - echo "\ud83d\ude80 G\xe9n\xe9ration du changelog pour $CI_COMMIT_TAG"\n    - git-cliff --latest --output CHANGELOG.md\n    - |\n      # Commit et push du changelog\n      git config user.name "GitLab CI"\n      git config user.email "ci@gitlab.com"\n      git add CHANGELOG.md\n      git commit -m "docs: update CHANGELOG.md for $CI_COMMIT_TAG [skip ci]" || true\n      git remote set-url origin https://oauth2:${CI_JOB_TOKEN}@${CI_SERVER_HOST}/${CI_PROJECT_PATH}.git\n      git push origin HEAD:main -o ci.skip || true\n  artifacts:\n    paths:\n      - CHANGELOG.md\n    expire_in: 1 month\n\ncreate-release:\n  stage: release\n  image: registry.gitlab.com/gitlab-org/release-cli:latest\n  needs:\n    - generate-changelog\n  only:\n    - tags\n    - /^v\\d+\\.\\d+\\.\\d+$/\n  script:\n    - echo "\ud83d\udce6 Cr\xe9ation de la release $CI_COMMIT_TAG"\n  release:\n    name: \'Release $CI_COMMIT_TAG\'\n    description: \'./CHANGELOG.md\'\n    tag_name: \'$CI_COMMIT_TAG\'\n    ref: \'$CI_COMMIT_SHA\'\n'})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"script-de-release",children:"Script de release"}),"\n",(0,t.jsxs)(n.p,{children:["Cr\xe9ez ",(0,t.jsx)(n.code,{children:"scripts/release.sh"})," :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nset -e\n\n# Couleurs\nGREEN=\'\\033[0;32m\'\nRED=\'\\033[0;31m\'\nNC=\'\\033[0m\'\n\ninfo() { echo -e "${GREEN}[INFO]${NC} $1"; }\nerror() { echo -e "${RED}[ERROR]${NC} $1"; exit 1; }\n\n# V\xe9rifications\ncommand -v git-cliff &> /dev/null || error "git-cliff n\'est pas install\xe9"\n[[ -n $(git status -s) ]] && error "Vous avez des changements non commit\xe9s"\n\n# R\xe9cup\xe9rer la version actuelle\ncurrent_version=$(git describe --tags --abbrev=0 2>/dev/null || echo "v0.0.0")\ncurrent_version=${current_version#v}\n\ninfo "Version actuelle: $current_version"\n\n# Demander le type de release\necho ""\necho "Type de release:"\necho "1) major (x.0.0)"\necho "2) minor (0.x.0)"\necho "3) patch (0.0.x)"\nread -p "Choisissez (1-3): " release_type\n\nIFS=\'.\' read -r major minor patch <<< "$current_version"\n\ncase $release_type in\n    1) new_version="$((major + 1)).0.0" ;;\n    2) new_version="$major.$((minor + 1)).0" ;;\n    3) new_version="$major.$minor.$((patch + 1))" ;;\n    *) error "Choix invalide" ;;\nesac\n\ninfo "Nouvelle version: v$new_version"\n\n# Confirmation\nread -p "Continuer? (y/n) " -n 1 -r\necho\n[[ ! $REPLY =~ ^[Yy]$ ]] && error "Annul\xe9"\n\n# G\xe9n\xe9rer le changelog\ninfo "G\xe9n\xe9ration du changelog..."\ngit-cliff --tag "v$new_version" --output CHANGELOG.md\n\n# Aper\xe7u\necho ""\ninfo "Aper\xe7u:"\ngit-cliff --tag "v$new_version" --unreleased\necho ""\n\nread -p "Le changelog vous convient? (y/n) " -n 1 -r\necho\n[[ ! $REPLY =~ ^[Yy]$ ]] && error "Annul\xe9"\n\n# Commit et tag\ninfo "Commit du changelog..."\ngit add CHANGELOG.md\ngit commit -m "docs: update CHANGELOG.md for v$new_version"\n\ninfo "Cr\xe9ation du tag..."\ngit tag -a "v$new_version" -m "Release v$new_version"\n\ninfo "Push..."\ngit push origin main\ngit push origin "v$new_version"\n\ninfo "\u2705 Release v$new_version cr\xe9\xe9e!"\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"chmod +x scripts/release.sh\n./scripts/release.sh\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"configuration-avanc\xe9e-optionnelle",children:"Configuration avanc\xe9e (optionnelle)"}),"\n",(0,t.jsx)(n.h3,{id:"pour-un-monorepo",children:"Pour un monorepo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:'# cliff-backend.toml\n[git]\ncommit_parsers = [\n    { message = "^feat\\\\(backend\\\\)", group = "\u2728 Nouvelles fonctionnalit\xe9s" },\n    { message = "^fix\\\\(backend\\\\)", group = "\ud83d\udc1b Corrections" },\n]\ntag_pattern = "backend-v[0-9]*"\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# G\xe9n\xe9rer le changelog backend uniquement\ngit-cliff --config cliff-backend.toml --include-path "backend/*" -o backend/CHANGELOG.md\n'})}),"\n",(0,t.jsx)(n.h3,{id:"avec-int\xe9gration-jira",children:"Avec int\xe9gration Jira"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",children:"commit_preprocessors = [\n    # Lier les tickets Jira\n    { pattern = '([A-Z]+-\\d+)', replace = \"([${1}](https://votre-jira.atlassian.net/browse/${1}))\" },\n    # Lier les issues GitLab\n    { pattern = '#(\\d+)', replace = \"([#${1}](https://gitlab.com/votre-org/votre-repo/-/issues/${1}))\" },\n]\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"git-hook-pour-validation-des-commits",children:"Git Hook pour validation des commits"}),"\n",(0,t.jsxs)(n.p,{children:["Cr\xe9ez ",(0,t.jsx)(n.code,{children:".git/hooks/commit-msg"})," :"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n\ncommit_msg=$(cat "$1")\nconventional_regex=\'^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\\(.+\\))?: .{1,}\'\n\nif ! echo "$commit_msg" | grep -qE "$conventional_regex"; then\n  echo "\u274c Message de commit invalide!"\n  echo "Format: <type>(<scope>): <description>"\n  echo ""\n  echo "Exemples:"\n  echo "  feat(auth): ajout OAuth2"\n  echo "  fix(api): correction pagination"\n  exit 1\nfi\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"chmod +x .git/hooks/commit-msg\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"exemples-de-messages-de-commit",children:"Exemples de messages de commit"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Nouvelles fonctionnalit\xe9s\nfeat: ajout de l'export PDF\nfeat(auth): int\xe9gration Keycloak\n\n# Corrections de bugs\nfix: correction du bug de pagination\nfix(api): gestion correcte des timeouts\n\n# Breaking changes\nfeat!: suppression de l'API v1\nBREAKING CHANGE: l'API v1 n'est plus support\xe9e\n\n# Autres types\ndocs: mise \xe0 jour du README\nchore(deps): mise \xe0 jour des d\xe9pendances\nrefactor: refactoring du service d'auth\nperf: optimisation des requ\xeates SQL\ntest: ajout de tests unitaires\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"no-tags-found",children:'"No tags found"'}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Cr\xe9er un tag initial\ngit tag v0.1.0\ngit push origin v0.1.0\n"})}),"\n",(0,t.jsx)(n.h3,{id:"commits-non-d\xe9tect\xe9s-dans-gitlab-ci",children:"Commits non d\xe9tect\xe9s dans GitLab CI"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# Assurez-vous d'avoir dans .gitlab-ci.yml\nvariables:\n  GIT_DEPTH: 0\n"})}),"\n",(0,t.jsx)(n.h3,{id:"tester-la-configuration",children:"Tester la configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Voir les commits qui seront inclus\ngit-cliff --unreleased --context | jq '.commits'\n\n# Mode dry-run\ngit-cliff --unreleased --dry-run\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"checklist-dint\xe9gration",children:"Checklist d'int\xe9gration"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Installer git-cliff : ",(0,t.jsx)(n.code,{children:"cargo install git-cliff"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er ",(0,t.jsx)(n.code,{children:"cliff.toml"})," \xe0 la racine du projet"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Adapter les liens GitLab dans la configuration"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Ajouter le job dans ",(0,t.jsx)(n.code,{children:".gitlab-ci.yml"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er le script ",(0,t.jsx)(n.code,{children:"scripts/release.sh"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Ajouter le hook de validation des commits"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tester avec ",(0,t.jsx)(n.code,{children:"git-cliff --unreleased"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Former l'\xe9quipe aux Conventional Commits"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er votre premi\xe8re release : ",(0,t.jsx)(n.code,{children:"./scripts/release.sh"})]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://git-cliff.org/",children:"Documentation officielle"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.conventionalcommits.org/",children:"Conventional Commits"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://keepachangelog.com/fr/",children:"Keep a Changelog"})}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>a});var s=i(6540);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);